<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="MySQL(03), 薛定谔的腿毛">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>MySQL(03) | 薛定谔的腿毛</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 5.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="薛定谔的腿毛" type="application/atom+xml">
</head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">薛定谔的腿毛</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">薛定谔的腿毛</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        
    </ul>
</div>


        </div>

        
    </nav>

</header>

    
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/72.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">MySQL(03)</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/%E7%AC%94%E8%AE%B0/">
                                <span class="chip bg-color">笔记</span>
                            </a>
                        
                            <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">
                                <span class="chip bg-color">数据库</span>
                            </a>
                        
                            <a href="/tags/MySQL/">
                                <span class="chip bg-color">MySQL</span>
                            </a>
                        
                            <a href="/tags/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2/">
                                <span class="chip bg-color">多表查询</span>
                            </a>
                        
                            <a href="/tags/%E7%B4%A2%E5%BC%95/">
                                <span class="chip bg-color">索引</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" class="post-category">
                                数据库
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2020-09-20
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2022-05-17
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    9.9k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    39 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.css">
        

        
        <!-- 代码块折行 -->
        <style type="text/css">
            code[class*="language-"], pre[class*="language-"] { white-space: pre-wrap !important; }
        </style>
        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="MySQL-多表查询-索引-事务笔记"><a href="#MySQL-多表查询-索引-事务笔记" class="headerlink" title="MySQL-多表查询-索引-事务笔记"></a>MySQL-多表查询-索引-事务笔记</h1><h1 id="回顾"><a href="#回顾" class="headerlink" title="回顾"></a>回顾</h1><ol>
<li><p>能够使用聚合函数</p>
<p>MAX: 获取这列最大值</p>
<p>MIN: 获取这列最小值</p>
<p>COUNT: 获取这列总数量</p>
<p>AVG: 获取这列平均值</p>
<p>SUM: 获取这列总和</p>
</li>
<li><p>能够使用SQL语句进行分组查询</p>
<p>GROUP BY 字段名</p>
<p>SELECT * FROM 表名 GROUP BY 字段名;</p>
</li>
<li><p>能够理解三大范式</p>
<p>1NF: 表中的字段不需要再拆分,可以直接使用</p>
<p>2NF: 1.一张表描述一个实体  2.每张表添加主键</p>
<p>3NF: 表中的字段引用其他表的主键</p>
</li>
</ol>
<h1 id="学习目标"><a href="#学习目标" class="headerlink" title="学习目标"></a>学习目标</h1><ol>
<li>能够使用内连接进行多表查询</li>
<li>能够使用左外和右外连接进行多表查询</li>
<li>能够使用子查询</li>
<li>能够理解多表查询的规律</li>
<li>能够理解事务的概念</li>
<li>能够说出事务的原理</li>
<li>理解mysql索引的作用</li>
</ol>
<h2 id="多表查询介绍"><a href="#多表查询介绍" class="headerlink" title="多表查询介绍"></a>多表查询介绍</h2><h3 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h3><p>了解什么是多表查询，及多表查询的两种方式</p>
<h4 id="什么是多表查询"><a href="#什么是多表查询" class="headerlink" title="什么是多表查询"></a>什么是多表查询</h4><p><font color="red"><strong>查询多张表才能得到我们想要的数据</strong></font></p>
<p>比如：我们想查询到孙悟空在哪个部门，需要将部门表和员工表同时进行查询<br><img src="MySQL-03.assets/1596877995408.png" alt="1596877995408"></p>
<h4 id="多表查询的分类"><a href="#多表查询的分类" class="headerlink" title="多表查询的分类"></a>多表查询的分类</h4><p><img src="MySQL-03.assets/1550291804592.png" alt="1550291804592"></p>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>什么是多表查询？</p>
<pre class="line-numbers language-none"><code class="language-none">查询多张表才能得到我们想要的数据<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>说出多表查询的2种方式?</p>
<pre class="line-numbers language-none"><code class="language-none">表连接查询
子查询<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>



<h2 id="表连接查询-笛卡尔积现象"><a href="#表连接查询-笛卡尔积现象" class="headerlink" title="表连接查询-笛卡尔积现象"></a>表连接查询-笛卡尔积现象</h2><h3 id="目标-1"><a href="#目标-1" class="headerlink" title="目标"></a>目标</h3><p>学习什么是笛卡尔积，以及如何消除笛卡尔积</p>
<h4 id="准备数据"><a href="#准备数据" class="headerlink" title="准备数据"></a>准备数据</h4><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 准备数据</span>
<span class="token comment">-- 创建部门表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> tab_dept <span class="token punctuation">(</span>
  id <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  NAME <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tab_dept <span class="token punctuation">(</span>NAME<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'开发部'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">'市场部'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">'财务部'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 创建员工表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> tab_emp <span class="token punctuation">(</span>
  id <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  NAME <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  gender <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   <span class="token comment">-- 性别</span>
  salary <span class="token keyword">DOUBLE</span><span class="token punctuation">,</span>   <span class="token comment">-- 工资</span>
  join_date <span class="token keyword">DATE</span><span class="token punctuation">,</span>  <span class="token comment">-- 入职日期</span>
  dept_id <span class="token keyword">INT</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tab_emp<span class="token punctuation">(</span>NAME<span class="token punctuation">,</span>gender<span class="token punctuation">,</span>salary<span class="token punctuation">,</span>join_date<span class="token punctuation">,</span>dept_id<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'孙悟空'</span><span class="token punctuation">,</span><span class="token string">'男'</span><span class="token punctuation">,</span><span class="token number">7200</span><span class="token punctuation">,</span><span class="token string">'2013-02-24'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tab_emp<span class="token punctuation">(</span>NAME<span class="token punctuation">,</span>gender<span class="token punctuation">,</span>salary<span class="token punctuation">,</span>join_date<span class="token punctuation">,</span>dept_id<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'猪八戒'</span><span class="token punctuation">,</span><span class="token string">'男'</span><span class="token punctuation">,</span><span class="token number">3600</span><span class="token punctuation">,</span><span class="token string">'2010-12-02'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tab_emp<span class="token punctuation">(</span>NAME<span class="token punctuation">,</span>gender<span class="token punctuation">,</span>salary<span class="token punctuation">,</span>join_date<span class="token punctuation">,</span>dept_id<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'唐僧'</span><span class="token punctuation">,</span><span class="token string">'男'</span><span class="token punctuation">,</span><span class="token number">9000</span><span class="token punctuation">,</span><span class="token string">'2008-08-08'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tab_emp<span class="token punctuation">(</span>NAME<span class="token punctuation">,</span>gender<span class="token punctuation">,</span>salary<span class="token punctuation">,</span>join_date<span class="token punctuation">,</span>dept_id<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'白骨精'</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">,</span><span class="token number">5000</span><span class="token punctuation">,</span><span class="token string">'2015-10-07'</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tab_emp<span class="token punctuation">(</span>NAME<span class="token punctuation">,</span>gender<span class="token punctuation">,</span>salary<span class="token punctuation">,</span>join_date<span class="token punctuation">,</span>dept_id<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'蜘蛛精'</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">,</span><span class="token number">4500</span><span class="token punctuation">,</span><span class="token string">'2011-03-14'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="什么是笛卡尔积现象"><a href="#什么是笛卡尔积现象" class="headerlink" title="什么是笛卡尔积现象"></a>什么是笛卡尔积现象</h4><p>需求：查询每个部门有哪些人</p>
<p>具体操作：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tab_dept<span class="token punctuation">,</span> tab_emp<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="MySQL-03.assets/1596878010221.png" alt="1596878010221"></p>
<p>以上数据其实是左表的每条数据和右表的每条数据组合。左表有3条，右表有5条，最终组合后3*5=15条数据。</p>
<p><strong>左表的每条数据和右表的每条数据组合，这种效果称为笛卡尔乘积</strong><br><img src="MySQL-03.assets/1597311875102.png" alt="1597311875102"></p>
<h4 id="如何清除笛卡尔积现象的影响"><a href="#如何清除笛卡尔积现象的影响" class="headerlink" title="如何清除笛卡尔积现象的影响"></a>如何清除笛卡尔积现象的影响</h4><p>我们发现不是所有的数据组合都是有用的，只有员工表.dept_id = 部门表.id 的数据才是有用的。所以需要通过条件过滤掉没用的数据。<br><img src="MySQL-03.assets/1597311908212.png" alt="1597311908212"></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tab_dept<span class="token punctuation">,</span> tab_emp <span class="token keyword">WHERE</span> tab_emp<span class="token punctuation">.</span><span class="token punctuation">`</span>dept_id<span class="token punctuation">`</span><span class="token operator">=</span>tab_dept<span class="token punctuation">.</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="MySQL-03.assets/1596878056518.png" alt="1596878056518"></p>
<p>我们去掉笛卡尔积的条件称为: <font color="red"><strong>表连接条件</strong></font></p>
<h3 id="小结-1"><a href="#小结-1" class="headerlink" title="小结"></a>小结</h3><ol>
<li><p>能够说出什么是笛卡尔积?</p>
<pre class="line-numbers language-none"><code class="language-none">多表查询时,左表的每条数据和右表的每条数据进行组合<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


</li>
</ol>
<ol start="2">
<li><p>如何消除笛卡尔积：</p>
<pre class="line-numbers language-none"><code class="language-none">外键=主表的主键;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>




</li>
</ol>
<h2 id="表连接查询-内连接-重要"><a href="#表连接查询-内连接-重要" class="headerlink" title="表连接查询-内连接(重要)"></a>表连接查询-内连接(重要)</h2><h3 id="目标-2"><a href="#目标-2" class="headerlink" title="目标"></a>目标</h3><p>学习内连接的使用</p>
<h4 id="什么是内连接"><a href="#什么是内连接" class="headerlink" title="什么是内连接"></a>什么是内连接</h4><p>多表查询时获取符合条件的数据</p>
<h4 id="内连接效果"><a href="#内连接效果" class="headerlink" title="内连接效果"></a>内连接效果</h4><p><img src="MySQL-03.assets/1568680722435.png" alt="1568680722435"></p>
<h4 id="隐式内连接"><a href="#隐式内连接" class="headerlink" title="隐式内连接"></a>隐式内连接</h4><p>隐式内连接：看不到<code>JOIN</code>关键字，条件使用<code>WHERE</code>指定</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> 表<span class="token number">1</span><span class="token punctuation">,</span> 表<span class="token number">2</span> <span class="token keyword">WHERE</span> 条件<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="显式内连接"><a href="#显式内连接" class="headerlink" title="显式内连接"></a>显式内连接</h4><p>显式内连接：使用<code>INNER JOIN ... ON</code>语句, 可以省略<code>INNER</code></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> 表<span class="token number">1</span> <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> 表<span class="token number">2</span> <span class="token keyword">ON</span> 表连接条件 <span class="token keyword">WHERE</span> 查询条件<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<p>具体操作：</p>
<ul>
<li>查询唐僧的信息，显示员工id，姓名，性别，工资和所在的部门名称，我们发现需要联合2张表同时才能查询出需要的数据，我们使用内连接</li>
</ul>
<p><img src="MySQL-03.assets/1596878075367.png" alt="1596878075367"></p>
<ol>
<li>确定查询哪些表</li>
</ol>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tab_dept <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> tab_emp<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="MySQL-03.assets/1596878084662.png" alt="1596878084662"></p>
<ol start="2">
<li>确定表连接条件，员工表.dept_id = 部门表.id 的数据才是有效的</li>
</ol>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tab_dept <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> tab_emp <span class="token keyword">ON</span> tab_emp<span class="token punctuation">.</span><span class="token punctuation">`</span>dept_id<span class="token punctuation">`</span><span class="token operator">=</span>tab_dept<span class="token punctuation">.</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="MySQL-03.assets/1596878094431.png" alt="1596878094431"></p>
<ol start="3">
<li>确定查询条件，我们查询的是唐僧的信息，部门表.name=’唐僧’</li>
</ol>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tab_dept <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> tab_emp <span class="token keyword">ON</span> tab_emp<span class="token punctuation">.</span><span class="token punctuation">`</span>dept_id<span class="token punctuation">`</span><span class="token operator">=</span>tab_dept<span class="token punctuation">.</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token operator">AND</span> tab_emp<span class="token punctuation">.</span><span class="token punctuation">`</span>NAME<span class="token punctuation">`</span><span class="token operator">=</span><span class="token string">'唐僧'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="MySQL-03.assets/1596878102409.png" alt="1596878102409"></p>
<ol start="4">
<li>确定查询字段，查询唐僧的信息，显示员工id，姓名，性别，工资和所在的部门名称</li>
</ol>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> tab_emp<span class="token punctuation">.</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">,</span> tab_emp<span class="token punctuation">.</span><span class="token punctuation">`</span>NAME<span class="token punctuation">`</span><span class="token punctuation">,</span> tab_emp<span class="token punctuation">.</span><span class="token punctuation">`</span>gender<span class="token punctuation">`</span><span class="token punctuation">,</span> tab_emp<span class="token punctuation">.</span><span class="token punctuation">`</span>salary<span class="token punctuation">`</span><span class="token punctuation">,</span> tab_dept<span class="token punctuation">.</span><span class="token punctuation">`</span>NAME<span class="token punctuation">`</span> <span class="token keyword">FROM</span> tab_dept <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> tab_emp <span class="token keyword">ON</span> tab_emp<span class="token punctuation">.</span><span class="token punctuation">`</span>dept_id<span class="token punctuation">`</span><span class="token operator">=</span>tab_dept<span class="token punctuation">.</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token operator">AND</span> tab_emp<span class="token punctuation">.</span><span class="token punctuation">`</span>NAME<span class="token punctuation">`</span><span class="token operator">=</span><span class="token string">'唐僧'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="MySQL-03.assets/1596878110752.png" alt="1596878110752"></p>
<ol start="5">
<li>我们发现写表名有点长，可以给表取别名，显示的字段名也使用别名</li>
</ol>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> e<span class="token punctuation">.</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span> 员工编号<span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token punctuation">`</span>NAME<span class="token punctuation">`</span> 员工姓名<span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token punctuation">`</span>gender<span class="token punctuation">`</span> 性别<span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token punctuation">`</span>salary<span class="token punctuation">`</span> 工资<span class="token punctuation">,</span> d<span class="token punctuation">.</span><span class="token punctuation">`</span>NAME<span class="token punctuation">`</span> 部门名称 <span class="token keyword">FROM</span> tab_dept d <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> tab_emp e <span class="token keyword">ON</span> e<span class="token punctuation">.</span><span class="token punctuation">`</span>dept_id<span class="token punctuation">`</span><span class="token operator">=</span>d<span class="token punctuation">.</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token operator">AND</span> e<span class="token punctuation">.</span><span class="token punctuation">`</span>NAME<span class="token punctuation">`</span><span class="token operator">=</span><span class="token string">'唐僧'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="MySQL-03.assets/1596878125491.png" alt="1596878125491"></p>
<h3 id="小结-2"><a href="#小结-2" class="headerlink" title="小结"></a>小结</h3><ol>
<li><p>隐式内连接和显示内连接的格式？<br>隐式内连接</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> 表<span class="token number">1</span><span class="token punctuation">,</span> 表<span class="token number">2</span> <span class="token keyword">WHERE</span> 条件<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>显示内连接(建议)</p>
<pre class="line-numbers language-none"><code class="language-none">SELECT * FROM 表1 INNER JOIN 表2 ON 表连接条件 WHERE 查询条件;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


</li>
</ol>
<h2 id="表连接查询-左外连接-重要"><a href="#表连接查询-左外连接-重要" class="headerlink" title="表连接查询-左外连接(重要)"></a>表连接查询-左外连接(重要)</h2><h3 id="目标-3"><a href="#目标-3" class="headerlink" title="目标"></a>目标</h3><p>学习左外连接查询</p>
<h3 id="讲解"><a href="#讲解" class="headerlink" title="讲解"></a>讲解</h3><p>左外连接：使用<code>LEFT OUTER JOIN ... ON</code>，<code>OUTER</code>可以省略</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> 左表 <span class="token keyword">LEFT</span> <span class="token keyword">OUTER</span> <span class="token keyword">JOIN</span> 右表 <span class="token keyword">ON</span> 表连接条件 <span class="token keyword">WHERE</span> 查询条件<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>左外连接</strong>可以理解为：<strong>将满足要求的数据显示,左表不满足要求的数据也显示</strong>(保证左表的数据全部显示)</p>
<p><img src="MySQL-03.assets/1568680825033.png" alt="1568680825033"></p>
<p>具体操作：</p>
<ul>
<li>在部门表中增加一个销售部</li>
</ul>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tab_dept <span class="token punctuation">(</span>NAME<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'销售部'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="MySQL-03.assets/1596878135311.png" alt="1596878135311"></p>
<ul>
<li>使用内连接查询</li>
</ul>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tab_dept <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> tab_emp <span class="token keyword">ON</span> tab_emp<span class="token punctuation">.</span><span class="token punctuation">`</span>dept_id<span class="token punctuation">`</span><span class="token operator">=</span>tab_dept<span class="token punctuation">.</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="MySQL-03.assets/1596878161575.png" alt="1596878161575"></p>
<ul>
<li>使用左外连接查询</li>
</ul>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tab_dept <span class="token keyword">LEFT</span> <span class="token keyword">OUTER</span> <span class="token keyword">JOIN</span> tab_emp <span class="token keyword">ON</span> tab_emp<span class="token punctuation">.</span><span class="token punctuation">`</span>dept_id<span class="token punctuation">`</span><span class="token operator">=</span>tab_dept<span class="token punctuation">.</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="MySQL-03.assets/1596878174967.png" alt="1596878174967"></p>
<h3 id="小结-3"><a href="#小结-3" class="headerlink" title="小结"></a>小结</h3><ol>
<li><p>左外连接查询格式？</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> 左表 <span class="token keyword">LEFT</span> <span class="token keyword">OUTER</span> <span class="token keyword">JOIN</span> 右表 <span class="token keyword">ON</span> 表连接条件 <span class="token keyword">WHERE</span> 查询条件<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li><p>左外连接查询特点？</p>
<pre class="line-numbers language-none"><code class="language-none">满足条件的数据显示,左表不满足条件的也显示<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="MySQL-03.assets/1568680825033.png" alt="1568680825033"></p>
</li>
</ol>
<h2 id="表连接查询-右外连接"><a href="#表连接查询-右外连接" class="headerlink" title="表连接查询-右外连接"></a>表连接查询-右外连接</h2><h3 id="目标-4"><a href="#目标-4" class="headerlink" title="目标"></a>目标</h3><p>学习右外连接查询</p>
<h3 id="讲解-1"><a href="#讲解-1" class="headerlink" title="讲解"></a>讲解</h3><p>右外连接：使用<code>RIGHT OUTER JOIN ... ON</code>，<code>OUTER</code>可以省略</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> 左表 <span class="token keyword">RIGHT</span> <span class="token keyword">OUTER</span> <span class="token keyword">JOIN</span> 右表 <span class="token keyword">ON</span> 表连接条件 <span class="token keyword">WHERE</span> 查询条件<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>右外连接</strong>可以理解为：<strong>满足要求的数据显示,并且右表不满足要求的数据也显示</strong>(在内连接的基础上保证右边的数据全部显示)</p>
<p><img src="MySQL-03.assets/1568680885793.png" alt="1568680885793"></p>
<p>具体操作：</p>
<ul>
<li>在员工表中增加一个员工</li>
</ul>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tab_emp<span class="token punctuation">(</span>NAME<span class="token punctuation">,</span>gender<span class="token punctuation">,</span>salary<span class="token punctuation">,</span>join_date<span class="token punctuation">,</span>dept_id<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'沙僧'</span><span class="token punctuation">,</span><span class="token string">'男'</span><span class="token punctuation">,</span><span class="token number">6666</span><span class="token punctuation">,</span><span class="token string">'2013-02-24'</span><span class="token punctuation">,</span><span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>  <img src="MySQL-03.assets/1596878191470.png" alt="1596878191470"></p>
<ul>
<li>使用内连接查询</li>
</ul>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tab_dept <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> tab_emp <span class="token keyword">ON</span> tab_emp<span class="token punctuation">.</span><span class="token punctuation">`</span>dept_id<span class="token punctuation">`</span><span class="token operator">=</span>tab_dept<span class="token punctuation">.</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>  <img src="MySQL-03.assets/1596878204064.png" alt="1596878204064"></p>
<ul>
<li>使用右外连接查询</li>
</ul>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tab_dept <span class="token keyword">RIGHT</span> <span class="token keyword">OUTER</span> <span class="token keyword">JOIN</span> tab_emp <span class="token keyword">ON</span> tab_emp<span class="token punctuation">.</span><span class="token punctuation">`</span>dept_id<span class="token punctuation">`</span><span class="token operator">=</span>tab_dept<span class="token punctuation">.</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>  <img src="MySQL-03.assets/1596878216673.png" alt="1596878216673"></p>
<h3 id="小结-4"><a href="#小结-4" class="headerlink" title="小结"></a>小结</h3><ol>
<li><p>右外连接查询格式？</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> 左表 <span class="token keyword">RIGHT</span> <span class="token keyword">OUTER</span> <span class="token keyword">JOIN</span> 右表 <span class="token keyword">ON</span> 表连接条件 <span class="token keyword">WHERE</span> 查询条件<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li><p>右外连接查询特点？</p>
<pre class="line-numbers language-none"><code class="language-none">满足条件的显示,保证右表不满足条件的数据也显示<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="MySQL-03.assets/1568680885793.png" alt="1568680885793"></p>
</li>
</ol>
<h2 id="子查询介绍"><a href="#子查询介绍" class="headerlink" title="子查询介绍"></a>子查询介绍</h2><h3 id="目标-5"><a href="#目标-5" class="headerlink" title="目标"></a>目标</h3><p>学习子查询的概念</p>
<p>了解子查询的三种情况</p>
<h4 id="什么是子查询"><a href="#什么是子查询" class="headerlink" title="什么是子查询"></a>什么是子查询</h4><p><font color="red"><strong>一个查询语句的结果作为另一个查询语句的一部分</strong></font></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> 查询字段 <span class="token keyword">FROM</span> 表 <span class="token keyword">WHERE</span> 条件<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employee <span class="token keyword">WHERE</span> salary<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">FROM</span> employee<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="MySQL-03.assets/1596878229342.png" alt="1596878229342"><br>子查询需要放在（）中<br>先执行子查询，将子查询的结果作为父查询的一部分</p>
<h4 id="子查询结果的三种情况"><a href="#子查询结果的三种情况" class="headerlink" title="子查询结果的三种情况"></a>子查询结果的三种情况</h4><ol>
<li>子查询的结果是单行单列的时候<br><img src="MySQL-03.assets/1596878239302.png" alt="1596878239302"></li>
<li>子查询的结果是多行单列的时候<br><img src="MySQL-03.assets/1596878247118.png" alt="1596878247118"></li>
<li>子查询的结果是多行多列<br><img src="MySQL-03.assets/1596878254767.png" alt="1596878254767"></li>
</ol>
<h3 id="小结-5"><a href="#小结-5" class="headerlink" title="小结"></a>小结</h3><ol>
<li><p>什么是子查询？</p>
<pre class="line-numbers language-none"><code class="language-none">一个查询语句的结果作为另一个查询语句的一部分<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


</li>
</ol>
<ol start="2">
<li><p>子查询结果的三种情况？</p>
<pre class="line-numbers language-none"><code class="language-none">单行单列
多行单列
多行多列<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


</li>
</ol>
<h2 id="子查询的结果是单行单列-重要"><a href="#子查询的结果是单行单列-重要" class="headerlink" title="子查询的结果是单行单列(重要)"></a>子查询的结果是单行单列(重要)</h2><h3 id="目标-6"><a href="#目标-6" class="headerlink" title="目标"></a>目标</h3><p>学习子查询的结果是单行单列的查询</p>
<h3 id="讲解-2"><a href="#讲解-2" class="headerlink" title="讲解"></a>讲解</h3><p>子查询结果是<code>单列</code>，在<code>WHERE</code>后面作为<code>条件</code><br><code>SELECT 查询字段 FROM 表 WHERE 字段=(子查询);</code></p>
<ol>
<li><p><strong>查询工资最高的员工是谁？</strong> </p>
<ol>
<li>查询最高工资是多少</li>
</ol>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">FROM</span> tab_emp<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>  <img src="MySQL-03.assets/1596878263947.png" alt="1596878263947"></p>
<ol>
<li>根据最高工资到员工表查询到对应的员工信息</li>
</ol>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tab_emp <span class="token keyword">WHERE</span> salary<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">FROM</span> tab_emp<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>  <img src="MySQL-03.assets/1596878271863.png" alt="1596878271863"></p>
</li>
<li><p><strong>查询工资小于平均工资的员工有哪些？</strong></p>
<ol>
<li>查询平均工资是多少</li>
</ol>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">FROM</span> tab_emp<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>  <img src="MySQL-03.assets/1596878281611.png" alt="1596878281611"></p>
<ol>
<li>到员工表查询小于平均的员工信息</li>
</ol>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tab_emp <span class="token keyword">WHERE</span> salary <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">FROM</span> tab_emp<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>  <img src="MySQL-03.assets/1596878288489.png" alt="1596878288489"></p>
</li>
</ol>
<h3 id="小结-6"><a href="#小结-6" class="headerlink" title="小结"></a>小结</h3><p>子查询的结果是单行单列时父查询如何处理？</p>
<pre class="line-numbers language-none"><code class="language-none">放在where后面作为条件 可以使用 = &lt; &gt;处理<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h2 id="子查询结果是多行单列-重要"><a href="#子查询结果是多行单列-重要" class="headerlink" title="子查询结果是多行单列(重要)"></a>子查询结果是多行单列(重要)</h2><h3 id="目标-7"><a href="#目标-7" class="headerlink" title="目标"></a>目标</h3><p>学习子查询的结果是多行单列的查询</p>
<h3 id="讲解-3"><a href="#讲解-3" class="headerlink" title="讲解"></a>讲解</h3><p>子查询结果是多行单列，结果集类似于一个数组，在<code>WHERE</code>后面作为<code>条件</code>，父查询使用<code>IN</code>运算符</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> 查询字段 <span class="token keyword">FROM</span> 表 <span class="token keyword">WHERE</span> 字段 <span class="token operator">IN</span> <span class="token punctuation">(</span>子查询<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol>
<li><p><strong>查询工资大于5000的员工，来自于哪些部门的名字</strong>  </p>
<ol>
<li>先查询大于5000的员工所在的部门id</li>
</ol>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> dept_id <span class="token keyword">FROM</span> tab_emp <span class="token keyword">WHERE</span> salary <span class="token operator">&gt;</span> <span class="token number">5000</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>  <img src="MySQL-03.assets/1596878300366.png" alt="1596878300366"></p>
<ol>
<li>再查询在这些部门id中部门的名字</li>
</ol>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> tab_dept<span class="token punctuation">.</span>name <span class="token keyword">FROM</span> tab_dept <span class="token keyword">WHERE</span> tab_dept<span class="token punctuation">.</span>id <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> dept_id <span class="token keyword">FROM</span> tab_emp <span class="token keyword">WHERE</span> salary <span class="token operator">&gt;</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>  <img src="MySQL-03.assets/1596878310903.png" alt="1596878310903"></p>
</li>
</ol>
<h3 id="小结-7"><a href="#小结-7" class="headerlink" title="小结"></a>小结</h3><p>子查询的结果是多行单列时父查询如何处理？</p>
<pre class="line-numbers language-none"><code class="language-none">作为父查询的条件, 多个值使用IN来处理<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<h2 id="子查询的结果是多行多列-了解"><a href="#子查询的结果是多行多列-了解" class="headerlink" title="子查询的结果是多行多列(了解)"></a>子查询的结果是多行多列(了解)</h2><h3 id="目标-8"><a href="#目标-8" class="headerlink" title="目标"></a>目标</h3><p>学习子查询的结果是多行多列的查询</p>
<h3 id="讲解-4"><a href="#讲解-4" class="headerlink" title="讲解"></a>讲解</h3><p>子查询结果是<code>多列</code>，在<code>FROM</code>后面作为<code>虚拟表</code> </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> 查询字段 <span class="token keyword">FROM</span> （子查询） 表别名 <span class="token keyword">WHERE</span> 条件<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>子查询作为表需要取别名，否则这张表没有名称无法访问表中的字段</p>
<ul>
<li><p><strong>查询出2011年以后入职的员工信息，包括部门名称</strong></p>
<ol>
<li>在员工表中查询2011-1-1以后入职的员工</li>
</ol>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tab_emp <span class="token keyword">WHERE</span> join_date <span class="token operator">&gt;</span> <span class="token string">'2011-1-1'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="MySQL-03.assets/1596878320163.png" alt="1596878320163"></p>
<ol>
<li>查询所有的部门信息，与上面的虚拟表中的信息组合，找出所有部门id等于dept_id</li>
</ol>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tab_dept d<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tab_emp <span class="token keyword">WHERE</span> join_date <span class="token operator">&gt;</span> <span class="token string">'2011-1-1'</span><span class="token punctuation">)</span> e <span class="token keyword">WHERE</span> e<span class="token punctuation">.</span>dept_id <span class="token operator">=</span> d<span class="token punctuation">.</span>id<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="MySQL-03.assets/1596878331488.png" alt="1596878331488"></p>
</li>
</ul>
<h3 id="小结-8"><a href="#小结-8" class="headerlink" title="小结"></a>小结</h3><p>三种子查询情况：</p>
<pre class="line-numbers language-none"><code class="language-none">1.单行单列
2.多行单列
3.多行多列<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>



<h2 id="多表查询案例"><a href="#多表查询案例" class="headerlink" title="多表查询案例"></a>多表查询案例</h2><p>我们在公司开发中，根据不同的业务需求往往需要通过2张及以上的表中去查询需要的数据。所以我们有必要学习2张及以上的表的查询。其实不管是几张表的查询，都是有规律可循的。</p>
<h3 id="准备数据-1"><a href="#准备数据-1" class="headerlink" title="准备数据"></a>准备数据</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 部门表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> dept <span class="token punctuation">(</span>
  id <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span> <span class="token comment">-- 部门id</span>
  dname <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">-- 部门名称</span>
  loc <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token comment">-- 部门位置</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 添加4个部门</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> dept<span class="token punctuation">(</span>id<span class="token punctuation">,</span>dname<span class="token punctuation">,</span>loc<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> 
<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token string">'教研部'</span><span class="token punctuation">,</span><span class="token string">'北京'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token string">'学工部'</span><span class="token punctuation">,</span><span class="token string">'上海'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token string">'销售部'</span><span class="token punctuation">,</span><span class="token string">'广州'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token string">'财务部'</span><span class="token punctuation">,</span><span class="token string">'深圳'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 职务表，职务名称，职务描述</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> job <span class="token punctuation">(</span>
  id <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
  jname <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  description <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 添加4个职务</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> job <span class="token punctuation">(</span>id<span class="token punctuation">,</span> jname<span class="token punctuation">,</span> description<span class="token punctuation">)</span> <span class="token keyword">VALUES</span>
<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'董事长'</span><span class="token punctuation">,</span> <span class="token string">'管理整个公司，接单'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'经理'</span><span class="token punctuation">,</span> <span class="token string">'管理部门员工'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'销售员'</span><span class="token punctuation">,</span> <span class="token string">'向客人推销产品'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">'文员'</span><span class="token punctuation">,</span> <span class="token string">'使用办公软件'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 员工表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> emp <span class="token punctuation">(</span>
  id <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span> <span class="token comment">-- 员工id</span>
  ename <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">-- 员工姓名</span>
  job_id <span class="token keyword">INT</span><span class="token punctuation">,</span> <span class="token comment">-- 职务id</span>
  mgr <span class="token keyword">INT</span> <span class="token punctuation">,</span> <span class="token comment">-- 上级领导</span>
  joindate <span class="token keyword">DATE</span><span class="token punctuation">,</span> <span class="token comment">-- 入职日期</span>
  salary <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">-- 工资</span>
  bonus <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">-- 奖金</span>
  dept_id <span class="token keyword">INT</span><span class="token punctuation">,</span> <span class="token comment">-- 所在部门编号</span>
  <span class="token keyword">CONSTRAINT</span> emp_jobid_ref_job_id_fk <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>job_id<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> job <span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">CONSTRAINT</span> emp_deptid_ref_dept_id_fk <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>dept_id<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> dept <span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 添加员工</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> emp<span class="token punctuation">(</span>id<span class="token punctuation">,</span>ename<span class="token punctuation">,</span>job_id<span class="token punctuation">,</span>mgr<span class="token punctuation">,</span>joindate<span class="token punctuation">,</span>salary<span class="token punctuation">,</span>bonus<span class="token punctuation">,</span>dept_id<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> 
<span class="token punctuation">(</span><span class="token number">1001</span><span class="token punctuation">,</span><span class="token string">'孙悟空'</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">1004</span><span class="token punctuation">,</span><span class="token string">'2000-12-17'</span><span class="token punctuation">,</span><span class="token string">'8000.00'</span><span class="token punctuation">,</span><span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">1002</span><span class="token punctuation">,</span><span class="token string">'卢俊义'</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1006</span><span class="token punctuation">,</span><span class="token string">'2001-02-20'</span><span class="token punctuation">,</span><span class="token string">'16000.00'</span><span class="token punctuation">,</span><span class="token string">'3000.00'</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">1003</span><span class="token punctuation">,</span><span class="token string">'林冲'</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1006</span><span class="token punctuation">,</span><span class="token string">'2001-02-22'</span><span class="token punctuation">,</span><span class="token string">'12500.00'</span><span class="token punctuation">,</span><span class="token string">'5000.00'</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">1004</span><span class="token punctuation">,</span><span class="token string">'唐僧'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1009</span><span class="token punctuation">,</span><span class="token string">'2001-04-02'</span><span class="token punctuation">,</span><span class="token string">'29750.00'</span><span class="token punctuation">,</span><span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">1005</span><span class="token punctuation">,</span><span class="token string">'李逵'</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">1006</span><span class="token punctuation">,</span><span class="token string">'2001-09-28'</span><span class="token punctuation">,</span><span class="token string">'12500.00'</span><span class="token punctuation">,</span><span class="token string">'14000.00'</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">1006</span><span class="token punctuation">,</span><span class="token string">'宋江'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1009</span><span class="token punctuation">,</span><span class="token string">'2001-05-01'</span><span class="token punctuation">,</span><span class="token string">'28500.00'</span><span class="token punctuation">,</span><span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">1007</span><span class="token punctuation">,</span><span class="token string">'刘备'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1009</span><span class="token punctuation">,</span><span class="token string">'2001-09-01'</span><span class="token punctuation">,</span><span class="token string">'24500.00'</span><span class="token punctuation">,</span><span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">1008</span><span class="token punctuation">,</span><span class="token string">'猪八戒'</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">1004</span><span class="token punctuation">,</span><span class="token string">'2007-04-19'</span><span class="token punctuation">,</span><span class="token string">'30000.00'</span><span class="token punctuation">,</span><span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">1009</span><span class="token punctuation">,</span><span class="token string">'罗贯中'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token string">'2001-11-17'</span><span class="token punctuation">,</span><span class="token string">'50000.00'</span><span class="token punctuation">,</span><span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">1010</span><span class="token punctuation">,</span><span class="token string">'吴用'</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1006</span><span class="token punctuation">,</span><span class="token string">'2001-09-08'</span><span class="token punctuation">,</span><span class="token string">'15000.00'</span><span class="token punctuation">,</span><span class="token string">'0.00'</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">1011</span><span class="token punctuation">,</span><span class="token string">'沙僧'</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">1004</span><span class="token punctuation">,</span><span class="token string">'2007-05-23'</span><span class="token punctuation">,</span><span class="token string">'11000.00'</span><span class="token punctuation">,</span><span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">1012</span><span class="token punctuation">,</span><span class="token string">'李逵'</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">1006</span><span class="token punctuation">,</span><span class="token string">'2001-12-03'</span><span class="token punctuation">,</span><span class="token string">'9500.00'</span><span class="token punctuation">,</span><span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">1013</span><span class="token punctuation">,</span><span class="token string">'小白龙'</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">1004</span><span class="token punctuation">,</span><span class="token string">'2001-12-03'</span><span class="token punctuation">,</span><span class="token string">'30000.00'</span><span class="token punctuation">,</span><span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">1014</span><span class="token punctuation">,</span><span class="token string">'关羽'</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">1007</span><span class="token punctuation">,</span><span class="token string">'2002-01-23'</span><span class="token punctuation">,</span><span class="token string">'13000.00'</span><span class="token punctuation">,</span><span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 工资等级表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> salarygrade <span class="token punctuation">(</span>
  grade <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
  losalary <span class="token keyword">INT</span><span class="token punctuation">,</span>
  hisalary <span class="token keyword">INT</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 添加5个工资等级</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> salarygrade<span class="token punctuation">(</span>grade<span class="token punctuation">,</span>losalary<span class="token punctuation">,</span>hisalary<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> 
<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">7000</span><span class="token punctuation">,</span><span class="token number">12000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">12010</span><span class="token punctuation">,</span><span class="token number">14000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">14010</span><span class="token punctuation">,</span><span class="token number">20000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">20010</span><span class="token punctuation">,</span><span class="token number">30000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">30010</span><span class="token punctuation">,</span><span class="token number">99990</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>分析4张表的关系：通过4张表可以查出一个员工的所有信息<br><img src="MySQL-03.assets/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A201.png"></p>
<h2 id="练习1"><a href="#练习1" class="headerlink" title="练习1"></a>练习1</h2><h3 id="目标-9"><a href="#目标-9" class="headerlink" title="目标"></a>目标</h3><p>查询所有员工信息。显示员工编号，员工姓名，工资，职务名称，职务描述，部门名称，部门位置</p>
<h3 id="讲解-5"><a href="#讲解-5" class="headerlink" title="讲解"></a>讲解</h3><p>具体操作：</p>
<ol>
<li><p>确定要查询哪些表，emp e, job j, dept d</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> emp e <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> job j <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> dept d<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="MySQL-03.assets/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A206.png"><br><img src="MySQL-03.assets/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A207.png"></p>
</li>
<li><p>确定表连接条件 e.job_id=j.id and e.dept_id=d.id</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> emp e <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> job j <span class="token keyword">ON</span> e<span class="token punctuation">.</span>job_id<span class="token operator">=</span>j<span class="token punctuation">.</span>id <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> dept d <span class="token keyword">ON</span> e<span class="token punctuation">.</span>dept_id<span class="token operator">=</span>d<span class="token punctuation">.</span>id<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="MySQL-03.assets/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A208.png"><br><img src="MySQL-03.assets/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A209.png"></p>
</li>
<li><p>确定查询字段：员工编号，员工姓名，工资，职务名称，职务描述，部门名称，部门位置</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> e<span class="token punctuation">.</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token punctuation">`</span>ename<span class="token punctuation">`</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token punctuation">`</span>salary<span class="token punctuation">`</span><span class="token punctuation">,</span> j<span class="token punctuation">.</span><span class="token punctuation">`</span>jname<span class="token punctuation">`</span><span class="token punctuation">,</span> j<span class="token punctuation">.</span><span class="token punctuation">`</span>description<span class="token punctuation">`</span><span class="token punctuation">,</span> d<span class="token punctuation">.</span><span class="token punctuation">`</span>dname<span class="token punctuation">`</span><span class="token punctuation">,</span> d<span class="token punctuation">.</span><span class="token punctuation">`</span>loc<span class="token punctuation">`</span> <span class="token keyword">FROM</span> emp e <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> job j <span class="token keyword">ON</span> e<span class="token punctuation">.</span>job_id<span class="token operator">=</span>j<span class="token punctuation">.</span>id <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> dept d <span class="token keyword">ON</span> e<span class="token punctuation">.</span>dept_id<span class="token operator">=</span>d<span class="token punctuation">.</span>id<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="MySQL-03.assets/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A210.png"></p>
</li>
</ol>
<h2 id="练习2"><a href="#练习2" class="headerlink" title="练习2"></a>练习2</h2><h3 id="目标-10"><a href="#目标-10" class="headerlink" title="目标"></a>目标</h3><p>查询经理的信息。显示员工姓名，工资，职务名称，职务描述，部门名称，部门位置，工资等级</p>
<h3 id="讲解-6"><a href="#讲解-6" class="headerlink" title="讲解"></a>讲解</h3><p>具体操作：</p>
<ol>
<li><p>确定要查询哪些表，emp e, job j, dept d, salarygrade s</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> emp e <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> job j <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> dept d <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> salarygrade s<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="MySQL-03.assets/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A211.png"><br><img src="MySQL-03.assets/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A212.png"></p>
</li>
<li><p>确定表连接条件 e.job_id=j.id and e.dept_id=d.id and e.salary between s.losalary and s.hisalary</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> emp e <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> job j <span class="token keyword">ON</span> e<span class="token punctuation">.</span>job_id<span class="token operator">=</span>j<span class="token punctuation">.</span>id <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> dept d <span class="token keyword">ON</span> e<span class="token punctuation">.</span>dept_id<span class="token operator">=</span>d<span class="token punctuation">.</span>id <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> salarygrade s  <span class="token keyword">ON</span> e<span class="token punctuation">.</span>salary <span class="token operator">BETWEEN</span> s<span class="token punctuation">.</span>losalary <span class="token operator">AND</span> s<span class="token punctuation">.</span>hisalary<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="MySQL-03.assets/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A213.png"><br><img src="MySQL-03.assets/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A214.png"></p>
<p>额外条件：只需要查询经理的信息（j.jname=’经理’）<br><img src="MySQL-03.assets/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A216.png"></p>
</li>
<li><p>确定查询字段：员工姓名，工资，职务名称，职务描述，部门名称，部门位置，工资等级</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> e<span class="token punctuation">.</span><span class="token punctuation">`</span>ename<span class="token punctuation">`</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token punctuation">`</span>salary<span class="token punctuation">`</span><span class="token punctuation">,</span> j<span class="token punctuation">.</span><span class="token punctuation">`</span>jname<span class="token punctuation">`</span><span class="token punctuation">,</span> j<span class="token punctuation">.</span><span class="token punctuation">`</span>description<span class="token punctuation">`</span><span class="token punctuation">,</span> d<span class="token punctuation">.</span><span class="token punctuation">`</span>dname<span class="token punctuation">`</span><span class="token punctuation">,</span> d<span class="token punctuation">.</span><span class="token punctuation">`</span>loc<span class="token punctuation">`</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span><span class="token punctuation">`</span>grade<span class="token punctuation">`</span> <span class="token keyword">FROM</span> emp e <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> job j <span class="token keyword">ON</span> e<span class="token punctuation">.</span>job_id<span class="token operator">=</span>j<span class="token punctuation">.</span>id <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> dept d <span class="token keyword">ON</span> e<span class="token punctuation">.</span>dept_id<span class="token operator">=</span>d<span class="token punctuation">.</span>id <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> salarygrade s  <span class="token keyword">ON</span> e<span class="token punctuation">.</span>salary <span class="token operator">BETWEEN</span> s<span class="token punctuation">.</span>losalary <span class="token operator">AND</span> s<span class="token punctuation">.</span>hisalary <span class="token operator">AND</span> j<span class="token punctuation">.</span>jname<span class="token operator">=</span><span class="token string">'经理'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="MySQL-03.assets/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A217.png"></p>
</li>
</ol>
<h2 id="练习3"><a href="#练习3" class="headerlink" title="练习3"></a>练习3</h2><h3 id="目标-11"><a href="#目标-11" class="headerlink" title="目标"></a>目标</h3><p>查询出部门编号、部门名称、部门位置、部门人数</p>
<h3 id="讲解-7"><a href="#讲解-7" class="headerlink" title="讲解"></a>讲解</h3><p>具体操作：</p>
<ol>
<li><p>去员工表中找到每个部门的人数和部门id</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> dept_id<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> emp <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> dept_id<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="MySQL-03.assets/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A218.png"></p>
</li>
<li><p>再和部门表连接查询</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> dept d <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> dept_id<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> emp <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> dept_id<span class="token punctuation">)</span> e <span class="token keyword">ON</span> e<span class="token punctuation">.</span>dept_id<span class="token operator">=</span>d<span class="token punctuation">.</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="MySQL-03.assets/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A219.png"><br><img src="MySQL-03.assets/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A220.png"></p>
</li>
<li><p>显示对应的字段</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> d<span class="token punctuation">.</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">,</span> d<span class="token punctuation">.</span>dname<span class="token punctuation">,</span> d<span class="token punctuation">.</span><span class="token punctuation">`</span>loc<span class="token punctuation">`</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>total 部门人数 <span class="token keyword">FROM</span> dept d <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> dept_id<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> total <span class="token keyword">FROM</span> emp <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> dept_id<span class="token punctuation">)</span> e <span class="token keyword">ON</span> e<span class="token punctuation">.</span>dept_id<span class="token operator">=</span>d<span class="token punctuation">.</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="MySQL-03.assets/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A221.png"><br>最终效果：<br><img src="MySQL-03.assets/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A222.png"></p>
</li>
</ol>
<h3 id="小结-9"><a href="#小结-9" class="headerlink" title="小结"></a>小结</h3><p>多表查询3个步骤</p>
<ol>
<li>明确查询哪些表</li>
<li>明确表连接条件</li>
<li>其他的查询</li>
</ol>
<h2 id="练习4"><a href="#练习4" class="headerlink" title="练习4"></a>练习4</h2><h3 id="目标-12"><a href="#目标-12" class="headerlink" title="目标"></a>目标</h3><p>列出所有员工的姓名及其直接上级的姓名，没有领导的员工也需要显示</p>
<h3 id="讲解-8"><a href="#讲解-8" class="headerlink" title="讲解"></a>讲解</h3><p>具体操作：<br>   <img src="MySQL-03.assets/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A233.png"></p>
<pre><code>1. 确定要查询哪些表，emp e, emp m</code></pre>
   <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> emp e <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> emp m<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>   <img src="MySQL-03.assets/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A234.png"></p>
<pre><code>2. 确定表连接条件 e.mgr=e2.id</code></pre>
   <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> emp e <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> emp m <span class="token keyword">ON</span> e<span class="token punctuation">.</span><span class="token punctuation">`</span>mgr<span class="token punctuation">`</span><span class="token operator">=</span>m<span class="token punctuation">.</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> emp e <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> emp m <span class="token keyword">ON</span> e<span class="token punctuation">.</span><span class="token punctuation">`</span>mgr<span class="token punctuation">`</span><span class="token operator">=</span>m<span class="token punctuation">.</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>   <img src="MySQL-03.assets/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A235.png"></p>
<p><strong>我们发现少了一条数据，因为罗贯中是董事长没有上司</strong><br>没有领导的员工也需要显示，所以左表的数据需要全部显示。使用左外连接<br><img src="MySQL-03.assets/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A236.png"></p>
<pre><code>3. 确定查询字段：员工的姓名及其直接上级的姓名</code></pre>
   <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> e<span class="token punctuation">.</span><span class="token punctuation">`</span>ename<span class="token punctuation">`</span><span class="token punctuation">,</span> IFNULL<span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token punctuation">`</span>ename<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token string">'没有'</span><span class="token punctuation">)</span> 上司 <span class="token keyword">FROM</span> emp e <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> emp m <span class="token keyword">ON</span> e<span class="token punctuation">.</span><span class="token punctuation">`</span>mgr<span class="token punctuation">`</span><span class="token operator">=</span>m<span class="token punctuation">.</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>   <img src="MySQL-03.assets/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A237.png"></p>
<h2 id="练习5"><a href="#练习5" class="headerlink" title="练习5"></a>练习5</h2><h3 id="目标-13"><a href="#目标-13" class="headerlink" title="目标"></a>目标</h3><p>查询出所有的普通员工，即员工id不在mgr这一列中的员工</p>
<h3 id="讲解-9"><a href="#讲解-9" class="headerlink" title="讲解"></a>讲解</h3><p>具体操作:</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token number">1.</span>	查询所有的管理者的id，去掉重复，并且不能包含<span class="token boolean">null</span>，因为<span class="token boolean">null</span>会导致外查询<span class="token operator">in</span>失效
<span class="token keyword">select</span> <span class="token keyword">distinct</span><span class="token punctuation">(</span>mgr<span class="token punctuation">)</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> mgr <span class="token operator">is</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">;</span>
<span class="token number">2.</span>	查询id不在上面的id中的员工
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> id <span class="token operator">not</span> <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">distinct</span><span class="token punctuation">(</span>mgr<span class="token punctuation">)</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> mgr <span class="token operator">is</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>查询结果</p>
<p><img src="MySQL-03.assets/1596874923045.png" alt="1596874923045"></p>
<h2 id="练习6"><a href="#练习6" class="headerlink" title="练习6"></a>练习6</h2><h3 id="目标-14"><a href="#目标-14" class="headerlink" title="目标"></a>目标</h3><p>查询工资高于公司平均工资的所有员工信息。显示员工信息，部门名称，上级领导，工资等级</p>
<h3 id="讲解-10"><a href="#讲解-10" class="headerlink" title="讲解"></a>讲解</h3><p>具体操作：<br>  <strong>先统计公司平均工资</strong></p>
  <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">FROM</span> emp<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>  <img src="MySQL-03.assets/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A241.png"></p>
<pre><code>1. 确定要查询哪些表，emp e, emp m, dept d, salarygrade s</code></pre>
  <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> emp e <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> emp m <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> dept d <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> salarygrade s<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>  <img src="MySQL-03.assets/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A242.png"></p>
<pre><code>2. 确定表连接条件 e.dept_id=d.id and e.mgr=m.id and e.salary between s.losalary and hisalary and e.salary&gt;公司平均薪金</code></pre>
  <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> emp e <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> emp m <span class="token keyword">ON</span> e<span class="token punctuation">.</span>mgr<span class="token operator">=</span>m<span class="token punctuation">.</span>id <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> dept d <span class="token keyword">ON</span> e<span class="token punctuation">.</span>dept_id<span class="token operator">=</span>d<span class="token punctuation">.</span>id  <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> salarygrade s  <span class="token keyword">ON</span> e<span class="token punctuation">.</span>salary <span class="token operator">BETWEEN</span> s<span class="token punctuation">.</span>losalary <span class="token operator">AND</span> hisalary <span class="token keyword">WHERE</span> e<span class="token punctuation">.</span>salary<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">FROM</span> emp<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>  <img src="MySQL-03.assets/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A243.png"></p>
<pre><code>3. 确定查询字段：员工信息，部门名称，上级领导，工资等级。</code></pre>
  <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> e<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span> d<span class="token punctuation">.</span><span class="token punctuation">`</span>dname<span class="token punctuation">`</span><span class="token punctuation">,</span> m<span class="token punctuation">.</span><span class="token punctuation">`</span>ename<span class="token punctuation">`</span> 上级领导<span class="token punctuation">,</span> s<span class="token punctuation">.</span><span class="token punctuation">`</span>grade<span class="token punctuation">`</span> <span class="token keyword">FROM</span> emp e <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> emp m <span class="token keyword">ON</span> e<span class="token punctuation">.</span>mgr<span class="token operator">=</span>m<span class="token punctuation">.</span>id <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> dept d <span class="token keyword">ON</span> e<span class="token punctuation">.</span>dept_id<span class="token operator">=</span>d<span class="token punctuation">.</span>id  <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> salarygrade s  <span class="token keyword">ON</span> e<span class="token punctuation">.</span>salary <span class="token operator">BETWEEN</span> s<span class="token punctuation">.</span>losalary <span class="token operator">AND</span> hisalary <span class="token keyword">WHERE</span> e<span class="token punctuation">.</span>salary<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">FROM</span> emp<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>  <img src="MySQL-03.assets/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A244.png"></p>
<h2 id="MySQL的索引"><a href="#MySQL的索引" class="headerlink" title="MySQL的索引"></a>MySQL的索引</h2><h3 id="目标-15"><a href="#目标-15" class="headerlink" title="目标"></a>目标</h3><p>了解MySQL的索引作用</p>
<h3 id="讲解-11"><a href="#讲解-11" class="headerlink" title="讲解"></a>讲解</h3><p>索引是用于加速数据存取的数据库对象。合理的使用索引可以提高数据访问性能。</p>
<p>为什么添加了索引之后，会加快查询速度呢？</p>
<p><strong>新华字典：</strong>我们都知道新华字典里面包含了很多汉字，这些汉字就好比我们数据库表里面的数据，那么我们如何快速查找厚厚字典里面具体的一个汉字在那一页呢? 我们会首先看字典的目录,通过目录里面按照拼音或偏旁部首方式快速查找到一个小的区域,之后再到小区域范围内查找到想要的数据，那么这里的字典目录<strong>就是索引</strong>。</p>
<p>索引的好处就是提高你找到数据的速度，但是正是因为你建了索引，就应该有人专门来维护索引，维护索引是要有时间和系统的开销，也就是说索引是不能乱建的。</p>
<p><img src="MySQL-03.assets/1595122715311.png" alt="1595122715311"></p>
<p>数据库查询数据方式</p>
<ol>
<li><p>普通查询数据方式：从数据表第一条位置开始查询，进行逐条查询，直至查找到最后一条，将所有符合的数据找到</p>
</li>
<li><p>索引查询数据方式：先从索引表中查询，定位到大致的区间，再查真实的表</p>
</li>
</ol>
<p><img src="MySQL-03.assets/1595122747351.png" alt="1595122747351"></p>
<h3 id="小结-10"><a href="#小结-10" class="headerlink" title="小结"></a>小结</h3><p>说出索引的作用</p>
<p>提高查询的效率</p>
<h2 id="创建，查看，删除索引"><a href="#创建，查看，删除索引" class="headerlink" title="创建，查看，删除索引"></a>创建，查看，删除索引</h2><h3 id="目标-16"><a href="#目标-16" class="headerlink" title="目标"></a>目标</h3><p>学习索引的创建，查看，删除</p>
<h3 id="讲解-12"><a href="#讲解-12" class="headerlink" title="讲解"></a>讲解</h3><h4 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h4><p>单列索引是基于单个列所建立的索引:</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> 索引名 <span class="token keyword">ON</span> 表名<span class="token punctuation">(</span>字段名<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="查看表中的索引"><a href="#查看表中的索引" class="headerlink" title="查看表中的索引"></a>查看表中的索引</h4><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SHOW</span> <span class="token keyword">INDEX</span> <span class="token keyword">FROM</span> 表名<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a>删除索引</h4><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">DROP</span> <span class="token keyword">INDEX</span> 索引名 <span class="token keyword">ON</span> 表名<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="复合索引（了解）"><a href="#复合索引（了解）" class="headerlink" title="复合索引（了解）"></a>复合索引（了解）</h4><p>复合索引是基于两个列或多个列的索引。在同一张表上可以有多个索引</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> 索引名 <span class="token keyword">ON</span> 表名<span class="token punctuation">(</span>字段名<span class="token number">1</span><span class="token punctuation">,</span> 字段名<span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<h4 id="代码演示"><a href="#代码演示" class="headerlink" title="代码演示"></a>代码演示</h4><p><img src="MySQL-03.assets/1595122992187.png" alt="1595122992187"></p>
<p>创建测试表</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> stu <span class="token punctuation">(</span>
	id <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
	NAME <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	sex <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	address <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>索引操作:</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 显示指定表中所有的索引</span>
<span class="token keyword">SHOW</span> <span class="token keyword">INDEX</span> <span class="token keyword">FROM</span> emp<span class="token punctuation">;</span>

<span class="token comment">-- 用名字创建索引值</span>
<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> idx_name <span class="token keyword">ON</span> emp<span class="token punctuation">(</span>ename<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 删除上面创建的索引</span>
<span class="token keyword">DROP</span> <span class="token keyword">INDEX</span> idx_name <span class="token keyword">ON</span> emp<span class="token punctuation">;</span>

<span class="token comment">-- 创建名字和工资的复合索引(了解)</span>
<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> idx_ename_salary <span class="token keyword">ON</span> emp<span class="token punctuation">(</span>ename<span class="token punctuation">,</span> salary<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 删除复合索引(了解)</span>
<span class="token keyword">DROP</span> <span class="token keyword">INDEX</span> idx_ename_salary <span class="token keyword">ON</span> emp<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="小结-11"><a href="#小结-11" class="headerlink" title="小结"></a>小结</h3><p>创建索引</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> 索引名 <span class="token keyword">ON</span> 表名<span class="token punctuation">(</span>字段名<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>查看索引</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SHOW</span> <span class="token keyword">INDEX</span> <span class="token keyword">FROM</span> 表名<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>删除索引</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">DROP</span> <span class="token keyword">INDEX</span> 索引名 <span class="token keyword">ON</span> 表名<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<h2 id="索引的测试案例"><a href="#索引的测试案例" class="headerlink" title="索引的测试案例"></a>索引的测试案例</h2><h3 id="目标-17"><a href="#目标-17" class="headerlink" title="目标"></a>目标</h3><p>往表中插入2百万级数据，根据索引优化速度</p>
<h4 id="数据准备"><a href="#数据准备" class="headerlink" title="数据准备"></a>数据准备</h4><p><strong>创建表</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> tab_index_test<span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> tab_index_test <span class="token punctuation">(</span>
	id <span class="token keyword">BIGINT</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>  <span class="token comment">-- 主键</span>
	username <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>  <span class="token comment">-- 用户名</span>
	PASSWORD <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span>  <span class="token comment">-- 密码，随机存储一些字符</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span>MYISAM <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>

<span class="token comment">/*为方便快速插入千万条测试数据，使用MYISAM存储引擎，等我们插完数据，再把存储类型修改为InnoDB*/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p><strong>创建存储过程并调用</strong>（下一天会讲解存储过程，要求暂时先复制拷贝即可）</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">DELIMITER</span> $$
<span class="token keyword">DROP</span> <span class="token keyword">PROCEDURE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>insert_data<span class="token punctuation">`</span>$$
<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> <span class="token punctuation">`</span>insert_data<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token operator">IN</span> tableName <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">IN</span> num <span class="token keyword">INT</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
  <span class="token comment">/*定义一个变量，存储当前执行的次数*/</span>
  <span class="token keyword">DECLARE</span> n <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">1</span><span class="token punctuation">;</span> 
  <span class="token keyword">WHILE</span> n <span class="token operator">&lt;=</span> num <span class="token keyword">DO</span>
	<span class="token keyword">SET</span> <span class="token variable">@sqlStr</span> <span class="token operator">=</span> CONCAT<span class="token punctuation">(</span><span class="token string">"INSERT INTO "</span><span class="token punctuation">,</span> tableName<span class="token punctuation">,</span> <span class="token string">"(username, password) VALUES(CONCAT('用户', "</span><span class="token punctuation">,</span> n<span class="token punctuation">,</span> <span class="token string">"), uuid())"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">PREPARE</span> stmt <span class="token keyword">FROM</span> <span class="token variable">@sqlStr</span><span class="token punctuation">;</span>
	<span class="token keyword">EXECUTE</span> stmt<span class="token punctuation">;</span>
	<span class="token keyword">SET</span> n <span class="token operator">=</span> n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">END</span> <span class="token keyword">WHILE</span><span class="token punctuation">;</span>
<span class="token keyword">END</span> $$
<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">-- 插入200万条记录 (大约1分钟左右)</span>
<span class="token keyword">CALL</span> insert_data<span class="token punctuation">(</span><span class="token string">'tab_index_test'</span><span class="token punctuation">,</span><span class="token number">2000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">-- 修改index_test表的引擎为innodb</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>tab_index_test<span class="token punctuation">`</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">INNODB</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p><strong>对比查询效率</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- username没有创建索引速度比较慢</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tab_index_test <span class="token keyword">WHERE</span> username<span class="token operator">=</span><span class="token string">'用户93023'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="MySQL-03.assets/1595123200634.png" alt="1595123200634"></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 为username建立索引</span>
<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> idx_username <span class="token keyword">ON</span> tab_index_test<span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="MySQL-03.assets/1595123217916.png" alt="1595123217916"></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- id是主键，默认有主键索引，查询速度比较快</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tab_index_test <span class="token keyword">WHERE</span> id<span class="token operator">=</span><span class="token number">93023</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="MySQL-03.assets/1595123142875.png" alt="1595123142875"></p>
<h3 id="小结-12"><a href="#小结-12" class="headerlink" title="小结"></a>小结</h3><p>有索引查询快</p>
<h2 id="索引注意事项"><a href="#索引注意事项" class="headerlink" title="索引注意事项"></a>索引注意事项</h2><h3 id="索引的使用原则"><a href="#索引的使用原则" class="headerlink" title="索引的使用原则"></a>索引的使用原则</h3><ol>
<li>在数据量大的表上建立索引才有意义(最起码十万级别数据才会考虑索引)</li>
<li>在经常查询的字段上使用索引，用在where子句后面或者是连接条件上的字段建立索引</li>
<li>表中数据修改频率高时，不建议建立索引（每插入、或者修改一条记录MySQL都要维护索引的顺序，这个过程不需要我们参与，但是非常消耗性能）</li>
</ol>
<h3 id="索引的不足"><a href="#索引的不足" class="headerlink" title="索引的不足"></a>索引的不足</h3><p>索引也有它的缺点：虽然索引大大提高了查询速度，同时却会降低更新表的速度，如对表进行INSERT、UPDATE和DELETE。因为更新表时，MySQL不仅要保存数据，还要保存更新索引文件。建立索引会占用磁盘空间的索引文件。</p>
<h3 id="索引失效的几种情况"><a href="#索引失效的几种情况" class="headerlink" title="索引失效的几种情况"></a>索引失效的几种情况</h3><ol>
<li><p>如果条件中有OR，即使其中有条件带索引也不会使用。(例外：OR两边条件都是同一个字段 )</p>
</li>
<li><p>模糊LIKE查询以 ‘%xxx’开头的不会使用索引，以’xxx%’结尾会使用索引。</p>
</li>
<li><p>WHERE语句中使用不等于 &lt;&gt;和 != 不会使用索引</p>
</li>
<li><p>如果MySQL计算使用全表扫描要比使用索引快，则不使用索引。</p>
</li>
</ol>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 准备数据，创建表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> contact <span class="token punctuation">(</span> 
   id <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span> 
   NAME <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> 
   sex <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
   age <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">UNSIGNED</span><span class="token punctuation">,</span> <span class="token comment">-- 无符号</span>
   address <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">-- 籍贯</span>
   qq <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
   email <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span> 
 <span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">-- 插入记录</span>
<span class="token keyword">INSERT</span>  <span class="token keyword">INTO</span> contact<span class="token punctuation">(</span>NAME<span class="token punctuation">,</span>sex<span class="token punctuation">,</span>age<span class="token punctuation">,</span>address<span class="token punctuation">,</span>qq<span class="token punctuation">,</span>email<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> 
<span class="token punctuation">(</span><span class="token string">'猪八戒'</span><span class="token punctuation">,</span><span class="token string">'男'</span><span class="token punctuation">,</span><span class="token number">25</span><span class="token punctuation">,</span><span class="token string">'广东'</span><span class="token punctuation">,</span><span class="token string">'834523234'</span><span class="token punctuation">,</span><span class="token string">'zhuzhuxia@itcast.cn'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'貂蝉'</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token string">'湖南'</span><span class="token punctuation">,</span><span class="token string">'59869834'</span><span class="token punctuation">,</span><span class="token string">'diaochan@qq.com'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'孙悟空'</span><span class="token punctuation">,</span><span class="token string">'男'</span><span class="token punctuation">,</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token string">'湖南'</span><span class="token punctuation">,</span><span class="token string">'87967822'</span><span class="token punctuation">,</span><span class="token string">'wukong@itheima.com'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'周瑜'</span><span class="token punctuation">,</span><span class="token string">'男'</span><span class="token punctuation">,</span><span class="token number">25</span><span class="token punctuation">,</span><span class="token string">'广西'</span><span class="token punctuation">,</span><span class="token string">'2743759345'</span><span class="token punctuation">,</span><span class="token string">'zhou@163.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> contact<span class="token punctuation">;</span>

<span class="token comment">-- explain的作用：模拟Mysql是如何执行SQL查询语句的，主要查看key这一列，判断是否使用索引</span>

<span class="token comment">-- 没有创建索引的情况，key为null表示不走索引查询数据</span>

<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> contact <span class="token keyword">WHERE</span> NAME<span class="token operator">=</span><span class="token string">'猪八戒'</span><span class="token punctuation">;</span>

<span class="token comment">-- 给名字创建索引</span>
<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> idx_name <span class="token keyword">ON</span> contact<span class="token punctuation">(</span>NAME<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 再执行上面的代码, key为ix_name，表示使用了索引</span>
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> contact <span class="token keyword">WHERE</span> NAME<span class="token operator">=</span><span class="token string">'猪八戒'</span><span class="token punctuation">;</span>


<span class="token comment">-- 查询姓名是孙悟空或地址是湖南的，没有使用索引</span>
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> contact <span class="token keyword">WHERE</span> NAME<span class="token operator">=</span><span class="token string">'孙悟空'</span> <span class="token operator">OR</span> address<span class="token operator">=</span><span class="token string">'湖南'</span><span class="token punctuation">;</span>

<span class="token comment">-- 给地址创建索引</span>
<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> idx_address <span class="token keyword">ON</span> contact<span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 给address创建索引，也是没有使用到索引, OR让索引失效了</span>
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> contact <span class="token keyword">WHERE</span> NAME<span class="token operator">=</span><span class="token string">'孙悟空'</span> <span class="token operator">OR</span> address<span class="token operator">=</span><span class="token string">'湖南'</span><span class="token punctuation">;</span>

<span class="token comment">-- 只查询姓名，因为记录很少，没有使用索引。如果mysql估计使用全表扫描要比使用索引快,则不使用索引</span>
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> contact <span class="token keyword">WHERE</span> NAME<span class="token operator">=</span><span class="token string">'孙悟空'</span> <span class="token operator">OR</span> NAME<span class="token operator">=</span><span class="token string">'猪八戒'</span><span class="token punctuation">;</span>


<span class="token comment">-- 插入记录</span>
<span class="token keyword">INSERT</span>  <span class="token keyword">INTO</span> contact<span class="token punctuation">(</span>NAME<span class="token punctuation">,</span>sex<span class="token punctuation">,</span>age<span class="token punctuation">,</span>address<span class="token punctuation">,</span>qq<span class="token punctuation">,</span>email<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> 
<span class="token punctuation">(</span><span class="token string">'陈宏子'</span><span class="token punctuation">,</span><span class="token string">'男'</span><span class="token punctuation">,</span><span class="token number">21</span><span class="token punctuation">,</span><span class="token string">'广东'</span><span class="token punctuation">,</span><span class="token string">'15811688'</span><span class="token punctuation">,</span><span class="token string">'cheng@126.com'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 <span class="token punctuation">(</span><span class="token string">'秦婷婷'</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">,</span><span class="token number">25</span><span class="token punctuation">,</span><span class="token string">'广东'</span><span class="token punctuation">,</span><span class="token string">'15888802'</span><span class="token punctuation">,</span><span class="token string">'zhangsan1@126.com'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 <span class="token punctuation">(</span><span class="token string">'折蓉蓉'</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token string">'广东'</span><span class="token punctuation">,</span><span class="token string">'13423333'</span><span class="token punctuation">,</span><span class="token string">'zherong@163.com'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 <span class="token punctuation">(</span><span class="token string">'曹丽娜'</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">,</span><span class="token number">26</span><span class="token punctuation">,</span><span class="token string">'广东'</span><span class="token punctuation">,</span><span class="token string">'12223333'</span><span class="token punctuation">,</span><span class="token string">'zhangsan1@qq.com'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 <span class="token punctuation">(</span><span class="token string">'李娜'</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">,</span><span class="token number">46</span><span class="token punctuation">,</span><span class="token string">'广西'</span><span class="token punctuation">,</span><span class="token string">'1343333'</span><span class="token punctuation">,</span><span class="token string">'zhangsan1@itcast.cn'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 <span class="token punctuation">(</span><span class="token string">'姜钰'</span><span class="token punctuation">,</span><span class="token string">'男'</span><span class="token punctuation">,</span><span class="token number">49</span><span class="token punctuation">,</span><span class="token string">'湖南'</span><span class="token punctuation">,</span><span class="token string">'13223333'</span><span class="token punctuation">,</span><span class="token string">'zhangsan1@qq.com'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 <span class="token punctuation">(</span><span class="token string">'魏天霞'</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">,</span><span class="token number">38</span><span class="token punctuation">,</span><span class="token string">'湖南'</span><span class="token punctuation">,</span><span class="token string">'13054863'</span><span class="token punctuation">,</span><span class="token string">'zhangsan1@126.com'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 <span class="token punctuation">(</span><span class="token string">'王官君'</span><span class="token punctuation">,</span><span class="token string">'男'</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token string">'湖南'</span><span class="token punctuation">,</span><span class="token string">'1422233'</span><span class="token punctuation">,</span><span class="token string">'zhangsan1@126.com'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 <span class="token punctuation">(</span><span class="token string">'王红梅'</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">,</span><span class="token number">25</span><span class="token punctuation">,</span><span class="token string">'福建'</span><span class="token punctuation">,</span><span class="token string">'2777726'</span><span class="token punctuation">,</span><span class="token string">'wang@qq.com'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 <span class="token punctuation">(</span><span class="token string">'郭淑慧'</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">,</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token string">'海南'</span><span class="token punctuation">,</span><span class="token string">'6058168'</span><span class="token punctuation">,</span><span class="token string">'guoshu@qq.com'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 <span class="token punctuation">(</span><span class="token string">'马海娟'</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">,</span><span class="token number">29</span><span class="token punctuation">,</span><span class="token string">'海南'</span><span class="token punctuation">,</span><span class="token string">'13829882'</span><span class="token punctuation">,</span><span class="token string">'zhangsan1@itcast.cn'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 <span class="token punctuation">(</span><span class="token string">'孙洪山'</span><span class="token punctuation">,</span><span class="token string">'男'</span><span class="token punctuation">,</span><span class="token number">24</span><span class="token punctuation">,</span><span class="token string">'广东'</span><span class="token punctuation">,</span><span class="token string">'1393518'</span><span class="token punctuation">,</span><span class="token string">'zhangsan1@gmail.com'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 <span class="token punctuation">(</span><span class="token string">'胡丹丹'</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">,</span><span class="token number">19</span><span class="token punctuation">,</span><span class="token string">'广西'</span><span class="token punctuation">,</span><span class="token string">'132138998'</span><span class="token punctuation">,</span><span class="token string">'zhangsan1@itcast.cn'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 <span class="token punctuation">(</span><span class="token string">'胡书琴'</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token string">'广西'</span><span class="token punctuation">,</span><span class="token string">'152020988'</span><span class="token punctuation">,</span><span class="token string">'zhangsan1@126.com'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 <span class="token punctuation">(</span><span class="token string">'冷静'</span><span class="token punctuation">,</span><span class="token string">'男'</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token string">'广东'</span><span class="token punctuation">,</span><span class="token string">'13422223'</span><span class="token punctuation">,</span><span class="token string">'lengjing@gmail.com'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 <span class="token punctuation">(</span><span class="token string">'李剑'</span><span class="token punctuation">,</span><span class="token string">'男'</span><span class="token punctuation">,</span><span class="token number">33</span><span class="token punctuation">,</span><span class="token string">'湖南'</span><span class="token punctuation">,</span><span class="token string">'13423333'</span><span class="token punctuation">,</span><span class="token string">'lijian@126.com'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 <span class="token punctuation">(</span><span class="token string">'任娟娟'</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">,</span><span class="token number">21</span><span class="token punctuation">,</span><span class="token string">'广西'</span><span class="token punctuation">,</span><span class="token string">'13636668'</span><span class="token punctuation">,</span><span class="token string">'juanjuan@itcast.cn'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 <span class="token punctuation">(</span><span class="token string">'范志坚'</span><span class="token punctuation">,</span><span class="token string">'男'</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token string">'湖南'</span><span class="token punctuation">,</span><span class="token string">'1223333'</span><span class="token punctuation">,</span><span class="token string">'zhijain@126.com'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 <span class="token punctuation">(</span><span class="token string">'王继开'</span><span class="token punctuation">,</span><span class="token string">'男'</span><span class="token punctuation">,</span><span class="token number">21</span><span class="token punctuation">,</span><span class="token string">'海南'</span><span class="token punctuation">,</span><span class="token string">'1685168'</span><span class="token punctuation">,</span><span class="token string">'jikai@itcast.cn'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 <span class="token punctuation">(</span><span class="token string">'刘小超'</span><span class="token punctuation">,</span><span class="token string">'男'</span><span class="token punctuation">,</span><span class="token number">21</span><span class="token punctuation">,</span><span class="token string">'广东'</span><span class="token punctuation">,</span><span class="token string">'1342333'</span><span class="token punctuation">,</span><span class="token string">'xiaochao@gmail.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">-- 再次执行上面相同的代码，使用了索引</span>
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> contact <span class="token keyword">WHERE</span> NAME<span class="token operator">=</span><span class="token string">'孙悟空'</span> <span class="token operator">OR</span> NAME<span class="token operator">=</span><span class="token string">'猪八戒'</span><span class="token punctuation">;</span>


<span class="token comment">-- 查询以空尾的员工，没有使用索引</span>
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> contact <span class="token keyword">WHERE</span> NAME <span class="token operator">LIKE</span> <span class="token string">'%空'</span><span class="token punctuation">;</span>


<span class="token comment">-- 以刘开头的员工，使用了索引</span>
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> contact <span class="token keyword">WHERE</span> NAME <span class="token operator">LIKE</span> <span class="token string">'刘%'</span><span class="token punctuation">;</span>


<span class="token comment">-- where语句中使用 &lt;&gt;和 !=，没有使用索引</span>
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> contact <span class="token keyword">WHERE</span> NAME <span class="token operator">&lt;&gt;</span> <span class="token string">'猪八戒'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="事务的概念"><a href="#事务的概念" class="headerlink" title="事务的概念"></a>事务的概念</h2><h3 id="目标-18"><a href="#目标-18" class="headerlink" title="目标"></a>目标</h3><ol>
<li>学习事务的概念</li>
<li>了解事务的四大特性</li>
</ol>
<h4 id="什么是事务"><a href="#什么是事务" class="headerlink" title="什么是事务"></a>什么是事务</h4><p><font color="red"><strong>由多条SQL语句组成一个功能，这多条SQL语句就是事务</strong></font>。一个事务中的多条SQL要么都执行，要么都不执行，事务是一个不可分割的工作单位（原子性）。</p>
<h4 id="事务的应用场景说明"><a href="#事务的应用场景说明" class="headerlink" title="事务的应用场景说明"></a>事务的应用场景说明</h4><p>例如: 张三给李四转账，张三账号减钱，李四账号加钱</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 创建数据表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> account <span class="token punctuation">(</span>
	id <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
	NAME <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	balance <span class="token keyword">DOUBLE</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 添加数据</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> account <span class="token punctuation">(</span>NAME<span class="token punctuation">,</span> balance<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'张三'</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'李四'</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>模拟张三给李四转500元钱，一个转账的业务操作最少要执行下面的2条语句：</p>
<ol>
<li>张三账号-500</li>
<li>李四账号+500</li>
</ol>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 1. 张三账号-500</span>
<span class="token keyword">UPDATE</span> account <span class="token keyword">SET</span> balance <span class="token operator">=</span> balance <span class="token operator">-</span> <span class="token number">500</span> <span class="token keyword">WHERE</span> id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token comment">-- 2. 李四账号+500</span>
<span class="token keyword">UPDATE</span> account <span class="token keyword">SET</span> balance <span class="token operator">=</span> balance <span class="token operator">+</span> <span class="token number">500</span> <span class="token keyword">WHERE</span> id<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>假设当张三账号上-500元，服务器崩溃了。李四的账号并没有+500元，数据就出现问题了。我们需要保证其中一条SQL语句出现问题，整个转账就算失败。只有两条SQL都成功了转账才算成功。这个时候就需要用到事务。</p>
<h4 id="事务的四大特性-ACID"><a href="#事务的四大特性-ACID" class="headerlink" title="事务的四大特性(ACID)"></a>事务的四大特性(ACID)</h4><table>
<thead>
<tr>
<th>事务特性</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>原子性（Atomicity）</td>
<td>事务是一个不可分割的工作单位，事务中的操作要么都发生，要么都不发生。</td>
</tr>
<tr>
<td>一致性（Consistency）</td>
<td>事务前后数据的完整性必须保持一致。</td>
</tr>
<tr>
<td>隔离性（Isolation）</td>
<td>是指多个用户并发访问数据库时，一个用户的事务不能被其它用户的事务所干扰，多个并发事务之间数据要相互隔离，不能相互影响。</td>
</tr>
<tr>
<td>持久性（Durability）</td>
<td>指一个事务一旦被提交，它对数据库中数据的改变就是永久性的，接下来即使数据库发生故障也不应该对其有任何影响。</td>
</tr>
</tbody></table>
<h3 id="小结-13"><a href="#小结-13" class="headerlink" title="小结"></a>小结</h3><p>什么是事务？</p>
<pre class="line-numbers language-none"><code class="language-none">由多条SQL语句组成一个功能，这多条SQL语句就是事务<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<p>事务四个特性？</p>
<pre class="line-numbers language-none"><code class="language-none">1.原子性
2.一致性
3.隔离性
4.持久性<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>


<h2 id="手动提交事务-重要"><a href="#手动提交事务-重要" class="headerlink" title="手动提交事务(重要)"></a>手动提交事务(重要)</h2><h3 id="目标-19"><a href="#目标-19" class="headerlink" title="目标"></a>目标</h3><p>学习手动的方式提交事务</p>
<p>MYSQL中可以有两种方式进行事务的操作</p>
<ol>
<li>手动提交事务</li>
<li>自动提交事务(默认的)</li>
</ol>
<p> 事务有关的SQL语句</p>
<table>
<thead>
<tr>
<th>SQL语句</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>START TRANSACTION;</td>
<td>开启事务</td>
</tr>
<tr>
<td>COMMIT;</td>
<td>提交事务</td>
</tr>
<tr>
<td>ROLLBACK;</td>
<td>回滚事务</td>
</tr>
</tbody></table>
<h4 id="手动提交事务使用步骤"><a href="#手动提交事务使用步骤" class="headerlink" title="手动提交事务使用步骤"></a>手动提交事务使用步骤</h4><p>​    第1种情况：开启事务 -&gt; 执行SQL语句 -&gt; 成功 -&gt; 提交事务<br>​    第2种情况：开启事务 -&gt; 执行SQL语句 -&gt; 失败 -&gt; 回滚事务<br>   <img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A101.png"></p>
<p><strong>案例演示1</strong>：模拟张三给李四转500元钱（成功）<br>目前数据库数据如下：<br><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A103.png"></p>
<ol>
<li><p>使用DOS控制台进入MySQL</p>
</li>
<li><p>执行以下SQL语句： <code>1.开启事务</code>， <code>2.张三账号-500</code>， <code>3.李四账号+500</code></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">START</span> <span class="token keyword">TRANSACTION</span><span class="token punctuation">;</span>
<span class="token keyword">UPDATE</span> account <span class="token keyword">SET</span> balance <span class="token operator">=</span> balance <span class="token operator">-</span> <span class="token number">500</span> <span class="token keyword">WHERE</span> id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">UPDATE</span> account <span class="token keyword">SET</span> balance <span class="token operator">=</span> balance <span class="token operator">+</span> <span class="token number">500</span> <span class="token keyword">WHERE</span> id<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A102.png"></p>
</li>
<li><p>使用SQLYog查看数据库：发现数据并没有改变<br><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A103.png"></p>
</li>
<li><p>在控制台执行<code>commit</code>提交任务：<br><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A104.png"></p>
</li>
<li><p>使用SQLYog查看数据库：发现数据改变<br><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A105.png"></p>
</li>
</ol>
<hr>
<p><strong>案例演示2</strong>：模拟张三给李四转500元钱（失败）<br>目前数据库数据如下：<br><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A105.png"></p>
<ol>
<li><p>在控制台执行以下SQL语句：<code>1.开启事务</code>， <code>2.张三账号-500</code></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">START</span> <span class="token keyword">TRANSACTION</span><span class="token punctuation">;</span>
<span class="token keyword">UPDATE</span> account <span class="token keyword">SET</span> balance <span class="token operator">=</span> balance <span class="token operator">-</span> <span class="token number">500</span> <span class="token keyword">WHERE</span> id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A106.png"></p>
</li>
<li><p>使用SQLYog查看数据库：发现数据并没有改变<br><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A107.png"></p>
</li>
<li><p>在控制台执行<code>rollback</code>回滚事务：<br><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A108.png"></p>
</li>
<li><p>使用SQLYog查看数据库：发现数据没有改变<br><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A109.png"></p>
</li>
</ol>
<h3 id="小结-14"><a href="#小结-14" class="headerlink" title="小结"></a>小结</h3><ol>
<li>如何开启事务:  START TRANSACTION;</li>
<li>如何提交事务:  COMMIT;</li>
<li>如何回滚事务:  ROLLBACK;</li>
</ol>
<p><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A101.png"></p>
<h2 id="自动提交事务-重要"><a href="#自动提交事务-重要" class="headerlink" title="自动提交事务(重要)"></a>自动提交事务(重要)</h2><h3 id="目标-20"><a href="#目标-20" class="headerlink" title="目标"></a>目标</h3><p>了解自动提交事务</p>
<p>关闭自动提交事务</p>
<h3 id="讲解-13"><a href="#讲解-13" class="headerlink" title="讲解"></a>讲解</h3><p>MySQL的每一条DML(增删改)语句都是一个单独的事务，每条语句DML执行完毕自动提交事务，MySQL默认开始自动提交事务。<br><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A110.png"></p>
<ol>
<li><p>将金额重置为1000<br><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A111.png"></p>
</li>
<li><p>执行以下SQL语句</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">UPDATE</span> account <span class="token keyword">SET</span> balance <span class="token operator">=</span> balance <span class="token operator">-</span> <span class="token number">500</span> <span class="token keyword">WHERE</span> id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li><p>使用SQLYog查看数据库：发现数据已经改变<br><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A112.png"></p>
</li>
</ol>
<p>   使用SQL语句查看MySQL是否开启自动提交事务</p>
   <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'%commit%'</span><span class="token punctuation">;</span>
<span class="token comment">-- 或</span>
<span class="token keyword">SELECT</span> @<span class="token variable">@autocommit</span><span class="token punctuation">;</span> <span class="token comment">-- 推荐</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>   通过修改MySQL全局变量”autocommit”，取消自动提交事务<br>   <img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A113.png"><br>   0:OFF（关闭自动提交）<br>   1:ON（开启自动提交）</p>
<ol start="4">
<li><p>关闭自动提交事务，设置自动提交的参数为OFF，执行SQL语句：<code>set autocommit = 0;</code><br><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A114.png"></p>
</li>
<li><p>在控制台执行以下SQL语句：张三-500</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">UPDATE</span> account <span class="token keyword">SET</span> balance <span class="token operator">=</span> balance <span class="token operator">-</span> <span class="token number">500</span> <span class="token keyword">WHERE</span> id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A115.png"></p>
</li>
<li><p>使用SQLYog查看数据库，发现数据并没有改变<br><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A116.png"></p>
</li>
<li><p>在控制台执行<code>commit</code>提交任务<br><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A117.png"></p>
</li>
<li><p>使用SQLYog查看数据库，发现数据改变<br><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A118.png"></p>
</li>
</ol>
<h3 id="小结-15"><a href="#小结-15" class="headerlink" title="小结"></a>小结</h3><ol>
<li><p>查询事务提交状态</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SHOW</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">'%commit%'</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> @<span class="token variable">@AUTOCOMMIT</span><span class="token punctuation">;</span> <span class="token comment">-- 推荐</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">   
   
   
2. 关闭事务自动提交

   ```sql
   SET AUTOCOMMIT = 0;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>




</li>
</ol>
<h2 id="事务原理-重要"><a href="#事务原理-重要" class="headerlink" title="事务原理(重要)"></a>事务原理(重要)</h2><h3 id="目标-21"><a href="#目标-21" class="headerlink" title="目标"></a>目标</h3><p>学习事务原理</p>
<h3 id="讲解-14"><a href="#讲解-14" class="headerlink" title="讲解"></a>讲解</h3><p>​    事务开启之后, 所有的操作都会临时保存到事务日志, 事务日志只有在得到<code>commit</code>命令才会同步到数据表中，其他任何情况都会清空事务日志(rollback，断开连接)<br>   <img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A119.png"></p>
<h3 id="小结-16"><a href="#小结-16" class="headerlink" title="小结"></a>小结</h3><p>事务原理</p>
<ol>
<li>用户登录数据库,会创建一个临时事务日志文件</li>
<li>普通的SQL执行,直接作用到数据库上</li>
<li>开启事务,操作机制发生变化</li>
<li>执行的SQL语句会保存到临时事务日志文件中</li>
<li>提交事务,临时日志文件中的SQL语句就会作用到数据库上</li>
<li>回滚事务,直接清空临时日志文件的内容</li>
</ol>
<table>
<thead>
<tr>
<th><strong>事务的操作</strong></th>
<th><strong>MySQL操作事务的语句</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>开启事务</strong></td>
<td>START TRANSACTION;</td>
</tr>
<tr>
<td><strong>提交事务</strong></td>
<td>COMMIT;</td>
</tr>
<tr>
<td><strong>回滚事务</strong></td>
<td>ROLLBACK;</td>
</tr>
<tr>
<td><strong>查询事务的自动提交情况</strong></td>
<td>SELECT @@AUTOCOMMIT;</td>
</tr>
<tr>
<td><strong>设置事务的自动提交方式</strong></td>
<td>SET AUTOCOMMIT = 0;</td>
</tr>
</tbody></table>
<h2 id="回滚点-了解"><a href="#回滚点-了解" class="headerlink" title="回滚点(了解)"></a>回滚点(了解)</h2><p>之前我们事务在回滚的时候都是回滚到开始事务的地方，能不能再回滚事务的时候回滚到一个指定的地方呢？</p>
<h3 id="目标-22"><a href="#目标-22" class="headerlink" title="目标"></a>目标</h3><p>学习事务回滚点的设置和回滚</p>
<p>我们可以在事务中设置回滚点，点回滚到指定的位置。</p>
<h4 id="设置回滚点语法"><a href="#设置回滚点语法" class="headerlink" title="设置回滚点语法"></a>设置回滚点语法</h4><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">savepoint</span> 回滚点名字<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<h4 id="回到回滚点语法"><a href="#回到回滚点语法" class="headerlink" title="回到回滚点语法"></a>回到回滚点语法</h4><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">rollback</span> <span class="token keyword">to</span> 回滚点名字<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<h3 id="小结-17"><a href="#小结-17" class="headerlink" title="小结"></a>小结</h3><p>设置回滚点</p>
<pre class="line-numbers language-none"><code class="language-none">saveponit 回滚点名称;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<p>回到指定回滚点</p>
<pre class="line-numbers language-none"><code class="language-none">rollback to 回滚点名称;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>





<h2 id="事务的隔离级别-了解"><a href="#事务的隔离级别-了解" class="headerlink" title="事务的隔离级别(了解)"></a>事务的隔离级别(了解)</h2><h3 id="目标-23"><a href="#目标-23" class="headerlink" title="目标"></a>目标</h3><ol>
<li>学习事务并发访问的三个问题</li>
<li>学习MySQL的四种隔离级别</li>
</ol>
<p>事务在操作时的理想状态：多个事务之间互不影响，如果隔离级别设置不当就可能引发并发访问问题。</p>
<table>
<thead>
<tr>
<th>事务并发访问的问题</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>脏读</td>
<td>一个事务读取到了另一个事务中尚未提交的数据</td>
</tr>
<tr>
<td>不可重复读</td>
<td>一个事务中两次读取的数据内容不一致</td>
</tr>
<tr>
<td>幻读</td>
<td>一个事务中多次读取，数据的数量不一样</td>
</tr>
</tbody></table>
<p>   <img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A158.png"><br>   <img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A159.png"><br>   <img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A160.png"></p>
<p>MySQL数据库有四种隔离级别：上面的级别最低，下面的级别最高。“是”表示会出现这种问题，“否”表示不会出现这种问题。</p>
<table>
<thead>
<tr>
<th>级别</th>
<th>名字</th>
<th>隔离级别</th>
<th>脏读</th>
<th>不可重复读</th>
<th>幻读</th>
<th>数据库默认隔离级别</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>读未提交</td>
<td>read uncommitted</td>
<td>是</td>
<td>是</td>
<td>是</td>
<td></td>
</tr>
<tr>
<td>2</td>
<td>读已提交</td>
<td>read committed</td>
<td>否</td>
<td>是</td>
<td>是</td>
<td>Oracle和SQL Server</td>
</tr>
<tr>
<td>3</td>
<td>可重复读</td>
<td>repeatable read</td>
<td>否</td>
<td>否</td>
<td>是</td>
<td>MySQL</td>
</tr>
<tr>
<td>4</td>
<td>串行化</td>
<td>serializable</td>
<td>否</td>
<td>否</td>
<td>否</td>
<td></td>
</tr>
</tbody></table>
<h3 id="小结-18"><a href="#小结-18" class="headerlink" title="小结"></a>小结</h3><ol>
<li><p>能够理解事务并发访问的三个问题</p>
<p>脏读：一个事务读取到另一个事务未提交的数据</p>
<p>不可重复读：一个事务读取多次,读取的数据内容不一致</p>
<p>幻读：一个事务读取多次,读取的数量不一致</p>
</li>
<li><p>能够说出MySQL的四种隔离级别</p>
</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">1.读未提交  read uncommitted
2.读已提交  read committed
3.可重复读 repeatable read 
3.串行化  serializable<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="脏读的演示"><a href="#脏读的演示" class="headerlink" title="脏读的演示"></a>脏读的演示</h2><h3 id="目标-24"><a href="#目标-24" class="headerlink" title="目标"></a>目标</h3><ol>
<li>学习设置MySQL的隔离级别</li>
<li>学习解决赃读</li>
</ol>
<h4 id="查询和设置隔离级别"><a href="#查询和设置隔离级别" class="headerlink" title="查询和设置隔离级别"></a>查询和设置隔离级别</h4><ol>
<li><p>查询全局事务隔离级别</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'%isolation%'</span><span class="token punctuation">;</span>
<span class="token comment">-- 或</span>
<span class="token keyword">select</span> @<span class="token variable">@tx_isolation</span><span class="token punctuation">;</span> <span class="token comment">-- 推荐使用</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A127.png"></p>
</li>
<li><p>设置事务隔离级别，需要退出MySQL再进入MySQL才能看到隔离级别的变化</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">set</span> <span class="token keyword">global</span> <span class="token keyword">transaction</span> <span class="token keyword">isolation</span> <span class="token keyword">level</span> 级别字符串<span class="token punctuation">;</span>
<span class="token comment">-- 例如:</span>
<span class="token keyword">set</span> <span class="token keyword">global</span> <span class="token keyword">transaction</span> <span class="token keyword">isolation</span> <span class="token keyword">level</span> <span class="token keyword">read</span> <span class="token keyword">uncommitted</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A128.png"></p>
</li>
</ol>
<h4 id="脏读的演示-1"><a href="#脏读的演示-1" class="headerlink" title="脏读的演示"></a>脏读的演示</h4><p>脏读：一个事务读取到了另一个事务中尚未提交的数据。</p>
<p>将数据进行恢复：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">UPDATE</span> account <span class="token keyword">SET</span> balance <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol>
<li><p>打开A窗口登录MySQL，设置全局的隔离级别为最低</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql <span class="token operator">-</span>uroot <span class="token operator">-</span>proot
<span class="token keyword">set</span> <span class="token keyword">global</span> <span class="token keyword">transaction</span> <span class="token keyword">isolation</span> <span class="token keyword">level</span> <span class="token keyword">read</span> <span class="token keyword">uncommitted</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A129.png"></p>
</li>
<li><p>打开B窗口，AB窗口都开启事务</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">use</span> day17<span class="token punctuation">;</span>
<span class="token keyword">start</span> <span class="token keyword">transaction</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A130.png"></p>
</li>
<li><p>A窗口更新2个人的账户数据，未提交</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">update</span> account <span class="token keyword">set</span> balance<span class="token operator">=</span>balance<span class="token operator">-</span><span class="token number">500</span> <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">update</span> account <span class="token keyword">set</span> balance<span class="token operator">=</span>balance<span class="token operator">+</span><span class="token number">500</span> <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A131.png"></p>
</li>
<li><p>B窗口查询账户</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> account<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A132.png"></p>
</li>
<li><p>A窗口回滚</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">rollback</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A133.png"></p>
</li>
<li><p>B窗口查询账户，钱没了<br><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A134.png"></p>
</li>
</ol>
<p>脏读非常危险的，比如张三向李四购买商品，张三开启事务，向李四账号转入500块，然后打电话给李四说钱已经转了。李四一查询钱到账了，发货给张三。张三收到货后回滚事务，李四的再查看钱没了。</p>
<p><strong>解决脏读的问题</strong>：将全局的隔离级别进行提升为<code>read committed</code><br>将数据进行恢复：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">UPDATE</span> account <span class="token keyword">SET</span> balance <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol>
<li><p>在A窗口设置全局的隔离级别为<code>read committed</code></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">set</span> <span class="token keyword">global</span> <span class="token keyword">transaction</span> <span class="token keyword">isolation</span> <span class="token keyword">level</span> <span class="token keyword">read</span> <span class="token keyword">committed</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A135.png"></p>
</li>
<li><p>B窗口退出MySQL，B窗口再进入MySQL<br><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A136.png"></p>
</li>
<li><p>AB窗口同时开启事务<br><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A137.png"></p>
</li>
<li><p>A更新2个人的账户，未提交</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">update</span> account <span class="token keyword">set</span> balance<span class="token operator">=</span>balance<span class="token operator">-</span><span class="token number">500</span> <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">update</span> account <span class="token keyword">set</span> balance<span class="token operator">=</span>balance<span class="token operator">+</span><span class="token number">500</span> <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A138.png"></p>
</li>
<li><p>B窗口查询账户<br><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A139.png"></p>
</li>
<li><p>A窗口commit提交事务<br><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A140.png"></p>
</li>
<li><p>B窗口查看账户<br><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A141.png"></p>
</li>
</ol>
<blockquote>
<p>结论：read committed的方式可以避免脏读的发生</p>
</blockquote>
<h3 id="小结-19"><a href="#小结-19" class="headerlink" title="小结"></a>小结</h3><ol>
<li><p>查询全局事务隔离级别？</p>
<pre class="line-numbers language-none"><code class="language-none">SHOW VARIABLES LIKE '%isolation%';

SELECT @@TX_ISOLATION;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


</li>
</ol>
<ol start="2">
<li><p>设置全局事务隔离级别？</p>
<pre class="line-numbers language-none"><code class="language-none">SET GLOBAL TRANSACTION ISOLATION LEVEL 级别字符串;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


</li>
</ol>
<ol start="3">
<li><p>如何解决赃读? </p>
<pre class="line-numbers language-none"><code class="language-none">将隔离级别提升到 read committed<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


</li>
</ol>
<h2 id="不可重复读的演示"><a href="#不可重复读的演示" class="headerlink" title="不可重复读的演示"></a>不可重复读的演示</h2><h3 id="目标-25"><a href="#目标-25" class="headerlink" title="目标"></a>目标</h3><p>解决不可重复读</p>
<h3 id="讲解-15"><a href="#讲解-15" class="headerlink" title="讲解"></a>讲解</h3><p>不可重复读：一个事务中两次读取的数据内容不一致。</p>
<p>将数据进行恢复：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">UPDATE</span> account <span class="token keyword">SET</span> balance <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol>
<li><p>开启A窗口</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">set</span> <span class="token keyword">global</span> <span class="token keyword">transaction</span> <span class="token keyword">isolation</span> <span class="token keyword">level</span> <span class="token keyword">read</span> <span class="token keyword">committed</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A142.png"></p>
</li>
<li><p>开启B窗口，在B窗口开启事务，并查询数据</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">start</span> <span class="token keyword">transaction</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> account<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A143.png"></p>
</li>
<li><p>在A窗口开启事务，并更新数据</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">start</span> <span class="token keyword">transaction</span><span class="token punctuation">;</span>
<span class="token keyword">update</span> account <span class="token keyword">set</span> balance<span class="token operator">=</span>balance<span class="token operator">+</span><span class="token number">500</span> <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">commit</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A144.png"></p>
</li>
<li><p>B窗口查询</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> account<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A145.png"></p>
</li>
</ol>
<p>两次查询输出的结果不同，到底哪次是对的？不知道以哪次为准。<br>很多人认为这种情况就对了，无须困惑，当然是后面的为准。我们可以考虑这样一种情况，比如银行程序需要将查询结果分别输出到电脑屏幕和发短信给客户，结果在一个事务中针对不同的输出目的地进行的两次查询不一致，导致文件和屏幕中的结果不一致，银行工作人员就不知道以哪个为准了。</p>
<p><strong>解决不可重复读的问题</strong>：将全局的隔离级别进行提升为：<code>repeatable read</code><br>将数据进行恢复：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">UPDATE</span> account <span class="token keyword">SET</span> balance <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol>
<li><p>A窗口设置隔离级别为：<code>repeatable read</code></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">set</span> <span class="token keyword">global</span> <span class="token keyword">transaction</span> <span class="token keyword">isolation</span> <span class="token keyword">level</span> <span class="token keyword">repeatable</span> <span class="token keyword">read</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A146.png"></p>
</li>
<li><p>B窗口退出MySQL，B窗口再进入MySQL，并查询数据</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">start</span> <span class="token keyword">transaction</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> account<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A147.png"></p>
</li>
<li><p>A窗口更新数据</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">start</span> <span class="token keyword">transaction</span><span class="token punctuation">;</span>
<span class="token keyword">update</span> account <span class="token keyword">set</span> balance<span class="token operator">=</span>balance<span class="token operator">+</span><span class="token number">500</span> <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">commit</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A148.png"></p>
</li>
<li><p>B窗口查询</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> account<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A149.png"></p>
</li>
</ol>
<blockquote>
<p>结论：同一个事务中为了保证多次查询数据一致，必须使用<code>repeatable read</code>隔离级别<br><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A150.png"></p>
</blockquote>
<h3 id="小结-20"><a href="#小结-20" class="headerlink" title="小结"></a>小结</h3><p>如何解决不可重复读？</p>
<pre class="line-numbers language-none"><code class="language-none">将数据库的隔离级别设置为：REPEATABLE READ;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<h2 id="幻读的演示"><a href="#幻读的演示" class="headerlink" title="幻读的演示"></a>幻读的演示</h2><h3 id="目标-26"><a href="#目标-26" class="headerlink" title="目标"></a>目标</h3><p>解决幻读</p>
<h3 id="讲解-16"><a href="#讲解-16" class="headerlink" title="讲解"></a>讲解</h3><p>幻读：<strong>一个事务中多次读取，数据量不一样。</strong></p>
<p>幻读演示</p>
<ol>
<li>开启A窗口，开启事务，并查询id&gt;1的数据</li>
</ol>
<p><img src="MySQL-03.assets/1551413050280.png" alt="1551413050280"></p>
<ol start="2">
<li><p>开启B窗口，开启事务，添加一条数据，并提交事务</p>
<p><img src="MySQL-03.assets/1551413102060.png" alt="1551413102060"></p>
</li>
</ol>
<ol start="3">
<li>在A窗口修改id&gt;1数据的balance为0，并重新查询id&gt;1的数据</li>
</ol>
<p><img src="MySQL-03.assets/1551413309793.png" alt="1551413309793"></p>
<p>我们可以将事务隔离级别设置到最高，以挡住幻读的发生<br>将数据进行恢复：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">UPDATE</span> account <span class="token keyword">SET</span> balance <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol>
<li><p>开启A窗口</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">set</span> <span class="token keyword">global</span> <span class="token keyword">transaction</span> <span class="token keyword">isolation</span> <span class="token keyword">level</span> <span class="token keyword">serializable</span><span class="token punctuation">;</span> <span class="token comment">-- 设置隔离级别为最高</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A151.png"></p>
</li>
<li><p>A窗口退出MySQL，A窗口重新登录MySQL</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">start</span> <span class="token keyword">transaction</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> account<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A152.png"></p>
</li>
<li><p>再开启B窗口，登录MySQL</p>
</li>
<li><p>在B窗口中开启事务，添加一条记录</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">start</span> <span class="token keyword">transaction</span><span class="token punctuation">;</span> <span class="token comment">-- 开启事务</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> account <span class="token punctuation">(</span>name<span class="token punctuation">,</span>balance<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'LaoWang'</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A153.png"></p>
</li>
<li><p>在A窗口中commit提交事务，B窗口中insert语句会在A窗口事务提交后立马运行<br><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A154.png"></p>
</li>
<li><p>在A窗口中接着查询，发现数据不变</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> account<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A155.png"></p>
</li>
<li><p>B窗口中commit提交当前事务<br><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A156.png"></p>
</li>
<li><p>A窗口就能看到最新的数据<br><img src="MySQL-03.assets/%E4%BA%8B%E5%8A%A157.png"></p>
</li>
</ol>
<blockquote>
<p>结论：使用serializable隔离级别，一个事务没有执行完，其他事务的SQL执行不了，可以挡住幻读。</p>
<p>通过提高隔离级别到串行化，可以避免并发访问的所有的问题，但效率太低。</p>
</blockquote>
<h3 id="小结-21"><a href="#小结-21" class="headerlink" title="小结"></a>小结</h3><p>如何解决幻读？</p>
<pre class="line-numbers language-none"><code class="language-none">将隔离级别设置成：SERIALIZABLE<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol>
<li><p>能够使用内连接进行多表查询</p>
<p>隐式内连接:  select * from 表1, 表2 where 条件;</p>
<p>(推荐)显示内连接:  select * from 左表 inner join 右表 on 表连接条件 where 查询条件;</p>
</li>
<li><p>能够使用左外和右外连接进行多表查询</p>
<p>左外:  select * from 左表 left outer join 右表 on 表连接条件 where 查询条件;      满足条件的数据显示,并且左表不满足条件的数据也显示</p>
<p>右外:  select * from 左表 right outer join 右表 on 表连接条件 where 查询条件;   满足条件的数据显示,并且右表不满足条件的数据也显示</p>
</li>
<li><p>能够使用子查询</p>
<p>一个查询语句的结果作为另一个查询语句的一部分</p>
<p>SELECT * FROM 表名 WHERE 字段名=(SELECT MAX(字段名) FROM 表名);</p>
<p>先执行()里面的子查询</p>
</li>
<li><p>能够理解多表查询的规律</p>
<p>多表查询3步骤:</p>
<ol>
<li>明确查询哪些表</li>
<li>明确表连接条件</li>
<li>后续查询</li>
</ol>
</li>
<li><p>能够理解事务的概念</p>
<p>由多条SQL语句组成一个功能,这多条SQL语句形成一个事务</p>
<p>事务中的多条SQL语句要么都执行,要么都不执行,保证原子性</p>
</li>
<li><p>能够说出事务的原理</p>
<ol>
<li>用户登录数据库,会创建一个临时事务日志文件</li>
<li>普通的SQL执行,直接作用到数据库上</li>
<li>开启事务,操作机制发生变化</li>
<li>执行的SQL语句会保存到临时事务日志文件中</li>
<li>提交事务,临时日志文件中的SQL语句就会作用到数据库上</li>
<li>回滚事务,直接清空临时日志文件的内容</li>
</ol>
</li>
<li><p>理解MySQL索引的作用</p>
<p>提高查询效率</p>
</li>
</ol>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">durex</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://chenliren9527.github.io/2020/09/20/mysql-03/">https://chenliren9527.github.io/2020/09/20/mysql-03/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">durex</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/%E7%AC%94%E8%AE%B0/">
                                    <span class="chip bg-color">笔记</span>
                                </a>
                            
                                <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">
                                    <span class="chip bg-color">数据库</span>
                                </a>
                            
                                <a href="/tags/MySQL/">
                                    <span class="chip bg-color">MySQL</span>
                                </a>
                            
                                <a href="/tags/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2/">
                                    <span class="chip bg-color">多表查询</span>
                                </a>
                            
                                <a href="/tags/%E7%B4%A2%E5%BC%95/">
                                    <span class="chip bg-color">索引</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.png" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2020/09/21/mysql-cun-chu-guo-cheng-shi-tu/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/37.jpg" class="responsive-img" alt="MySQL存储过程&amp;视图">
                        
                        <span class="card-title">MySQL存储过程&amp;视图</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2020-09-21
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" class="post-category">
                                    数据库
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E7%AC%94%E8%AE%B0/">
                        <span class="chip bg-color">笔记</span>
                    </a>
                    
                    <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">
                        <span class="chip bg-color">数据库</span>
                    </a>
                    
                    <a href="/tags/MySQL/">
                        <span class="chip bg-color">MySQL</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2020/09/18/mysql-02/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/41.jpg" class="responsive-img" alt="MySQL(02)">
                        
                        <span class="card-title">MySQL(02)</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2020-09-18
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" class="post-category">
                                    数据库
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E7%AC%94%E8%AE%B0/">
                        <span class="chip bg-color">笔记</span>
                    </a>
                    
                    <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">
                        <span class="chip bg-color">数据库</span>
                    </a>
                    
                    <a href="/tags/MySQL/">
                        <span class="chip bg-color">MySQL</span>
                    </a>
                    
                    <a href="/tags/%E5%A4%8D%E6%9D%82%E6%9F%A5%E8%AF%A2/">
                        <span class="chip bg-color">复杂查询</span>
                    </a>
                    
                    <a href="/tags/DCL/">
                        <span class="chip bg-color">DCL</span>
                    </a>
                    
                    <a href="/tags/%E7%BA%A6%E6%9D%9F/">
                        <span class="chip bg-color">约束</span>
                    </a>
                    
                    <a href="/tags/%E8%A1%A8%E5%85%B3%E7%B3%BB/">
                        <span class="chip bg-color">表关系</span>
                    </a>
                    
                    <a href="/tags/%E4%B8%89%E5%A4%A7%E8%8C%83%E5%BC%8F/">
                        <span class="chip bg-color">三大范式</span>
                    </a>
                    
                    <a href="/tags/%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0/">
                        <span class="chip bg-color">聚合函数</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
    <div class="container row center-align" style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2021-2022</span>
            
            <span id="year">2021</span>
            <a href="/about" target="_blank">durex</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">896.5k</span>&nbsp;字
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <span id="sitetime">载入运行时间...</span>
            <script>
                function siteTime() {
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var startYear = "2021";
                    var startMonth = "1";
                    var startDate = "08";
                    var startHour = "0";
                    var startMinute = "0";
                    var startSecond = "0";
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth() + 1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                    var diff = t2 - t1;
                    var diffYears = Math.floor(diff / years);
                    var diffDays = Math.floor((diff / days) - diffYears * 365);
                    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                        minutes);
                    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                        diffMinutes * minutes) / seconds);
                    if (startYear == todayYear) {
                        document.getElementById("year").innerHTML = todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffDays + " 天 " + diffHours +
                            " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    } else {
                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffYears + " 年 " + diffDays +
                            " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    }
                }
                setInterval(siteTime, 1000);
            </script>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">














    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
