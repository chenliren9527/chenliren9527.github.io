<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="乐优电商(06)-商品搜索分析, 薛定谔的腿毛">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>乐优电商(06)-商品搜索分析 | 薛定谔的腿毛</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 5.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="薛定谔的腿毛" type="application/atom+xml">
</head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">薛定谔的腿毛</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">薛定谔的腿毛</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        
    </ul>
</div>


        </div>

        
    </nav>

</header>

    
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/100.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">乐优电商(06)-商品搜索分析</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/%E7%AC%94%E8%AE%B0/">
                                <span class="chip bg-color">笔记</span>
                            </a>
                        
                            <a href="/tags/Elasticsearch/">
                                <span class="chip bg-color">Elasticsearch</span>
                            </a>
                        
                            <a href="/tags/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%E4%BA%8C/">
                                <span class="chip bg-color">项目实战二</span>
                            </a>
                        
                            <a href="/tags/springcloud/">
                                <span class="chip bg-color">springcloud</span>
                            </a>
                        
                            <a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/">
                                <span class="chip bg-color">微服务</span>
                            </a>
                        
                            <a href="/tags/SpringDataElasticsearch/">
                                <span class="chip bg-color">SpringDataElasticsearch</span>
                            </a>
                        
                            <a href="/tags/Kibana/">
                                <span class="chip bg-color">Kibana</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%E4%BA%8C/" class="post-category">
                                项目实战二
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2020-12-31
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2022-05-17
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    8.1k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    35 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.css">
        

        
        <!-- 代码块折行 -->
        <style type="text/css">
            code[class*="language-"], pre[class*="language-"] { white-space: pre-wrap !important; }
        </style>
        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="01、课程目标"><a href="#01、课程目标" class="headerlink" title="01、课程目标"></a>01、课程目标</h2><ul>
<li>掌握Kibana的基本操作</li>
<li>掌握SpringDataElasticsearch常用操作</li>
</ul>
<h2 id="02、Elasticsearch准备：ElasticSearch工具安装"><a href="#02、Elasticsearch准备：ElasticSearch工具安装" class="headerlink" title="02、Elasticsearch准备：ElasticSearch工具安装"></a>02、Elasticsearch准备：ElasticSearch工具安装</h2><h3 id="1）安装ElasticSearch服务器"><a href="#1）安装ElasticSearch服务器" class="headerlink" title="1）安装ElasticSearch服务器"></a>1）安装ElasticSearch服务器</h3><p><img src="%E4%B9%90%E4%BC%98%E7%94%B5%E5%95%86-06-%E5%95%86%E5%93%81%E6%90%9C%E7%B4%A2%E5%88%86%E6%9E%90.assets/1575973786265-1598925074856.png" alt="1575973786265"> </p>
<p>把 elasticsearch-6.6.2.zip 解压到没有中文的路径下，然后再把ik插件解压缩，拷贝到es的plugins目录下，启动前，可以修改es的config目录下的jvm.options文件，修改内存大小：默认值是1g，我们改小点，128m或者256m都可以，如果你的电脑内存够，不改也行。</p>
<p><img src="%E4%B9%90%E4%BC%98%E7%94%B5%E5%95%86-06-%E5%95%86%E5%93%81%E6%90%9C%E7%B4%A2%E5%88%86%E6%9E%90.assets/1575876595669-1598925074857.png" alt="1575876595669"> </p>
<h3 id="2）安装ik分词器"><a href="#2）安装ik分词器" class="headerlink" title="2）安装ik分词器"></a>2）安装ik分词器</h3><p>&nbsp;</p>
<p>&nbsp;<img src="乐优电商-06-商品搜索分析.assets/1598927151060.png" alt="1598927151060" style="zoom:50%;"></p>
<p>把以上目录解压到ES的plugins目录下即可。</p>
<h3 id="3）安装head插件"><a href="#3）安装head插件" class="headerlink" title="3）安装head插件"></a>3）安装head插件</h3><p><img src="%E4%B9%90%E4%BC%98%E7%94%B5%E5%95%86-06-%E5%95%86%E5%93%81%E6%90%9C%E7%B4%A2%E5%88%86%E6%9E%90.assets/1575974029838-1598925074857.png" alt="1575974029838"> </p>
<p>head插件有安装版、tomcat版和chrome的插件版，我们采用插件版即可。</p>
<p>在谷歌中按照head插件的流程如下图所示：</p>
<p><img src="%E4%B9%90%E4%BC%98%E7%94%B5%E5%95%86-06-%E5%95%86%E5%93%81%E6%90%9C%E7%B4%A2%E5%88%86%E6%9E%90.assets/image-20200318105239708-1598925074857.png" alt="image-20200318105239708"></p>
<h3 id="4）安装kibana"><a href="#4）安装kibana" class="headerlink" title="4）安装kibana"></a>4）安装kibana</h3><p><strong>什么是Kibana？</strong></p>
<p><img src="%E4%B9%90%E4%BC%98%E7%94%B5%E5%95%86-06-%E5%95%86%E5%93%81%E6%90%9C%E7%B4%A2%E5%88%86%E6%9E%90.assets/1528603530298.png" alt="1528603530298"></p>
<p>Kibana是一个基于Node.js的Elasticsearch索引库数据统计工具，可以利用Elasticsearch的聚合功能，生成各种图表，如柱形图，线状图，饼图等。</p>
<p>而且还提供了操作Elasticsearch索引数据的控制台，并且提供了一定的API提示，非常有利于我们学习Elasticsearch的语法。</p>
<p><strong>Kibana的安装</strong></p>
<p><img src="%E4%B9%90%E4%BC%98%E7%94%B5%E5%95%86-06-%E5%95%86%E5%93%81%E6%90%9C%E7%B4%A2%E5%88%86%E6%9E%90.assets/1575974208240-1598925074857.png" alt="1575974208240"> </p>
<p>启动kibana的前提是，需要安装好nodejs的环境。</p>
<p>解压缩就可以使用了，双击解压后的bin目录的kibana.bat文件即可。</p>
<p>发现kibana的监听端口是5601</p>
<p>我们访问：<a target="_blank" rel="noopener" href="http://127.0.0.1:5601/">http://127.0.0.1:5601</a></p>
<h3 id="5）Elasticsearch-API"><a href="#5）Elasticsearch-API" class="headerlink" title="5）Elasticsearch API"></a>5）Elasticsearch API</h3><p>Elasticsearch提供了Rest风格的API，即http请求接口，也提供了各种语言的客户端API</p>
<h4 id="Rest风格API"><a href="#Rest风格API" class="headerlink" title="Rest风格API"></a>Rest风格API</h4><p>文档地址：<a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html</a></p>
<p>&nbsp;<img src="乐优电商-06-商品搜索分析.assets/1600392183731.png" alt="1600392183731" style="zoom: 67%;"></p>
<h4 id="各种语言客户端API"><a href="#各种语言客户端API" class="headerlink" title="各种语言客户端API"></a>各种语言客户端API</h4><p>Elasticsearch支持的客户端非常多：<a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/client/index.html">https://www.elastic.co/guide/en/elasticsearch/client/index.html</a></p>
<p><img src="%E4%B9%90%E4%BC%98%E7%94%B5%E5%95%86-06-%E5%95%86%E5%93%81%E6%90%9C%E7%B4%A2%E5%88%86%E6%9E%90.assets/1528613714338.png" alt="1528613714338"></p>
<p>点击Java Rest Client后，你会发现又有两个：</p>
<p><img src="%E4%B9%90%E4%BC%98%E7%94%B5%E5%95%86-06-%E5%95%86%E5%93%81%E6%90%9C%E7%B4%A2%E5%88%86%E6%9E%90.assets/1528613788606.png" alt="1528613788606"></p>
<p>Low Level Rest Client是低级别封装，提供一些基础功能，但更灵活</p>
<p>High Level Rest Client，是在Low  Level Rest Client基础上进行的高级别封装，功能更丰富和完善，而且API会变的简单</p>
<p> <img src="%E4%B9%90%E4%BC%98%E7%94%B5%E5%95%86-06-%E5%95%86%E5%93%81%E6%90%9C%E7%B4%A2%E5%88%86%E6%9E%90.assets/1526518875072.png" alt="1526518875072"></p>
<p>今天的学习思路，我们先补充ES的REST风格API，然后再学习SpringDataElasticsearch（对Java语言客户端API的封装）</p>
<h2 id="03、Elasticsearch准备：搜索相关概念回顾"><a href="#03、Elasticsearch准备：搜索相关概念回顾" class="headerlink" title="03、Elasticsearch准备：搜索相关概念回顾"></a>03、Elasticsearch准备：搜索相关概念回顾</h2><h3 id="1）结构回顾"><a href="#1）结构回顾" class="headerlink" title="1）结构回顾"></a>1）结构回顾</h3><p>索引、类型、文档、域</p>
<p><img src="%E4%B9%90%E4%BC%98%E7%94%B5%E5%95%86-06-%E5%95%86%E5%93%81%E6%90%9C%E7%B4%A2%E5%88%86%E6%9E%90.assets/1575878066949-1598925921408.png" alt="1575878066949"> </p>
<h3 id="2）文档对象的域字段需要设置的三个属性"><a href="#2）文档对象的域字段需要设置的三个属性" class="headerlink" title="2）文档对象的域字段需要设置的三个属性"></a>2）文档对象的域字段需要设置的三个属性</h3><h4 id="是否索引"><a href="#是否索引" class="headerlink" title="是否索引"></a>是否索引</h4><pre class="line-numbers language-none"><code class="language-none">索引的字段才能被搜索到，不索引，就意味着不被搜索匹配。
日期，数量，点击数不索引。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h4 id="是否分词"><a href="#是否分词" class="headerlink" title="是否分词"></a>是否分词</h4><pre class="line-numbers language-none"><code class="language-none">分词就意味着要先分词，再拿分词后的词条匹配搜索结果。
如果不分词，就直接把当前搜索的内容当作一个词条。
人名，地名都不分词。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h4 id="是否存储"><a href="#是否存储" class="headerlink" title="是否存储"></a>是否存储</h4><pre class="line-numbers language-none"><code class="language-none">存储就意味着要显示，不存储不显示。
但是如果使用了elasticSearch，默认是所有字段全部存储。
被标记为store=true的是存储在索引库【lucene定义的】中。
如果没有store=true标记，存储在elasticSearch自己的库中。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>


<p>这些三部分内容我们都可以通过mapping来定义：</p>
<p>Mapping是用来定义Document中每个Field的特征的（数据类型，是否存储，是否索引，是否分词等）</p>
<pre class="line-numbers language-none"><code class="language-none">类型名称：就是前面将的type的概念，类似于数据库中的表
字段名：任意填写，下面指定许多属性，例如：

- type：类型，可以是text、long、short、date、integer、object等
- index：是否索引，默认为true
- store：是否存储，默认为false
- analyzer：分词器，这里的ik_max_word即使用ik分词器<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>在《ES IN ACTION》中有这样一段描述：</p>
<pre class="line-numbers language-none"><code class="language-none">This might be useful when you ask Elasticsearch for a particular field because retrieving a single stored field will be faster than retrieving the entire _source and extracting that field from it, especially when you have large documents.
NOTE When you store individual fields as well, you should take into account that the more you store, the bigger your index gets. Usually bigger indices imply slower indexing and slower searching.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>意思是，在ES中原始的文本会存储在_source里面（除非你关闭了它）。默认情况下其他提取出来的字段都不是独立存储的，是从_source里面提取出来的。当然你也可以独立的存储某个字段，只要设置store:true即可。</p>
<p>独立存储某个字段，在频繁使用某个特殊字段时很常用。而且获取独立存储的字段要比从_source中解析快得多，而且额外你还需要从_source中解析出来这个字段，尤其是_source特别大的时候。</p>
<p>不过需要注意的是，独立存储的字段越多，那么索引就越大；索引越大，索引和检索的过程就会越慢….</p>
</blockquote>
<h2 id="04、ES的REST风格API：基本CRUD（了解）"><a href="#04、ES的REST风格API：基本CRUD（了解）" class="headerlink" title="04、ES的REST风格API：基本CRUD（了解）"></a>04、ES的REST风格API：基本CRUD（了解）</h2><p>接下来我们先学习ES的REST风格API如何操作ES。</p>
<h3 id="1）创建索引"><a href="#1）创建索引" class="headerlink" title="1）创建索引"></a>1）创建索引</h3><p>Elasticsearch采用Rest风格API，因此其API就是一次http请求，你可以用任何工具发起http请求</p>
<p>创建索引的请求格式：</p>
<ul>
<li><p>请求方式：PUT</p>
</li>
<li><p>请求路径：/索引库名</p>
</li>
<li><p>请求参数：json格式：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>
    <span class="token property">"settings"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"number_of_shards"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token property">"number_of_replicas"</span><span class="token operator">:</span> <span class="token number">2</span>
      <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>settings：索引库的设置<ul>
<li>number_of_shards：分片数量</li>
<li>number_of_replicas：副本数量</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>kibana的控制台，可以对http请求进行简化，示例：</p>
<p>创建goods索引：</p>
<p><img src="%E4%B9%90%E4%BC%98%E7%94%B5%E5%95%86-06-%E5%95%86%E5%93%81%E6%90%9C%E7%B4%A2%E5%88%86%E6%9E%90.assets/1598928967819.png" alt="1598928967819"></p>
<p>相当于是省去了elasticsearch的服务器地址</p>
<p>而且还有语法提示，非常舒服。</p>
<h3 id="2）删除索引"><a href="#2）删除索引" class="headerlink" title="2）删除索引"></a>2）删除索引</h3><p>删除索引使用DELETE请求</p>
<blockquote>
<p>语法</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">DELETE /索引库名<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<blockquote>
<p>示例</p>
</blockquote>
<p><img src="%E4%B9%90%E4%BC%98%E7%94%B5%E5%95%86-06-%E5%95%86%E5%93%81%E6%90%9C%E7%B4%A2%E5%88%86%E6%9E%90.assets/1598929003917.png" alt="1598929003917"></p>
<p>查看goods索引库是否存在：</p>
<p><img src="%E4%B9%90%E4%BC%98%E7%94%B5%E5%95%86-06-%E5%95%86%E5%93%81%E6%90%9C%E7%B4%A2%E5%88%86%E6%9E%90.assets/1598929048969.png" alt="1598929048969"></p>
<p>当然，我们也可以用HEAD请求，查看索引是否存在：</p>
<p><img src="%E4%B9%90%E4%BC%98%E7%94%B5%E5%95%86-06-%E5%95%86%E5%93%81%E6%90%9C%E7%B4%A2%E5%88%86%E6%9E%90.assets/1598929065949.png" alt="1598929065949"></p>
<h3 id="3）新增数据"><a href="#3）新增数据" class="headerlink" title="3）新增数据"></a>3）新增数据</h3><h4 id="随机生成id"><a href="#随机生成id" class="headerlink" title="随机生成id"></a>随机生成id</h4><p>通过POST请求，可以向一个已经存在的索引库中添加数据。</p>
<blockquote>
<p>语法：</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">POST /索引库名/类型名
{
    "key":"value"
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>示例：</p>
</blockquote>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">POST /goods/docs
<span class="token punctuation">{</span>
     <span class="token property">"title"</span><span class="token operator">:</span><span class="token string">"小米手机"</span><span class="token punctuation">,</span>
    <span class="token property">"images"</span><span class="token operator">:</span><span class="token string">"http://image.leyou.com/12479122.jpg"</span><span class="token punctuation">,</span>
    <span class="token property">"price"</span><span class="token operator">:</span><span class="token number">2699.00</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>响应：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"goods"</span><span class="token punctuation">,</span>
  <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"docs"</span><span class="token punctuation">,</span>
  <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"QGGcR3QBMpeF1wVyBCzk"</span><span class="token punctuation">,</span>
  <span class="token property">"_version"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">"result"</span> <span class="token operator">:</span> <span class="token string">"created"</span><span class="token punctuation">,</span>
  <span class="token property">"_shards"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token property">"successful"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"failed"</span> <span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"_seq_no"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">"_primary_term"</span> <span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>通过kibana查看数据：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token constant">GET</span> <span class="token operator">/</span>goods<span class="token operator">/</span>_search
<span class="token punctuation">{</span>
  <span class="token string">"query"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">"match_all"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"took"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">"timed_out"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">"_shards"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token property">"successful"</span> <span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token property">"skipped"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"failed"</span> <span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"max_score"</span> <span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
    <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"goods"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"docs"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"QGGcR3QBMpeF1wVyBCzk"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"title"</span> <span class="token operator">:</span> <span class="token string">"小米手机"</span><span class="token punctuation">,</span>
          <span class="token property">"images"</span> <span class="token operator">:</span> <span class="token string">"http://image.leyou.com/12479122.jpg"</span><span class="token punctuation">,</span>
          <span class="token property">"price"</span> <span class="token operator">:</span> <span class="token number">2699.0</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><code>_source</code>：源文档信息，所有的数据都在里面。</li>
<li><code>_id</code>：这条文档的唯一标示，与文档自己的id字段没有关联</li>
</ul>
<h4 id="自定义id"><a href="#自定义id" class="headerlink" title="自定义id"></a>自定义id</h4><p>如果我们想要自己新增的时候指定id，可以这么做：</p>
<pre class="line-numbers language-none"><code class="language-none">POST /索引库名/类型/id值
{
    ...
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>示例：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">POST /goods/docs/<span class="token number">2</span>
<span class="token punctuation">{</span>
    <span class="token property">"title"</span><span class="token operator">:</span><span class="token string">"大米手机"</span><span class="token punctuation">,</span>
    <span class="token property">"images"</span><span class="token operator">:</span><span class="token string">"http://image.leyou.com/12479122.jpg"</span><span class="token punctuation">,</span>
    <span class="token property">"price"</span><span class="token operator">:</span><span class="token number">2899.00</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>得到的数据：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"_index"</span><span class="token operator">:</span> <span class="token string">"goods"</span><span class="token punctuation">,</span>
  <span class="token property">"_type"</span><span class="token operator">:</span> <span class="token string">"docs"</span><span class="token punctuation">,</span>
  <span class="token property">"_id"</span><span class="token operator">:</span> <span class="token string">"2"</span><span class="token punctuation">,</span>
  <span class="token property">"_score"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">"_source"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"大米手机"</span><span class="token punctuation">,</span>
    <span class="token property">"images"</span><span class="token operator">:</span> <span class="token string">"http://image.leyou.com/12479122.jpg"</span><span class="token punctuation">,</span>
    <span class="token property">"price"</span><span class="token operator">:</span> <span class="token number">2899</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="4）修改数据"><a href="#4）修改数据" class="headerlink" title="4）修改数据"></a>4）修改数据</h3><p>把刚才新增的请求方式改为PUT，就是修改了。不过修改必须指定id，</p>
<ul>
<li>id对应文档存在，则修改</li>
<li>id对应文档不存在，则新增</li>
</ul>
<p>比如，我们把id为3的数据进行修改：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">PUT /goods/docs/<span class="token number">2</span>
<span class="token punctuation">{</span>
    <span class="token property">"title"</span><span class="token operator">:</span><span class="token string">"超大米手机"</span><span class="token punctuation">,</span>
    <span class="token property">"images"</span><span class="token operator">:</span><span class="token string">"http://image.leyou.com/12479122.jpg"</span><span class="token punctuation">,</span>
    <span class="token property">"price"</span><span class="token operator">:</span><span class="token number">3899.00</span><span class="token punctuation">,</span>
    <span class="token property">"stock"</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
    <span class="token property">"saleable"</span><span class="token operator">:</span><span class="token boolean">true</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>结果：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"took"</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token property">"timed_out"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">"_shards"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token property">"successful"</span> <span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token property">"skipped"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"failed"</span> <span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token property">"max_score"</span> <span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
    <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"goods"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"docs"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"2"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"title"</span> <span class="token operator">:</span> <span class="token string">"超大米手机"</span><span class="token punctuation">,</span>
          <span class="token property">"images"</span> <span class="token operator">:</span> <span class="token string">"http://image.leyou.com/12479122.jpg"</span><span class="token punctuation">,</span>
          <span class="token property">"price"</span> <span class="token operator">:</span> <span class="token number">3899.0</span><span class="token punctuation">,</span>
          <span class="token property">"stock"</span> <span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
          <span class="token property">"saleable"</span> <span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="5）删除数据"><a href="#5）删除数据" class="headerlink" title="5）删除数据"></a>5）删除数据</h3><p>删除使用DELETE请求，同样，需要根据id进行删除：</p>
<blockquote>
<p>语法</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">DELETE /索引库名/类型名/id值<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<blockquote>
<p>示例：</p>
</blockquote>
<p><img src="%E4%B9%90%E4%BC%98%E7%94%B5%E5%95%86-06-%E5%95%86%E5%93%81%E6%90%9C%E7%B4%A2%E5%88%86%E6%9E%90.assets/1598929667944.png" alt="1598929667944"></p>
<pre class="line-numbers language-yml" data-language="yml"><code class="language-yml"><span class="token comment"># 创建索引库</span>
PUT /goods
<span class="token punctuation">{</span>
  <span class="token key atrule">"settings"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token key atrule">"number_of_shards"</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token key atrule">"number_of_replicas"</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment"># 删除索引库</span>
DELETE /goods

<span class="token comment"># 新增数据</span>
<span class="token comment"># 方式一：随机生成文档ID</span>
POST /goods/docs
<span class="token punctuation">{</span>
    "title"<span class="token punctuation">:</span><span class="token string">"小米手机"</span><span class="token punctuation">,</span>
    "images"<span class="token punctuation">:</span><span class="token string">"http://image.leyou.com/12479122.jpg"</span><span class="token punctuation">,</span>
    "price"<span class="token punctuation">:</span><span class="token number">2699.00</span>
<span class="token punctuation">}</span>
<span class="token comment"># 方式二：指定文档ID</span>
POST /goods/docs/2
<span class="token punctuation">{</span>
    "title"<span class="token punctuation">:</span><span class="token string">"华为手机"</span><span class="token punctuation">,</span>
    "images"<span class="token punctuation">:</span><span class="token string">"http://image.leyou.com/12479123.jpg"</span><span class="token punctuation">,</span>
    "price"<span class="token punctuation">:</span><span class="token number">3699.00</span>
<span class="token punctuation">}</span>

<span class="token comment"># 修改数据</span>
PUT /goods/docs/2
<span class="token punctuation">{</span>
    "title"<span class="token punctuation">:</span><span class="token string">"360手机"</span><span class="token punctuation">,</span>
    "images"<span class="token punctuation">:</span><span class="token string">"http://image.leyou.com/12479123.jpg"</span><span class="token punctuation">,</span>
    "price"<span class="token punctuation">:</span><span class="token number">3699.00</span>
<span class="token punctuation">}</span>

<span class="token comment"># 删除速记</span>
DELETE /goods/docs/2
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>






<h2 id="05、ES的REST风格API：基本查询（了解）"><a href="#05、ES的REST风格API：基本查询（了解）" class="headerlink" title="05、ES的REST风格API：基本查询（了解）"></a>05、ES的REST风格API：基本查询（了解）</h2><h3 id="1）查询基本语法"><a href="#1）查询基本语法" class="headerlink" title="1）查询基本语法"></a>1）查询基本语法</h3><blockquote>
<p>基本语法</p>
</blockquote>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">GET /索引库名/_search
<span class="token punctuation">{</span>
    <span class="token property">"query"</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token property">"查询类型"</span><span class="token operator">:</span><span class="token punctuation">{</span>
            <span class="token property">"查询条件"</span><span class="token operator">:</span><span class="token string">"查询条件值"</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这里的query代表一个查询对象，里面可以有不同的查询属性</p>
<ul>
<li>查询类型：<ul>
<li>例如：<code>match_all</code>，&nbsp;<code>match</code>，<code>term</code>&nbsp;，&nbsp;<code>range</code> 等等</li>
</ul>
</li>
<li>查询条件：查询条件会根据类型的不同，写法也有差异，后面详细讲解</li>
</ul>
<p>导入测试数据：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">PUT <span class="token operator">/</span>goods
<span class="token punctuation">{</span>
  <span class="token string">"settings"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">"number_of_shards"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token string">"number_of_replicas"</span><span class="token operator">:</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

POST <span class="token operator">/</span>goods<span class="token operator">/</span>docs<span class="token operator">/</span><span class="token number">1</span>
<span class="token punctuation">{</span>
  <span class="token string">"title"</span><span class="token operator">:</span><span class="token string">"小米Redmi K30"</span><span class="token punctuation">,</span>
  <span class="token string">"subTitle"</span><span class="token operator">:</span><span class="token string">"小米手机 120Hz流速屏，王一博同款火爆开售"</span><span class="token punctuation">,</span>
  <span class="token string">"category"</span><span class="token operator">:</span><span class="token string">"手机"</span><span class="token punctuation">,</span>
  <span class="token string">"price"</span><span class="token operator">:</span> <span class="token number">1500</span>
<span class="token punctuation">}</span>

POST <span class="token operator">/</span>goods<span class="token operator">/</span>docs<span class="token operator">/</span><span class="token number">2</span>
<span class="token punctuation">{</span>
  <span class="token string">"title"</span><span class="token operator">:</span><span class="token string">"小米Redmi 8A"</span><span class="token punctuation">,</span>
  <span class="token string">"subTitle"</span><span class="token operator">:</span><span class="token string">"小米手机 5000mAh大电量,支持18W快充,Type-C充电接口,6.22英寸水滴屏"</span><span class="token punctuation">,</span>
  <span class="token string">"category"</span><span class="token operator">:</span><span class="token string">"手机"</span><span class="token punctuation">,</span>
  <span class="token string">"price"</span><span class="token operator">:</span> <span class="token number">700</span>
<span class="token punctuation">}</span>

POST <span class="token operator">/</span>goods<span class="token operator">/</span>docs<span class="token operator">/</span><span class="token number">3</span>
<span class="token punctuation">{</span>
  <span class="token string">"title"</span><span class="token operator">:</span><span class="token string">"小米电视"</span><span class="token punctuation">,</span>
  <span class="token string">"subTitle"</span><span class="token operator">:</span><span class="token string">"高清教育互联"</span><span class="token punctuation">,</span>
  <span class="token string">"category"</span><span class="token operator">:</span><span class="token string">"电视"</span><span class="token punctuation">,</span>
  <span class="token string">"price"</span><span class="token operator">:</span> <span class="token number">3500</span>
<span class="token punctuation">}</span>

POST <span class="token operator">/</span>goods<span class="token operator">/</span>docs<span class="token operator">/</span><span class="token number">4</span>
<span class="token punctuation">{</span>
  <span class="token string">"title"</span><span class="token operator">:</span><span class="token string">"华为P90"</span><span class="token punctuation">,</span>
  <span class="token string">"subTitle"</span><span class="token operator">:</span><span class="token string">"华为P90 高端大气上档次"</span><span class="token punctuation">,</span>
  <span class="token string">"category"</span><span class="token operator">:</span><span class="token string">"手机"</span><span class="token punctuation">,</span>
  <span class="token string">"price"</span><span class="token operator">:</span><span class="token number">2500</span>
<span class="token punctuation">}</span>

POST <span class="token operator">/</span>goods<span class="token operator">/</span>docs<span class="token operator">/</span><span class="token number">5</span>
<span class="token punctuation">{</span>
  <span class="token string">"title"</span><span class="token operator">:</span><span class="token string">"小米电视P10"</span><span class="token punctuation">,</span>
  <span class="token string">"subTitle"</span><span class="token operator">:</span><span class="token string">"小米电视P10 高端大气上档次"</span><span class="token punctuation">,</span>
  <span class="token string">"category"</span><span class="token operator">:</span><span class="token string">"电视"</span><span class="token punctuation">,</span>
  <span class="token string">"price"</span><span class="token operator">:</span><span class="token number">2900</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="2）查询所有（match-all"><a href="#2）查询所有（match-all" class="headerlink" title="2）查询所有（match_all)"></a>2）查询所有（match_all)</h3><blockquote>
<p>示例：</p>
</blockquote>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">GET /goods/_search
<span class="token punctuation">{</span>
    <span class="token property">"query"</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token property">"match_all"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><code>query</code>：代表查询对象</li>
<li><code>match_all</code>：代表查询所有</li>
</ul>
<blockquote>
<p>结果：</p>
</blockquote>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"took"</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token property">"timed_out"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">"_shards"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token property">"successful"</span> <span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token property">"skipped"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"failed"</span> <span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"max_score"</span> <span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
    <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"goods"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"docs"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"QGGcR3QBMpeF1wVyBCzk"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"title"</span> <span class="token operator">:</span> <span class="token string">"小米手机"</span><span class="token punctuation">,</span>
          <span class="token property">"images"</span> <span class="token operator">:</span> <span class="token string">"http://image.leyou.com/12479122.jpg"</span><span class="token punctuation">,</span>
          <span class="token property">"price"</span> <span class="token operator">:</span> <span class="token number">2699.0</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>took：查询花费时间，单位是毫秒</li>
<li>time_out：是否超时</li>
<li>_shards：分片信息</li>
<li>hits：搜索结果总览对象<ul>
<li>total：搜索到的总条数</li>
<li>max_score：所有结果中文档得分的最高分</li>
<li>hits：搜索结果的文档对象数组，每个元素是一条搜索到的文档信息<ul>
<li>_index：索引库</li>
<li>_type：文档类型</li>
<li>_id：文档id</li>
<li>_score：文档得分</li>
<li>_source：文档的源数据</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="3）匹配查询（match）"><a href="#3）匹配查询（match）" class="headerlink" title="3）匹配查询（match）"></a>3）匹配查询（match）</h3><p>匹配查询（会先分词再匹配）：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">GET /goods/_search
<span class="token punctuation">{</span>
  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"match"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"小米手机"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>结果：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"took"</span> <span class="token operator">:</span> <span class="token number">15</span><span class="token punctuation">,</span>
  <span class="token property">"timed_out"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">"_shards"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token property">"successful"</span> <span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token property">"skipped"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"failed"</span> <span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token property">"max_score"</span> <span class="token operator">:</span> <span class="token number">1.1507283</span><span class="token punctuation">,</span>
    <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"goods"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"docs"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"QGGcR3QBMpeF1wVyBCzk"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token number">1.1507283</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"title"</span> <span class="token operator">:</span> <span class="token string">"小米手机"</span><span class="token punctuation">,</span>
          <span class="token property">"images"</span> <span class="token operator">:</span> <span class="token string">"http://image.leyou.com/12479122.jpg"</span><span class="token punctuation">,</span>
          <span class="token property">"price"</span> <span class="token operator">:</span> <span class="token number">2699.0</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"goods"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"docs"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"3"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token number">0.5753642</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"title"</span> <span class="token operator">:</span> <span class="token string">"小米电视4A"</span><span class="token punctuation">,</span>
          <span class="token property">"images"</span> <span class="token operator">:</span> <span class="token string">"http://image.leyou.com/12479122.jpg"</span><span class="token punctuation">,</span>
          <span class="token property">"price"</span> <span class="token operator">:</span> <span class="token number">3899.0</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>在上面的案例中，不仅会查询到电视，而且与小米相关的都会查询到，多个词之间是<code>or</code>的关系。</p>
<ul>
<li>and关系</li>
</ul>
<p>某些情况下，我们需要更精确查找，我们希望这个关系变成<code>and</code>，可以这样做：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">GET /heima/_search
<span class="token punctuation">{</span>
    <span class="token property">"query"</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token property">"match"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"title"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"query"</span><span class="token operator">:</span> <span class="token string">"小米电视"</span><span class="token punctuation">,</span>
            <span class="token property">"operator"</span><span class="token operator">:</span> <span class="token string">"and"</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>结果：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"took"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token property">"timed_out"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">"_shards"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"total"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token property">"successful"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token property">"skipped"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"failed"</span><span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"hits"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"total"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"max_score"</span><span class="token operator">:</span> <span class="token number">0.5753642</span><span class="token punctuation">,</span>
    <span class="token property">"hits"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"_index"</span><span class="token operator">:</span> <span class="token string">"heima"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span><span class="token operator">:</span> <span class="token string">"goods"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span><span class="token operator">:</span> <span class="token string">"3"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span><span class="token operator">:</span> <span class="token number">0.5753642</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"小米电视4A"</span><span class="token punctuation">,</span>
          <span class="token property">"images"</span><span class="token operator">:</span> <span class="token string">"http://image.leyou.com/12479122.jpg"</span><span class="token punctuation">,</span>
          <span class="token property">"price"</span><span class="token operator">:</span> <span class="token number">3899</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>本例中，只有同时包含<code>小米</code>和<code>电视</code>的词条才会被搜索到。</p>
<h3 id="4）多字段查询（multi-match）"><a href="#4）多字段查询（multi-match）" class="headerlink" title="4）多字段查询（multi_match）"></a>4）多字段查询（multi_match）</h3><p><code>multi_match</code>与<code>match</code>类似，不同的是它可以在多个字段中查询</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">GET /goods/_search
<span class="token punctuation">{</span>
  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"multi_match"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"query"</span><span class="token operator">:</span> <span class="token string">"小米高端大气"</span><span class="token punctuation">,</span>
      <span class="token property">"fields"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"title"</span><span class="token punctuation">,</span><span class="token string">"subTitle"</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<pre class="line-numbers language-yml" data-language="yml"><code class="language-yml"><span class="token comment"># 查询全部</span>
GET /goods/_search
<span class="token punctuation">{</span>
  <span class="token key atrule">"query"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token key atrule">"match_all"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment"># 匹配查询（match ，先分词再查询）</span>
GET /goods/_search
<span class="token punctuation">{</span>
  <span class="token key atrule">"query"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token key atrule">"match"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token key atrule">"title"</span><span class="token punctuation">:</span> <span class="token string">"小米电视"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment"># 匹配查询（match + or/and ）</span>

GET /goods/_search
<span class="token punctuation">{</span>
  <span class="token key atrule">"query"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token key atrule">"match"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token key atrule">"title"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token key atrule">"query"</span><span class="token punctuation">:</span> <span class="token string">"小米电视"</span><span class="token punctuation">,</span>
        <span class="token key atrule">"operator"</span><span class="token punctuation">:</span> <span class="token string">"and"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment"># 多字段匹配（multi_match）</span>
GET /goods/_search
<span class="token punctuation">{</span>
  <span class="token key atrule">"query"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token key atrule">"multi_match"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token key atrule">"query"</span><span class="token punctuation">:</span> <span class="token string">"小米"</span><span class="token punctuation">,</span>
      <span class="token key atrule">"fields"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"title"</span><span class="token punctuation">,</span><span class="token string">"subTitle"</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>



<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="5）词条匹配-term"><a href="#5）词条匹配-term" class="headerlink" title="5）词条匹配(term)"></a>5）词条匹配(term)</h3><p><code>term</code> 查询被用于精确值 匹配，这些精确值可能是数字、时间、布尔或者那些<strong>未分词</strong>的字符串</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">GET /goods/_search
<span class="token punctuation">{</span>
  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"term"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"price"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"value"</span><span class="token operator">:</span> <span class="token number">2500</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>结果：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"took"</span> <span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span>
  <span class="token property">"timed_out"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">"_shards"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"successful"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"skipped"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"failed"</span> <span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"max_score"</span> <span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
    <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"goods"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"docs"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"4"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"title"</span> <span class="token operator">:</span> <span class="token string">"华为P90"</span><span class="token punctuation">,</span>
          <span class="token property">"subTitle"</span> <span class="token operator">:</span> <span class="token string">"华为P90 高端大气上档次"</span><span class="token punctuation">,</span>
          <span class="token property">"category"</span> <span class="token operator">:</span> <span class="token string">"手机"</span><span class="token punctuation">,</span>
          <span class="token property">"price"</span> <span class="token operator">:</span> <span class="token number">2500</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="6）多词条精确匹配-terms"><a href="#6）多词条精确匹配-terms" class="headerlink" title="6）多词条精确匹配(terms)"></a>6）多词条精确匹配(terms)</h3><p><code>terms</code> 查询和 term 查询一样，但它允许你指定多值进行匹配。如果这个字段包含了指定值中的任何一个值，那么这个文档满足条件：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">GET /goods/_search
<span class="token punctuation">{</span>
  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"terms"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"price"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token number">4899.0</span><span class="token punctuation">,</span>
        <span class="token number">2699.0</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>结果：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"took"</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token property">"timed_out"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">"_shards"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token property">"successful"</span> <span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token property">"skipped"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"failed"</span> <span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token property">"max_score"</span> <span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
    <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"goods"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"docs"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"4"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"title"</span> <span class="token operator">:</span> <span class="token string">"华为手机"</span><span class="token punctuation">,</span>
          <span class="token property">"subTitle"</span> <span class="token operator">:</span> <span class="token string">"小米"</span><span class="token punctuation">,</span>
          <span class="token property">"images"</span> <span class="token operator">:</span> <span class="token string">"http://image.leyou.com/12479124.jpg"</span><span class="token punctuation">,</span>
          <span class="token property">"price"</span> <span class="token operator">:</span> <span class="token number">4899.0</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"goods"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"docs"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"QGGcR3QBMpeF1wVyBCzk"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"title"</span> <span class="token operator">:</span> <span class="token string">"小米手机"</span><span class="token punctuation">,</span>
          <span class="token property">"images"</span> <span class="token operator">:</span> <span class="token string">"http://image.leyou.com/12479122.jpg"</span><span class="token punctuation">,</span>
          <span class="token property">"price"</span> <span class="token operator">:</span> <span class="token number">2699.0</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="7）结果过滤-source"><a href="#7）结果过滤-source" class="headerlink" title="7）结果过滤(_source)"></a>7）结果过滤(_source)</h3><p>默认情况下，elasticsearch在搜索的结果中，会把文档中保存在<code>_source</code>的所有字段都返回。</p>
<p>如果我们只想获取其中的部分字段，我们可以添加<code>_source</code>的过滤</p>
<h4 id="直接指定字段"><a href="#直接指定字段" class="headerlink" title="直接指定字段"></a>直接指定字段</h4><p>示例：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">GET /goods/_search
<span class="token punctuation">{</span>
  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"term"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"price"</span><span class="token operator">:</span> <span class="token number">4899.0</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"_source"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"title"</span><span class="token punctuation">,</span><span class="token string">"price"</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>返回的结果：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"took"</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token property">"timed_out"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">"_shards"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token property">"successful"</span> <span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token property">"skipped"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"failed"</span> <span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"max_score"</span> <span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
    <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"goods"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"docs"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"4"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"price"</span> <span class="token operator">:</span> <span class="token number">4899.0</span><span class="token punctuation">,</span>
          <span class="token property">"title"</span> <span class="token operator">:</span> <span class="token string">"华为手机"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="指定includes和excludes"><a href="#指定includes和excludes" class="headerlink" title="指定includes和excludes"></a>指定includes和excludes</h4><p>我们也可以通过：</p>
<ul>
<li>includes：来指定想要显示的字段</li>
<li>excludes：来指定不想要显示的字段</li>
</ul>
<p>二者都是可选的。</p>
<p>includes示例：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">GET /goods/_search
<span class="token punctuation">{</span>
  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"term"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"price"</span><span class="token operator">:</span> <span class="token number">4899.0</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"_source"</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token property">"includes"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"title"</span><span class="token punctuation">,</span><span class="token string">"subTitle"</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>excludes示例：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">GET /goods/_search
<span class="token punctuation">{</span>
  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"term"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"price"</span><span class="token operator">:</span> <span class="token number">4899.0</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"_source"</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token property">"excludes"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"images"</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="8）布尔组合（bool"><a href="#8）布尔组合（bool" class="headerlink" title="8）布尔组合（bool)"></a>8）布尔组合（bool)</h3><p><code>bool</code>把各种其它查询通过<code>must</code>（与）、<code>must_not</code>（非）、<code>should</code>（或）的方式进行组合</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">GET /goods/_search
<span class="token punctuation">{</span>
  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token property">"bool"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
       <span class="token property">"must"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
         <span class="token punctuation">{</span>
           <span class="token property">"match"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
             <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"小米"</span>
           <span class="token punctuation">}</span>
         <span class="token punctuation">}</span><span class="token punctuation">,</span>
         <span class="token punctuation">{</span>
           <span class="token property">"match"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
             <span class="token property">"subTitle"</span><span class="token operator">:</span> <span class="token string">"小米"</span>
           <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
       <span class="token punctuation">]</span>
     <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>结果：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"took"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">"timed_out"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">"_shards"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"successful"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"skipped"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"failed"</span> <span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token property">"max_score"</span> <span class="token operator">:</span> <span class="token number">0.18232156</span><span class="token punctuation">,</span>
    <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"item"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"docs"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"2"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token number">0.18232156</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"id"</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
          <span class="token property">"title"</span> <span class="token operator">:</span> <span class="token string">"坚果手机R1"</span><span class="token punctuation">,</span>
          <span class="token property">"category"</span> <span class="token operator">:</span> <span class="token string">"手机"</span><span class="token punctuation">,</span>
          <span class="token property">"brand"</span> <span class="token operator">:</span> <span class="token string">"锤子"</span><span class="token punctuation">,</span>
          <span class="token property">"price"</span> <span class="token operator">:</span> <span class="token number">3699.0</span><span class="token punctuation">,</span>
          <span class="token property">"images"</span> <span class="token operator">:</span> <span class="token string">"http://image.leyou.com/123.jpg"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"item"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"docs"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"3"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token number">0.18232156</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"id"</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
          <span class="token property">"title"</span> <span class="token operator">:</span> <span class="token string">"华为META10"</span><span class="token punctuation">,</span>
          <span class="token property">"category"</span> <span class="token operator">:</span> <span class="token string">"手机"</span><span class="token punctuation">,</span>
          <span class="token property">"brand"</span> <span class="token operator">:</span> <span class="token string">"华为"</span><span class="token punctuation">,</span>
          <span class="token property">"price"</span> <span class="token operator">:</span> <span class="token number">4499.0</span><span class="token punctuation">,</span>
          <span class="token property">"images"</span> <span class="token operator">:</span> <span class="token string">"http://image.leyou.com/3.jpg"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="9）过滤条件-filter"><a href="#9）过滤条件-filter" class="headerlink" title="9）过滤条件(filter)"></a>9）过滤条件(filter)</h3><p>所有的查询都会影响到文档的评分及排名。如果我们需要在查询结果中进行过滤，并且不希望过滤条件影响评分，那么就不要把过滤条件作为查询条件来用。而是使用<code>filter</code>方式：</p>
<p>注意：<code>filter</code>通常和bool一起使用（在bool基础上进行过滤）。</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">GET /goods/_search
<span class="token punctuation">{</span>
  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token property">"bool"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
       <span class="token property">"must"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
         <span class="token punctuation">{</span>
           <span class="token property">"match"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
             <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"小米"</span>
           <span class="token punctuation">}</span>
         <span class="token punctuation">}</span><span class="token punctuation">,</span>
         <span class="token punctuation">{</span>
           <span class="token property">"match"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
             <span class="token property">"subTitle"</span><span class="token operator">:</span> <span class="token string">"小米"</span>
           <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
       <span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token property">"filter"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
         <span class="token property">"term"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
           <span class="token property">"category.keyword"</span><span class="token operator">:</span> <span class="token string">"手机"</span>
         <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<pre class="line-numbers language-yml" data-language="yml"><code class="language-yml"><span class="token comment"># 查询所有数据 (match_all)</span>
GET /goods/_search
<span class="token punctuation">{</span>
  <span class="token key atrule">"query"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token key atrule">"match_all"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>


<span class="token comment"># 匹配查询（match：分词搜索）</span>
GET /goods/_search
<span class="token punctuation">{</span>
  <span class="token key atrule">"query"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token key atrule">"match"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token key atrule">"title"</span><span class="token punctuation">:</span> <span class="token string">"小米"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>

<span class="token comment"># 多字段匹配查询（multi_match：分词搜索）</span>
GET /goods/_search
<span class="token punctuation">{</span>
  <span class="token key atrule">"query"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token key atrule">"multi_match"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token key atrule">"query"</span><span class="token punctuation">:</span> <span class="token string">"小米"</span><span class="token punctuation">,</span>
      <span class="token key atrule">"fields"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"title"</span><span class="token punctuation">,</span><span class="token string">"subTitle"</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>

<span class="token comment"># 词条搜索（term: 不分词搜索）</span>
GET /goods/_search
<span class="token punctuation">{</span>
  <span class="token key atrule">"query"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token key atrule">"term"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token key atrule">"price"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token key atrule">"value"</span><span class="token punctuation">:</span> <span class="token number">700</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment"># 多词条搜索（terms: 不分词搜索）</span>
GET /goods/_search
<span class="token punctuation">{</span>
  <span class="token key atrule">"query"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token key atrule">"terms"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token key atrule">"price"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token number">700</span><span class="token punctuation">,</span>
        <span class="token number">2900</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment"># 结果过滤(_source)</span>
<span class="token comment"># 形式一:</span>
GET /goods/_search
<span class="token punctuation">{</span>
  <span class="token key atrule">"query"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token key atrule">"match_all"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token key atrule">"_source"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"title"</span><span class="token punctuation">,</span><span class="token string">"price"</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token comment"># 形式二</span>
GET /goods/_search
<span class="token punctuation">{</span>
  <span class="token key atrule">"query"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token key atrule">"match_all"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token key atrule">"_source"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token key atrule">"excludes"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"subTitle"</span><span class="token punctuation">,</span><span class="token string">"category"</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment"># 布尔组合</span>
GET /goods/_search
<span class="token punctuation">{</span>
  <span class="token key atrule">"query"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token key atrule">"bool"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token key atrule">"should"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token key atrule">"match"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token key atrule">"title"</span><span class="token punctuation">:</span> <span class="token string">"小米"</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token key atrule">"terms"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token key atrule">"price"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
              <span class="token number">700</span><span class="token punctuation">,</span>
              <span class="token number">2900</span>
            <span class="token punctuation">]</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>  
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment"># 过滤条件（filter）</span>
GET /goods/_search
<span class="token punctuation">{</span>
  <span class="token key atrule">"query"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token key atrule">"bool"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token key atrule">"should"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token key atrule">"match"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token key atrule">"title"</span><span class="token punctuation">:</span> <span class="token string">"小米"</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token key atrule">"filter"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token key atrule">"terms"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
          <span class="token key atrule">"price"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token number">700</span><span class="token punctuation">,</span>
            <span class="token number">2900</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>  
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>




<h2 id="06、ES的REST风格API：聚合查询-aggregations-（了解）"><a href="#06、ES的REST风格API：聚合查询-aggregations-（了解）" class="headerlink" title="06、ES的REST风格API：聚合查询(aggregations)（了解）"></a>06、ES的REST风格API：聚合查询(aggregations)（了解）</h2><p>聚合可以让我们极其方便的实现对数据的统计、分析。例如：</p>
<ul>
<li>什么品牌的手机最受欢迎？</li>
<li>这些手机的平均价格、最高价格、最低价格？</li>
<li>这些手机每月的销售情况如何？</li>
</ul>
<p>实现这些统计功能的比数据库的sql要方便的多，而且查询速度非常快，可以实现实时搜索效果。</p>
<h3 id="1）聚合基本概念"><a href="#1）聚合基本概念" class="headerlink" title="1）聚合基本概念"></a>1）聚合基本概念</h3><p>Elasticsearch中的聚合，包含多种类型，最常用的两种，一个叫<code>桶</code>，一个叫<code>度量</code>：</p>
<blockquote>
<p><strong>桶（bucket）</strong></p>
</blockquote>
<p>桶的作用，是按照某种方式对数据进行分组，每一组数据在ES中称为一个<code>桶</code>，例如我们根据国籍对人划分，可以得到<code>中国桶</code>、<code>英国桶</code>，<code>日本桶</code>……或者我们按照年龄段对人进行划分：0<del>10,10</del>20,20<del>30,30</del>40等。</p>
<p>Elasticsearch中提供的划分桶的方式有很多：</p>
<ul>
<li>Date Histogram Aggregation：根据日期阶梯分组，例如给定阶梯为周，会自动每周分为一组</li>
<li>Histogram Aggregation：根据数值阶梯分组，与日期类似</li>
<li>Terms Aggregation：根据词条内容分组，词条内容完全匹配的为一组</li>
<li>Range Aggregation：数值和日期的范围分组，指定开始和结束，然后按段分组</li>
<li>……</li>
</ul>
<p>bucket aggregations 只负责对数据进行分组，并不进行计算，因此往往bucket中往往会嵌套另一种聚合：metrics aggregations即度量</p>
<blockquote>
<p><strong>度量（metrics）</strong></p>
</blockquote>
<p>分组完成以后，我们一般会对组中的数据进行聚合运算，例如求平均值、最大、最小、求和等，这些在ES中称为<code>度量</code></p>
<p>比较常用的一些度量聚合方式：</p>
<ul>
<li>Avg Aggregation：求平均值</li>
<li>Max Aggregation：求最大值</li>
<li>Min Aggregation：求最小值</li>
<li>Percentiles Aggregation：求百分比</li>
<li>Stats Aggregation：同时返回avg、max、min、sum、count等</li>
<li>Sum Aggregation：求和</li>
<li>Top hits Aggregation：求前几</li>
<li>Value Count Aggregation：求总数</li>
<li>……</li>
</ul>
<p>为了测试聚合，我们先批量导入一些数据</p>
<p>创建索引：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">PUT /cars
<span class="token punctuation">{</span>
  <span class="token property">"settings"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"number_of_shards"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"number_of_replicas"</span><span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"mappings"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"transactions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"properties"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"color"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"keyword"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">"make"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"keyword"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>注意</strong>：在ES中，需要进行聚合、排序、过滤的字段其处理方式比较特殊，因此不能被分词。这里我们将color和make这两个文字类型的字段设置为keyword类型，这个类型不会被分词，将来就可以参与聚合</p>
<p>导入数据</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">POST /cars/transactions/_bulk
<span class="token punctuation">{</span> <span class="token property">"index"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token property">"price"</span> <span class="token operator">:</span> <span class="token number">10000</span><span class="token punctuation">,</span> <span class="token property">"color"</span> <span class="token operator">:</span> <span class="token string">"red"</span><span class="token punctuation">,</span> <span class="token property">"make"</span> <span class="token operator">:</span> <span class="token string">"honda"</span><span class="token punctuation">,</span> <span class="token property">"sold"</span> <span class="token operator">:</span> <span class="token string">"2014-10-28"</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token property">"index"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token property">"price"</span> <span class="token operator">:</span> <span class="token number">20000</span><span class="token punctuation">,</span> <span class="token property">"color"</span> <span class="token operator">:</span> <span class="token string">"red"</span><span class="token punctuation">,</span> <span class="token property">"make"</span> <span class="token operator">:</span> <span class="token string">"honda"</span><span class="token punctuation">,</span> <span class="token property">"sold"</span> <span class="token operator">:</span> <span class="token string">"2014-11-05"</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token property">"index"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token property">"price"</span> <span class="token operator">:</span> <span class="token number">30000</span><span class="token punctuation">,</span> <span class="token property">"color"</span> <span class="token operator">:</span> <span class="token string">"green"</span><span class="token punctuation">,</span> <span class="token property">"make"</span> <span class="token operator">:</span> <span class="token string">"ford"</span><span class="token punctuation">,</span> <span class="token property">"sold"</span> <span class="token operator">:</span> <span class="token string">"2014-05-18"</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token property">"index"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token property">"price"</span> <span class="token operator">:</span> <span class="token number">15000</span><span class="token punctuation">,</span> <span class="token property">"color"</span> <span class="token operator">:</span> <span class="token string">"blue"</span><span class="token punctuation">,</span> <span class="token property">"make"</span> <span class="token operator">:</span> <span class="token string">"toyota"</span><span class="token punctuation">,</span> <span class="token property">"sold"</span> <span class="token operator">:</span> <span class="token string">"2014-07-02"</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token property">"index"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token property">"price"</span> <span class="token operator">:</span> <span class="token number">12000</span><span class="token punctuation">,</span> <span class="token property">"color"</span> <span class="token operator">:</span> <span class="token string">"green"</span><span class="token punctuation">,</span> <span class="token property">"make"</span> <span class="token operator">:</span> <span class="token string">"toyota"</span><span class="token punctuation">,</span> <span class="token property">"sold"</span> <span class="token operator">:</span> <span class="token string">"2014-08-19"</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token property">"index"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token property">"price"</span> <span class="token operator">:</span> <span class="token number">20000</span><span class="token punctuation">,</span> <span class="token property">"color"</span> <span class="token operator">:</span> <span class="token string">"red"</span><span class="token punctuation">,</span> <span class="token property">"make"</span> <span class="token operator">:</span> <span class="token string">"honda"</span><span class="token punctuation">,</span> <span class="token property">"sold"</span> <span class="token operator">:</span> <span class="token string">"2014-11-05"</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token property">"index"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token property">"price"</span> <span class="token operator">:</span> <span class="token number">80000</span><span class="token punctuation">,</span> <span class="token property">"color"</span> <span class="token operator">:</span> <span class="token string">"red"</span><span class="token punctuation">,</span> <span class="token property">"make"</span> <span class="token operator">:</span> <span class="token string">"bmw"</span><span class="token punctuation">,</span> <span class="token property">"sold"</span> <span class="token operator">:</span> <span class="token string">"2014-01-01"</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token property">"index"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token property">"price"</span> <span class="token operator">:</span> <span class="token number">25000</span><span class="token punctuation">,</span> <span class="token property">"color"</span> <span class="token operator">:</span> <span class="token string">"blue"</span><span class="token punctuation">,</span> <span class="token property">"make"</span> <span class="token operator">:</span> <span class="token string">"ford"</span><span class="token punctuation">,</span> <span class="token property">"sold"</span> <span class="token operator">:</span> <span class="token string">"2014-02-12"</span> <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="2）聚合为桶-（Aggragation-for-Buket）"><a href="#2）聚合为桶-（Aggragation-for-Buket）" class="headerlink" title="2）聚合为桶 （Aggragation for Buket）"></a>2）聚合为桶 （Aggragation for Buket）</h3><p>聚合为桶其实就是分组统计！</p>
<p>首先，我们按照 汽车的颜色<code>color</code>来划分<code>桶</code></p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">GET /cars/_search
<span class="token punctuation">{</span>
    <span class="token property">"size"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"aggs"</span> <span class="token operator">:</span> <span class="token punctuation">{</span> 
        <span class="token property">"popular_colors"</span> <span class="token operator">:</span> <span class="token punctuation">{</span> 
            <span class="token property">"terms"</span> <span class="token operator">:</span> <span class="token punctuation">{</span> 
              <span class="token property">"field"</span> <span class="token operator">:</span> <span class="token string">"color"</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>size： 查询条数，这里设置为0，因为我们不关心搜索到的数据，只关心聚合结果，提高效率</li>
<li>aggs：声明这是一个聚合查询，是aggregations的缩写<ul>
<li>popular_colors：给这次聚合起一个名字，任意。<ul>
<li>terms：划分桶的方式，这里是根据词条划分<ul>
<li>field：划分桶的字段</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>结果：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"took"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">"timed_out"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">"_shards"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"total"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"successful"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"skipped"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"failed"</span><span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"hits"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"total"</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
    <span class="token property">"max_score"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"hits"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"aggregations"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"popular_colors"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"doc_count_error_upper_bound"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token property">"sum_other_doc_count"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token property">"buckets"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token property">"key"</span><span class="token operator">:</span> <span class="token string">"red"</span><span class="token punctuation">,</span>
          <span class="token property">"doc_count"</span><span class="token operator">:</span> <span class="token number">4</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token property">"key"</span><span class="token operator">:</span> <span class="token string">"blue"</span><span class="token punctuation">,</span>
          <span class="token property">"doc_count"</span><span class="token operator">:</span> <span class="token number">2</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token property">"key"</span><span class="token operator">:</span> <span class="token string">"green"</span><span class="token punctuation">,</span>
          <span class="token property">"doc_count"</span><span class="token operator">:</span> <span class="token number">2</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>hits：查询结果为空，因为我们设置了size为0</li>
<li>aggregations：聚合的结果</li>
<li>popular_colors：我们定义的聚合名称</li>
<li>buckets：查找到的桶，每个不同的color字段值都会形成一个桶<ul>
<li>key：这个桶对应的color字段的值</li>
<li>doc_count：这个桶中的文档数量</li>
</ul>
</li>
</ul>
<p>通过聚合的结果我们发现，目前红色的小车比较畅销！</p>
<pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"># 统计不同颜色的汽车分别有多少部？
# AGG_TYPE: 聚合类型
#  terms: 数量统计 类似count(*)
#  avg：平均值统计，使用在数值类型上面  (类似于avg)
#  sum: 求和总计  (类似于sum)
#  min/max...
GET /cars/_search
{
  "aggs": {
    "colorAgg": {
      "terms": {
        "field": "color"
      }
    }
  }
}

# 统计所有汽车的均价
GET /cars/_search
{
  "aggs": {
    "priceAgg": {
      "avg": {
        "field": "price"
      }
    }
  }
}

#统计honda的均价
GET /cars/_search
{
  "query": {
    "match": {
      "make": "honda"
    }
  },
  "aggs": {
    "priceAgg": {
      "avg": {
        "field": "price"
      }
    }
  }
}

# 统计不同颜色的汽车的均价分别是多少？
GET /cars/_search
{
  "aggs": {
    "colorAgg": {
      "terms": {
        "field": "color"
      },
      "aggs": {
        "priceAgg": {
          "avg": {
            "field": "price"
          }
        }
      }
    }
  }
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>






<h2 id="07、SpringDataElasticsearch：搭建项目-重点"><a href="#07、SpringDataElasticsearch：搭建项目-重点" class="headerlink" title="07、SpringDataElasticsearch：搭建项目(重点)"></a>07、SpringDataElasticsearch：搭建项目(重点)</h2><h3 id="1）SpringDataElasticsearch简介"><a href="#1）SpringDataElasticsearch简介" class="headerlink" title="1）SpringDataElasticsearch简介"></a>1）SpringDataElasticsearch简介</h3><p>Spring Data Elasticsearch是Spring Data项目下的一个子模块。</p>
<p>查看 Spring Data的官网：<a target="_blank" rel="noopener" href="http://projects.spring.io/spring-data/">http://projects.spring.io/spring-data/</a></p>
<p><img src="%E4%B9%90%E4%BC%98%E7%94%B5%E5%95%86-06-%E5%95%86%E5%93%81%E6%90%9C%E7%B4%A2%E5%88%86%E6%9E%90.assets/1598941387595.png" alt="1598941387595"></p>
<blockquote>
<p>Spring Data的使命是为数据访问提供熟悉且一致的基于Spring的编程模型，同时仍保留底层数据存储的特殊特性。</p>
<p>它使得使用数据访问技术，关系数据库和非关系数据库，map-reduce框架和基于云的数据服务变得容易。这是一个总括项目，其中包含许多特定于给定数据库的子项目。这些令人兴奋的技术项目背后，是由许多公司和开发人员合作开发的。</p>
</blockquote>
<p>Spring Data 的使命是给各种数据访问提供统一的编程接口，不管是关系型数据库（如MySQL），还是非关系数据库（如Redis），或者类似Elasticsearch这样的索引数据库。从而简化开发人员的代码，提高开发效率。</p>
<p>包含很多不同数据操作的模块：</p>
<p>&nbsp;<img src="乐优电商-06-商品搜索分析.assets/1598941429101.png" alt="1598941429101" style="zoom:67%;"></p>
<p>Spring Data Elasticsearch的页面：<a target="_blank" rel="noopener" href="https://projects.spring.io/spring-data-elasticsearch/">https://projects.spring.io/spring-data-elasticsearch/</a></p>
<p> &nbsp;<img src="%E4%B9%90%E4%BC%98%E7%94%B5%E5%95%86-06-%E5%95%86%E5%93%81%E6%90%9C%E7%B4%A2%E5%88%86%E6%9E%90.assets/1598941462401.png" alt="1598941462401"></p>
<p>特征：</p>
<ul>
<li>支持Spring的基于<code>@Configuration</code>的java配置方式，或者XML配置方式</li>
<li>提供了用于操作ES的便捷工具类**<code>ElasticsearchTemplate</code>**。包括实现文档到POJO之间的自动智能映射。</li>
<li>利用Spring的数据转换服务实现的功能丰富的对象映射</li>
<li>基于注解的元数据映射方式，而且可扩展以支持更多不同的数据格式</li>
<li>根据持久层接口自动生成对应实现方法，无需人工编写基本操作代码（类似mybatis，根据接口自动得到实现）。当然，也支持人工定制查询</li>
</ul>
<h3 id="2）搭建SpringDataElasticsearch环境"><a href="#2）搭建SpringDataElasticsearch环境" class="headerlink" title="2）搭建SpringDataElasticsearch环境"></a>2）搭建SpringDataElasticsearch环境</h3><h4 id="创建项目及导入依赖"><a href="#创建项目及导入依赖" class="headerlink" title="创建项目及导入依赖"></a>创建项目及导入依赖</h4><p>我们使用spring脚手架新建一个demo，学习Elasticsearch</p>
<p>&nbsp;<img src="%E4%B9%90%E4%BC%98%E7%94%B5%E5%95%86-06-%E5%95%86%E5%93%81%E6%90%9C%E7%B4%A2%E5%88%86%E6%9E%90.assets/1598942148323.png" alt="1598942148323"></p>
<p>pom依赖：</p>
<pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">"</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.itheima<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-data-es<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.1.6.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>relativePath</span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--spring data es--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-elasticsearch<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="application-yml配置"><a href="#application-yml配置" class="headerlink" title="application.yml配置"></a>application.yml配置</h4><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">data</span><span class="token punctuation">:</span>
    <span class="token key atrule">elasticsearch</span><span class="token punctuation">:</span>
      <span class="token key atrule">cluster-name</span><span class="token punctuation">:</span> elasticsearch <span class="token comment"># 集群名称</span>
      <span class="token key atrule">cluster-nodes</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">:</span><span class="token number">9300</span> <span class="token comment"># 节点地址</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="编写启动类"><a href="#编写启动类" class="headerlink" title="编写启动类"></a>编写启动类</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span><span class="token punctuation">;</span>

<span class="token comment">/**
 *
 */</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ESApplication</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ESApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="实体类及注解"><a href="#实体类及注解" class="headerlink" title="实体类及注解"></a>实体类及注解</h4><p>首先我们准备好实体类：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Item</span> <span class="token punctuation">{</span>
    <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
    <span class="token class-name">String</span> title<span class="token punctuation">;</span> <span class="token comment">//标题</span>
    <span class="token class-name">String</span> category<span class="token punctuation">;</span><span class="token comment">// 分类</span>
    <span class="token class-name">String</span> brand<span class="token punctuation">;</span> <span class="token comment">// 品牌</span>
    <span class="token class-name">Double</span> price<span class="token punctuation">;</span> <span class="token comment">// 价格</span>
    <span class="token class-name">String</span> images<span class="token punctuation">;</span> <span class="token comment">// 图片地址</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>映射</p>
</blockquote>
<p>Spring Data通过注解来声明字段的映射属性，有下面的三个注解：</p>
<ul>
<li><code>@Document</code> 作用在类，标记实体类为文档对象，一般有四个属性<ul>
<li>indexName：对应索引库名称</li>
<li>type：对应在索引库中的类型</li>
<li>shards：分片数量，默认5</li>
<li>replicas：副本数量，默认1</li>
</ul>
</li>
<li><code>@Id</code> 作用在成员变量，标记一个字段作为id主键</li>
<li><code>@Field</code> 作用在成员变量，标记为文档的字段，并指定字段映射属性：<ul>
<li>type：字段类型，取值是枚举：FieldType</li>
<li>index：是否索引，布尔类型，默认是true</li>
<li>store：是否存储，布尔类型，默认是false</li>
<li>analyzer：分词器名称：ik_max_word</li>
</ul>
</li>
</ul>
<p>示例：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>pojo</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">AllArgsConstructor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">NoArgsConstructor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Id</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Document</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Field</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">FieldType</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 商品
 *   @Document: 映射文档
 *     indexName: 索引库名称
 *     type: 类型名称
 *     shards: 分片数
 *     replicas: 副本数
 *   @Id: 映射ES的文档ID
 *   @Field： 映射域（字段）
 *     type: 域的类型
 *        常用的类型说明：
 *            Text： 字符串类型，一般用在需要索引和分词的域
 *            Keyword： 字符串类型，一般用在不分词的域上面
 *            Integer/Long/Float/Date/Double/Boolean: 普通类型，这些类型不能分词的
 *            Object： 对象类型（可能List,Map,Set等） 集合类型(List,Map)默认都是索引分词的。
 *				(注意：在ES中如果集合类型（List,Map），那么集合中的每个对象的每个属性（值）默认都是索引且分词的)  
 *				（注意：在ES中数值不会分词）
 *     index
 *         是否索引。默认索引  是否索引取决于该域是否作为搜索条件
 *     analyzer
 *        用在索引和分词的域上面，指定分词器算法的。ik_max_word  ik_smart
 *              ik_smart: 最小分词器， 我是程序员  -&gt; 我  是  程序员
 *              ik_max_word： 最细分词器 ， 我是程序员  -&gt; 我  是  程序员  程序  员
 *		  不指定默认使用标准分词（单字分词）
 *		  
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@Document</span><span class="token punctuation">(</span>indexName <span class="token operator">=</span> <span class="token string">"goods"</span><span class="token punctuation">,</span>type <span class="token operator">=</span> <span class="token string">"docs"</span> <span class="token punctuation">,</span>shards <span class="token operator">=</span> <span class="token number">5</span> <span class="token punctuation">,</span>replicas <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Item</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FieldType<span class="token punctuation">.</span>Text</span><span class="token punctuation">,</span>analyzer <span class="token operator">=</span> <span class="token string">"ik_max_word"</span> <span class="token punctuation">)</span>
    <span class="token class-name">String</span> title<span class="token punctuation">;</span> <span class="token comment">//标题</span>
    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>type <span class="token operator">=</span><span class="token class-name">FieldType<span class="token punctuation">.</span>Keyword</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> category<span class="token punctuation">;</span><span class="token comment">// 分类</span>
    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>type <span class="token operator">=</span><span class="token class-name">FieldType<span class="token punctuation">.</span>Keyword</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> brand<span class="token punctuation">;</span> <span class="token comment">// 品牌</span>
    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FieldType<span class="token punctuation">.</span>Double</span><span class="token punctuation">)</span>
    <span class="token class-name">Double</span> price<span class="token punctuation">;</span> <span class="token comment">// 价格</span>
    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FieldType<span class="token punctuation">.</span>Keyword</span><span class="token punctuation">,</span>index <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> images<span class="token punctuation">;</span> <span class="token comment">// 图片地址</span>
<span class="token punctuation">}</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>




<h2 id="08、SpringDataElasticsearch：基本CRUD-重点"><a href="#08、SpringDataElasticsearch：基本CRUD-重点" class="headerlink" title="08、SpringDataElasticsearch：基本CRUD(重点)"></a>08、SpringDataElasticsearch：基本CRUD(重点)</h2><h3 id="1）编写Repository接口"><a href="#1）编写Repository接口" class="headerlink" title="1）编写Repository接口"></a>1）编写Repository接口</h3><p>Spring Data 的强大之处，就在于你不用写任何DAO处理，自动根据方法名或类的信息进行CRUD操作。只要你定义一个接口，然后继承Repository提供的一些子接口，就能具备各种基本的CRUD功能。</p>
<p>我们只需要定义接口，然后继承它就OK了。</p>
<p> <img src="%E4%B9%90%E4%BC%98%E7%94%B5%E5%95%86-06-%E5%95%86%E5%93%81%E6%90%9C%E7%B4%A2%E5%88%86%E6%9E%90.assets/1531987244855.png" alt="1531987244855"></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ithiema<span class="token punctuation">.</span>repository</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>ithiema<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">Item</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>repository<span class="token punctuation">.</span></span><span class="token class-name">ElasticsearchRepository</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * Dao接口
 * 泛型一：操作的实体类类型
 * 泛型二：实体类的ID类型
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ItemRepository</span> <span class="token keyword">extends</span> <span class="token class-name">ElasticsearchRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Item</span><span class="token punctuation">,</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>来看下Repository的继承关系：</p>
<p> <img src="%E4%B9%90%E4%BC%98%E7%94%B5%E5%95%86-06-%E5%95%86%E5%93%81%E6%90%9C%E7%B4%A2%E5%88%86%E6%9E%90.assets/1531986965570.png" alt="1531986965570"></p>
<p>我们看到有一个ElasticsearchRepository接口：</p>
<p><img src="%E4%B9%90%E4%BC%98%E7%94%B5%E5%95%86-06-%E5%95%86%E5%93%81%E6%90%9C%E7%B4%A2%E5%88%86%E6%9E%90.assets/1531987044693.png" alt="1531987044693"></p>
<h3 id="2）新增文档"><a href="#2）新增文档" class="headerlink" title="2）新增文档"></a>2）新增文档</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itcast</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">Item</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>repository<span class="token punctuation">.</span></span><span class="token class-name">ItemRepository</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner<span class="token punctuation">.</span></span><span class="token class-name">RunWith</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">ContextConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4<span class="token punctuation">.</span></span><span class="token class-name">SpringJUnit4ClassRunner</span><span class="token punctuation">;</span>

<span class="token comment">/**
 *
 */</span>
<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringJUnit4ClassRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootTest</span><span class="token punctuation">(</span>classes <span class="token operator">=</span> <span class="token class-name">ESApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EsDemo1</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ItemRepository</span> itemRepository<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Item</span> item <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Item</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">,</span> <span class="token string">"小米手机7"</span><span class="token punctuation">,</span> <span class="token string">"手机"</span><span class="token punctuation">,</span>
                <span class="token string">"小米"</span><span class="token punctuation">,</span> <span class="token number">3499.00</span><span class="token punctuation">,</span> <span class="token string">"http://image.leyou.com/13123.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        itemRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>去页面查询看看：</p>
<pre class="line-numbers language-none"><code class="language-none">GET /goods/_search<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>结果：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"took"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">"timed_out"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">"_shards"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"successful"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"skipped"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"failed"</span> <span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"max_score"</span> <span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
    <span class="token property">"hits"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"goods"</span><span class="token punctuation">,</span>
        <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"docs"</span><span class="token punctuation">,</span>
        <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>
        <span class="token property">"_score"</span> <span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
        <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"id"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
          <span class="token property">"title"</span> <span class="token operator">:</span> <span class="token string">"小米手机7"</span><span class="token punctuation">,</span>
          <span class="token property">"category"</span> <span class="token operator">:</span> <span class="token string">"手机"</span><span class="token punctuation">,</span>
          <span class="token property">"brand"</span> <span class="token operator">:</span> <span class="token string">"小米"</span><span class="token punctuation">,</span>
          <span class="token property">"price"</span> <span class="token operator">:</span> <span class="token number">3499.0</span><span class="token punctuation">,</span>
          <span class="token property">"images"</span> <span class="token operator">:</span> <span class="token string">"http://image.leyou.com/13123.jpg"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="3）批量新增"><a href="#3）批量新增" class="headerlink" title="3）批量新增"></a>3）批量新增</h3><p>代码：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">   <span class="token comment">/**
  * 批量新增索引
  */</span>
<span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testBatchSave</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Item</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Item</span><span class="token punctuation">(</span><span class="token number">2L</span><span class="token punctuation">,</span> <span class="token string">"坚果手机R1"</span><span class="token punctuation">,</span> <span class="token string">"手机"</span><span class="token punctuation">,</span><span class="token string">"锤子"</span><span class="token punctuation">,</span> <span class="token number">3699.00</span><span class="token punctuation">,</span> <span class="token string">"http://image.leyou.com/13124.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Item</span><span class="token punctuation">(</span><span class="token number">3L</span><span class="token punctuation">,</span> <span class="token string">"华为META10"</span><span class="token punctuation">,</span> <span class="token string">"手机"</span><span class="token punctuation">,</span><span class="token string">"华为"</span><span class="token punctuation">,</span> <span class="token number">4499.00</span><span class="token punctuation">,</span> <span class="token string">"http://image.leyou.com/13125.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Item</span><span class="token punctuation">(</span><span class="token number">4L</span><span class="token punctuation">,</span> <span class="token string">"小米电视1"</span><span class="token punctuation">,</span> <span class="token string">"电视"</span><span class="token punctuation">,</span><span class="token string">"小米"</span><span class="token punctuation">,</span> <span class="token number">5499.00</span><span class="token punctuation">,</span> <span class="token string">"http://image.leyou.com/13123.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Item</span><span class="token punctuation">(</span><span class="token number">5L</span><span class="token punctuation">,</span> <span class="token string">"小米手机8"</span><span class="token punctuation">,</span> <span class="token string">"手机"</span><span class="token punctuation">,</span><span class="token string">"小米"</span><span class="token punctuation">,</span> <span class="token number">2199.00</span><span class="token punctuation">,</span> <span class="token string">"http://image.leyou.com/13124.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        itemRepository<span class="token punctuation">.</span><span class="token function">saveAll</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="4）修改文档"><a href="#4）修改文档" class="headerlink" title="4）修改文档"></a>4）修改文档</h3><p>修改和新增是同一个接口，区分的依据就是id，这一点跟我们在页面发起PUT请求是类似的。</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * 修改索引
 */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">Item</span> item <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Item</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">,</span> <span class="token string">"小米手机8"</span><span class="token punctuation">,</span> <span class="token string">"手机"</span><span class="token punctuation">,</span>
            <span class="token string">"小米"</span><span class="token punctuation">,</span> <span class="token number">4499.00</span><span class="token punctuation">,</span> <span class="token string">"http://image.leyou.com/13124.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    itemRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="5）简单查询"><a href="#5）简单查询" class="headerlink" title="5）简单查询"></a>5）简单查询</h3><p>ElasticsearchRepository提供了一些基本的查询方法：</p>
<p><img src="%E4%B9%90%E4%BC%98%E7%94%B5%E5%95%86-06-%E5%95%86%E5%93%81%E6%90%9C%E7%B4%A2%E5%88%86%E6%9E%90.assets/1531989728869.png" alt="1531989728869"></p>
<p>我们来试试查询所有：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
   * 查询所有
   */</span>
  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testFindAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Item</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> itemRepository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">/**
   * 根据id查询
   */</span>
  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testFindById</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token class-name">Item</span> item <span class="token operator">=</span> itemRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>结果：</p>
<p><img src="%E4%B9%90%E4%BC%98%E7%94%B5%E5%95%86-06-%E5%95%86%E5%93%81%E6%90%9C%E7%B4%A2%E5%88%86%E6%9E%90.assets/1531990510740.png" alt="1531990510740"></p>
<h3 id="6）删除文档"><a href="#6）删除文档" class="headerlink" title="6）删除文档"></a>6）删除文档</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * 删除索引
 */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDelete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">Item</span> item <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Item</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    item<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    itemRepository<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">Item</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>repository<span class="token punctuation">.</span></span><span class="token class-name">ItemRepository</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner<span class="token punctuation">.</span></span><span class="token class-name">RunWith</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4<span class="token punctuation">.</span></span><span class="token class-name">SpringJUnit4ClassRunner</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4<span class="token punctuation">.</span></span><span class="token class-name">SpringRunner</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 演示基本CRUD方法
 */</span>
<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringJUnit4ClassRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootTest</span><span class="token punctuation">(</span>classes <span class="token operator">=</span> <span class="token class-name">ESApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ESDemo1</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ItemRepository</span> itemRepository<span class="token punctuation">;</span>


    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSave</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Item</span> item <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Item</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">,</span> <span class="token string">"小米手机7"</span><span class="token punctuation">,</span> <span class="token string">"手机"</span><span class="token punctuation">,</span>
                <span class="token string">"小米"</span><span class="token punctuation">,</span> <span class="token number">3499.00</span><span class="token punctuation">,</span> <span class="token string">"http://image.leyou.com/13123.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        itemRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 批量添加
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSaveAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Item</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Item</span><span class="token punctuation">(</span><span class="token number">2L</span><span class="token punctuation">,</span> <span class="token string">"坚果手机R1"</span><span class="token punctuation">,</span> <span class="token string">"手机"</span><span class="token punctuation">,</span><span class="token string">"锤子"</span><span class="token punctuation">,</span> <span class="token number">3699.00</span><span class="token punctuation">,</span> <span class="token string">"http://image.leyou.com/13124.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Item</span><span class="token punctuation">(</span><span class="token number">3L</span><span class="token punctuation">,</span> <span class="token string">"华为META10"</span><span class="token punctuation">,</span> <span class="token string">"手机"</span><span class="token punctuation">,</span><span class="token string">"华为"</span><span class="token punctuation">,</span> <span class="token number">4499.00</span><span class="token punctuation">,</span> <span class="token string">"http://image.leyou.com/13125.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Item</span><span class="token punctuation">(</span><span class="token number">4L</span><span class="token punctuation">,</span> <span class="token string">"小米电视1"</span><span class="token punctuation">,</span> <span class="token string">"电视"</span><span class="token punctuation">,</span><span class="token string">"小米"</span><span class="token punctuation">,</span> <span class="token number">5499.00</span><span class="token punctuation">,</span> <span class="token string">"http://image.leyou.com/13123.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Item</span><span class="token punctuation">(</span><span class="token number">5L</span><span class="token punctuation">,</span> <span class="token string">"小米手机8"</span><span class="token punctuation">,</span> <span class="token string">"手机"</span><span class="token punctuation">,</span><span class="token string">"小米"</span><span class="token punctuation">,</span> <span class="token number">2199.00</span><span class="token punctuation">,</span> <span class="token string">"http://image.leyou.com/13124.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        itemRepository<span class="token punctuation">.</span><span class="token function">saveAll</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 修改
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Item</span> item <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Item</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">,</span> <span class="token string">"小米手机8"</span><span class="token punctuation">,</span> <span class="token string">"手机"</span><span class="token punctuation">,</span>
                <span class="token string">"小米"</span><span class="token punctuation">,</span> <span class="token number">3499.00</span><span class="token punctuation">,</span> <span class="token string">"http://image.leyou.com/13123.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        itemRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 查询所有
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testFindAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Item</span><span class="token punctuation">&gt;</span></span> items <span class="token operator">=</span> itemRepository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        items<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * 查询一个
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testFindById</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Item</span> item <span class="token operator">=</span> itemRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token number">2L</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>




<h2 id="09、SpringDataElasticsearch：高级查询-重点"><a href="#09、SpringDataElasticsearch：高级查询-重点" class="headerlink" title="09、SpringDataElasticsearch：高级查询(重点)"></a>09、SpringDataElasticsearch：高级查询(重点)</h2><p>如果要完成更加复杂的查询，同时包含条件，分页，高亮，聚合等操作，需要用到ElasticsearchTemplate对象</p>
<h3 id="1）基本条件查询"><a href="#1）基本条件查询" class="headerlink" title="1）基本条件查询"></a>1）基本条件查询</h3><p>&nbsp;<img src="%E4%B9%90%E4%BC%98%E7%94%B5%E5%95%86-06-%E5%95%86%E5%93%81%E6%90%9C%E7%B4%A2%E5%88%86%E6%9E%90.assets/1606113390721.png" alt="1606113390721"></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
     * 1）普通匹配查询
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">//1. 创建本地查询构造器对象</span>
        <span class="token class-name">NativeSearchQueryBuilder</span> queryBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NativeSearchQueryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">//2.往本地查询构造器中添加条件（***）</span>
        <span class="token comment">// 固定用法： 所有Query里面的条件都是使用QueryBuilders来构造的</span>
        queryBuilder<span class="token punctuation">.</span><span class="token function">withQuery</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">matchQuery</span><span class="token punctuation">(</span><span class="token string">"title"</span><span class="token punctuation">,</span><span class="token string">"小米"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">//3.执行本地查询，获取结果</span>
        <span class="token comment">/**
         * 参数一：本地查询对象
         * 参数二：需要封装的实体类型
         */</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Item</span><span class="token punctuation">&gt;</span></span> items <span class="token operator">=</span> esTemplate<span class="token punctuation">.</span><span class="token function">queryForList</span><span class="token punctuation">(</span>queryBuilder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Item</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//4.处理结果</span>
        items<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="2）分页查询"><a href="#2）分页查询" class="headerlink" title="2）分页查询"></a>2）分页查询</h3><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"># 分页查询
# from：起始行号，从0开始
# size: 页面大小
GET /goods/_search
{
  "query": {
    "match_all": {}
  },
  "from": 4,
  "size": 2
}

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
    * 2）分页查询
    */</span>
   <span class="token annotation punctuation">@Test</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPageQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

       <span class="token class-name">NativeSearchQueryBuilder</span> queryBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NativeSearchQueryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       queryBuilder<span class="token punctuation">.</span><span class="token function">withQuery</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">matchAllQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token comment">//设置分页参数</span>
       <span class="token comment">/**
        * 参数一： page: 当前页码索引号，从0开始
        * 参数二： size: 页面大小
        */</span>
       <span class="token keyword">int</span> page <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
       <span class="token keyword">int</span> size <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>

       queryBuilder<span class="token punctuation">.</span><span class="token function">withPageable</span><span class="token punctuation">(</span><span class="token class-name">PageRequest</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>page<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>size<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Item</span><span class="token punctuation">&gt;</span></span> pageBean <span class="token operator">=</span> esTemplate<span class="token punctuation">.</span><span class="token function">queryForPage</span><span class="token punctuation">(</span>queryBuilder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Item</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"总记录数："</span><span class="token operator">+</span>pageBean<span class="token punctuation">.</span><span class="token function">getTotalElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"总页数："</span><span class="token operator">+</span>pageBean<span class="token punctuation">.</span><span class="token function">getTotalPages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       pageBean<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="3）布尔组合-过滤查询"><a href="#3）布尔组合-过滤查询" class="headerlink" title="3）布尔组合+过滤查询(*)"></a>3）布尔组合+过滤查询(*)</h3><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml">GET /goods/_search
{
  "query": {
    "bool": {
      "must": [
        {
          "match": {
            "title": "小米"
          }
        }
      ],
      "filter": {
        "term": {
          "category": "手机"
        }
      }
    }
  }
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
    * 3）布尔组合+过滤条件
    */</span>
   <span class="token annotation punctuation">@Test</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testBoolAndFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
       <span class="token class-name">NativeSearchQueryBuilder</span> queryBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NativeSearchQueryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


       <span class="token comment">//创建布尔查询条件对象</span>
       <span class="token class-name">BoolQueryBuilder</span> boolQueryBuilder <span class="token operator">=</span> <span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">boolQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token comment">//设置must条件</span>
       boolQueryBuilder<span class="token punctuation">.</span><span class="token function">must</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">matchQuery</span><span class="token punctuation">(</span><span class="token string">"title"</span><span class="token punctuation">,</span><span class="token string">"小米"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token comment">//设置filter过滤</span>
       boolQueryBuilder<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">termQuery</span><span class="token punctuation">(</span><span class="token string">"category"</span><span class="token punctuation">,</span><span class="token string">"手机"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       queryBuilder<span class="token punctuation">.</span><span class="token function">withQuery</span><span class="token punctuation">(</span>boolQueryBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Item</span><span class="token punctuation">&gt;</span></span> items <span class="token operator">=</span> esTemplate<span class="token punctuation">.</span><span class="token function">queryForList</span><span class="token punctuation">(</span>queryBuilder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Item</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       items<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="4）聚合查询"><a href="#4）聚合查询" class="headerlink" title="4）聚合查询(*)"></a>4）聚合查询(*)</h3><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"># 统计不同品牌的手机分别有多少台？
GET /goods/_search
{
  "aggs": {
    "brandAgg": {
      "terms": {
        "field": "brand"
      }
    }
  }
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
    * 4）聚合查询
    */</span>
   <span class="token annotation punctuation">@Test</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testAgg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
       <span class="token class-name">NativeSearchQueryBuilder</span> queryBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NativeSearchQueryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token comment">//添加聚合条件</span>
       <span class="token comment">// 固定用法： 所有Aggregation里面的条件都是使用AggregationBuilders来构造的</span>
       queryBuilder<span class="token punctuation">.</span><span class="token function">addAggregation</span><span class="token punctuation">(</span><span class="token class-name">AggregationBuilders</span><span class="token punctuation">.</span><span class="token function">terms</span><span class="token punctuation">(</span><span class="token string">"brandAgg"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">"brand"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token comment">//注意：聚合查询必须使用queryForPage方法</span>
       <span class="token comment">/**
        * Page： 该对象只包含普通查询结果（hits部分的数据）
        * AggregatedPage: 该接口是Page接口的子类，既包含普通查询结果（hits部分的数据），也包含聚合结果（aggregations）
        */</span>
       <span class="token class-name">AggregatedPage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Item</span><span class="token punctuation">&gt;</span></span> aggregatedPage <span class="token operator">=</span> esTemplate<span class="token punctuation">.</span><span class="token function">queryForPage</span><span class="token punctuation">(</span>queryBuilder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Item</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token comment">//只取出聚合结果</span>
       <span class="token class-name">Aggregations</span> aggregations <span class="token operator">=</span>
               aggregatedPage<span class="token punctuation">.</span><span class="token function">getAggregations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token comment">//通过聚合别名获取桶数据(buckets)</span>
       <span class="token class-name">Terms</span> terms <span class="token operator">=</span> aggregations<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"brandAgg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Terms<span class="token punctuation">.</span>Bucket</span><span class="token punctuation">&gt;</span></span> buckets <span class="token operator">=</span> terms<span class="token punctuation">.</span><span class="token function">getBuckets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Terms<span class="token punctuation">.</span>Bucket</span> bucket<span class="token operator">:</span>buckets<span class="token punctuation">)</span><span class="token punctuation">{</span>
           <span class="token class-name">String</span> brandName <span class="token operator">=</span> bucket<span class="token punctuation">.</span><span class="token function">getKeyAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">long</span> docCount <span class="token operator">=</span> bucket<span class="token punctuation">.</span><span class="token function">getDocCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"品牌："</span><span class="token operator">+</span>brandName<span class="token operator">+</span><span class="token string">"，数量："</span><span class="token operator">+</span>docCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>


   <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>




<h3 id="5）高亮查询"><a href="#5）高亮查询" class="headerlink" title="5）高亮查询(*)"></a>5）高亮查询(*)</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
    * 5）高亮查询 - 非简化版
    *    高亮显示的三个步骤：
    *     1）哪个字段需要高亮，该字段必须作为查询条件
    *     2）在执行查询前，给高亮字段设置高亮样式
    *     3）在执行查询后，自行设置高亮字段内容
    */</span>
   <span class="token annotation punctuation">@Test</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testHighlight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
       <span class="token class-name">NativeSearchQueryBuilder</span> queryBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NativeSearchQueryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token comment">//1.把title作为高亮字段，作为查询条件</span>
       queryBuilder<span class="token punctuation">.</span><span class="token function">withQuery</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">matchQuery</span><span class="token punctuation">(</span><span class="token string">"title"</span><span class="token punctuation">,</span><span class="token string">"小米"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token comment">//2.在执行查询前，给高亮字段设置高亮样式</span>
       <span class="token comment">//2.1 构造Field高亮字段</span>
       <span class="token class-name">HighlightBuilder<span class="token punctuation">.</span>Field</span> field <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HighlightBuilder<span class="token punctuation">.</span>Field</span><span class="token punctuation">(</span><span class="token string">"title"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token comment">//2.2 设置高亮样式</span>
       field<span class="token punctuation">.</span><span class="token function">preTags</span><span class="token punctuation">(</span><span class="token string">"&lt;font color='red'&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       field<span class="token punctuation">.</span><span class="token function">postTags</span><span class="token punctuation">(</span><span class="token string">"&lt;/font&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       queryBuilder<span class="token punctuation">.</span><span class="token function">withHighlightFields</span><span class="token punctuation">(</span>field<span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token comment">/**
        * 在queryForPage方法里面设置第三个参数： SearchResultMapper接口
        *      SearchResultMapper接口： 用于对查询结果重新封装的
        */</span>
       <span class="token class-name">AggregatedPage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Item</span><span class="token punctuation">&gt;</span></span> aggregatedPage <span class="token operator">=</span> esTemplate<span class="token punctuation">.</span><span class="token function">queryForPage</span><span class="token punctuation">(</span>queryBuilder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Item</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">SearchResultMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token comment">/**
            * 如何处理返回结果
            * @param response
            * @param clazz
            * @param pageable
            * @param &lt;T&gt;
            * @return
            */</span>
           <span class="token annotation punctuation">@Override</span>
           <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">AggregatedPage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">mapResults</span><span class="token punctuation">(</span><span class="token class-name">SearchResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> clazz<span class="token punctuation">,</span> <span class="token class-name">Pageable</span> pageable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token class-name">List</span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

               <span class="token comment">//自行存入需要的数据</span>
               <span class="token class-name">SearchHits</span> hits <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">SearchHit</span> hit<span class="token operator">:</span>hits<span class="token punctuation">)</span><span class="token punctuation">{</span>
                   <span class="token comment">//获取文档的json字符串</span>
                   <span class="token class-name">String</span> jsonString <span class="token operator">=</span> hit<span class="token punctuation">.</span><span class="token function">getSourceAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                   <span class="token comment">//转换为Item对象</span>
                   <span class="token class-name">Item</span> item <span class="token operator">=</span> <span class="token class-name">JsonUtils</span><span class="token punctuation">.</span><span class="token function">toBean</span><span class="token punctuation">(</span>jsonString<span class="token punctuation">,</span><span class="token class-name">Item</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                   <span class="token comment">//3.在执行查询后，自行设置高亮字段内容</span>
                   <span class="token class-name">HighlightField</span> highlightField <span class="token operator">=</span> hit<span class="token punctuation">.</span><span class="token function">getHighlightFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"title"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                   <span class="token keyword">if</span><span class="token punctuation">(</span>highlightField<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                       item<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span>highlightField<span class="token punctuation">.</span><span class="token function">getFragments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                   <span class="token punctuation">}</span>

                   list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token punctuation">}</span>


               <span class="token class-name">AggregatedPage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> aggregatedPage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AggregatedPageImpl</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token keyword">return</span> aggregatedPage<span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
       <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       aggregatedPage<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>结果为：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Item</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> title<span class="token operator">=</span><span class="token operator">&lt;</span>font color<span class="token operator">=</span><span class="token string">'red'</span><span class="token operator">&gt;</span>华为<span class="token operator">&lt;</span><span class="token operator">/</span>font<span class="token operator">&gt;</span>META10<span class="token punctuation">,</span> category<span class="token operator">=</span> 手机<span class="token punctuation">,</span> brand<span class="token operator">=</span>华为<span class="token punctuation">,</span> price<span class="token operator">=</span><span class="token number">4499.0</span><span class="token punctuation">,</span> images<span class="token operator">=</span>http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>image<span class="token punctuation">.</span>leyou<span class="token punctuation">.</span>com<span class="token operator">/</span><span class="token number">3.</span>jpg<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<p>加入HighlightUtils工具类，简化后：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
   * 6）高亮查询 - 简化版
   *    高亮显示的三个步骤：
   *     1）哪个字段需要高亮，该字段必须作为查询条件
   *     2）在执行查询前，给高亮字段设置高亮样式
   *     3）在执行查询后，自行设置高亮字段内容
   */</span>
  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testHighlight2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token class-name">NativeSearchQueryBuilder</span> queryBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NativeSearchQueryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">//1.把title作为高亮字段，作为查询条件</span>
      queryBuilder<span class="token punctuation">.</span><span class="token function">withQuery</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">matchQuery</span><span class="token punctuation">(</span><span class="token string">"title"</span><span class="token punctuation">,</span><span class="token string">"小米"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">//2.在执行查询前，给高亮字段设置高亮样式</span>
      <span class="token class-name">HighlightUtils</span><span class="token punctuation">.</span><span class="token function">highlightField</span><span class="token punctuation">(</span>queryBuilder<span class="token punctuation">,</span><span class="token string">"title"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">/**
       * 在queryForPage方法里面设置第三个参数： SearchResultMapper接口
       *      SearchResultMapper接口： 用于对查询结果重新封装的
       */</span>
      <span class="token class-name">AggregatedPage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Item</span><span class="token punctuation">&gt;</span></span> aggregatedPage <span class="token operator">=</span> esTemplate<span class="token punctuation">.</span><span class="token function">queryForPage</span><span class="token punctuation">(</span>
              queryBuilder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token class-name">Item</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
              <span class="token class-name">HighlightUtils</span><span class="token punctuation">.</span><span class="token function">highlightBody</span><span class="token punctuation">(</span><span class="token class-name">Item</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token string">"title"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      aggregatedPage<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>




<h2 id="10、课程总结"><a href="#10、课程总结" class="headerlink" title="10、课程总结"></a>10、课程总结</h2><p>1）ES环境安装（ES服务端， Head插件，Kibana）</p>
<p>2）了解REST API指令（DSL语言） 底层原理</p>
<p>3）掌握SpringDataElasticsearch的API（重点）</p>
<p>​    3.1 ElasticsearchRepository接口（CRUD）</p>
<p>​    3.2 ElasticsearchTemplate接口（高级查询）</p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">durex</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://chenliren9527.github.io/2020/12/31/le-you-dian-shang-06-shang-pin-sou-suo-fen-xi/">https://chenliren9527.github.io/2020/12/31/le-you-dian-shang-06-shang-pin-sou-suo-fen-xi/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">durex</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/%E7%AC%94%E8%AE%B0/">
                                    <span class="chip bg-color">笔记</span>
                                </a>
                            
                                <a href="/tags/Elasticsearch/">
                                    <span class="chip bg-color">Elasticsearch</span>
                                </a>
                            
                                <a href="/tags/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%E4%BA%8C/">
                                    <span class="chip bg-color">项目实战二</span>
                                </a>
                            
                                <a href="/tags/springcloud/">
                                    <span class="chip bg-color">springcloud</span>
                                </a>
                            
                                <a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/">
                                    <span class="chip bg-color">微服务</span>
                                </a>
                            
                                <a href="/tags/SpringDataElasticsearch/">
                                    <span class="chip bg-color">SpringDataElasticsearch</span>
                                </a>
                            
                                <a href="/tags/Kibana/">
                                    <span class="chip bg-color">Kibana</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.png" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2021/01/02/le-you-dian-shang-07-gou-jian-shang-pin-suo-yin-ku-elasticsearch/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/103.jpg" class="responsive-img" alt="乐优电商(07)-构建商品索引库【Elasticsearch】">
                        
                        <span class="card-title">乐优电商(07)-构建商品索引库【Elasticsearch】</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2021-01-02
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%E4%BA%8C/" class="post-category">
                                    项目实战二
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E7%AC%94%E8%AE%B0/">
                        <span class="chip bg-color">笔记</span>
                    </a>
                    
                    <a href="/tags/Elasticsearch/">
                        <span class="chip bg-color">Elasticsearch</span>
                    </a>
                    
                    <a href="/tags/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%E4%BA%8C/">
                        <span class="chip bg-color">项目实战二</span>
                    </a>
                    
                    <a href="/tags/springcloud/">
                        <span class="chip bg-color">springcloud</span>
                    </a>
                    
                    <a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/">
                        <span class="chip bg-color">微服务</span>
                    </a>
                    
                    <a href="/tags/SpringDataElasticsearch/">
                        <span class="chip bg-color">SpringDataElasticsearch</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2020/12/30/le-you-dian-shang-05-shang-pin-guan-li/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/71.jpg" class="responsive-img" alt="乐优电商(05)-商品管理">
                        
                        <span class="card-title">乐优电商(05)-商品管理</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2020-12-30
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%E4%BA%8C/" class="post-category">
                                    项目实战二
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E7%AC%94%E8%AE%B0/">
                        <span class="chip bg-color">笔记</span>
                    </a>
                    
                    <a href="/tags/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%E4%BA%8C/">
                        <span class="chip bg-color">项目实战二</span>
                    </a>
                    
                    <a href="/tags/springcloud/">
                        <span class="chip bg-color">springcloud</span>
                    </a>
                    
                    <a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/">
                        <span class="chip bg-color">微服务</span>
                    </a>
                    
                    <a href="/tags/SPU/">
                        <span class="chip bg-color">SPU</span>
                    </a>
                    
                    <a href="/tags/SKU/">
                        <span class="chip bg-color">SKU</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
    <div class="container row center-align" style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2021-2022</span>
            
            <span id="year">2021</span>
            <a href="/about" target="_blank">durex</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">896.5k</span>&nbsp;字
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <span id="sitetime">载入运行时间...</span>
            <script>
                function siteTime() {
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var startYear = "2021";
                    var startMonth = "1";
                    var startDate = "08";
                    var startHour = "0";
                    var startMinute = "0";
                    var startSecond = "0";
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth() + 1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                    var diff = t2 - t1;
                    var diffYears = Math.floor(diff / years);
                    var diffDays = Math.floor((diff / days) - diffYears * 365);
                    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                        minutes);
                    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                        diffMinutes * minutes) / seconds);
                    if (startYear == todayYear) {
                        document.getElementById("year").innerHTML = todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffDays + " 天 " + diffHours +
                            " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    } else {
                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffYears + " 年 " + diffDays +
                            " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    }
                }
                setInterval(siteTime, 1000);
            </script>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">














    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
