<!DOCTYPE HTML><html lang="zh-CN"><head><meta charset="utf-8"><meta name="keywords" content="乐优电商(05)-商品管理, 薛定谔的腿毛"><meta name="description" content="01、课程目标
了解SPU与SKU数据结构设计思路

独立实现商品查询

独立实现商品新增后台


02、SPU与SKU：概念说明与表结构1）概念说明SPU：Standard Product Unit （标准产品单位） ，一组具有共同属性的"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="renderer" content="webkit|ie-stand|ie-comp"><meta name="mobile-web-app-capable" content="yes"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="referrer" content="no-referrer-when-downgrade"><title>乐优电商(05)-商品管理 | 薛定谔的腿毛</title><link rel="icon" type="image/png" href="/favicon.png"><link rel="stylesheet" href="/libs/awesome/css/all.min.css"><link rel="stylesheet" href="/libs/materialize/materialize.min.css"><link rel="stylesheet" href="/libs/aos/aos.css"><link rel="stylesheet" href="/libs/animate/animate.min.css"><link rel="stylesheet" href="/libs/lightGallery/css/lightgallery.min.css"><link rel="stylesheet" href="/css/matery.css"><link rel="stylesheet" href="/css/my.css"><script src="/libs/jquery/jquery-3.6.0.min.js"></script><meta name="generator" content="Hexo 5.3.0"><style>.github-emoji{position:relative;display:inline-block;width:1.2em;min-height:1.2em;overflow:hidden;vertical-align:top;color:transparent}.github-emoji>span{position:relative;z-index:10}.github-emoji .fancybox,.github-emoji img{margin:0!important;padding:0!important;border:none!important;outline:0!important;text-decoration:none!important;user-select:none!important;cursor:auto!important}.github-emoji img{height:1.2em!important;width:1.2em!important;position:absolute!important;left:50%!important;top:50%!important;transform:translate(-50%,-50%)!important;user-select:none!important;cursor:auto!important}.github-emoji-fallback{color:inherit}.github-emoji-fallback img{opacity:0!important}</style><link rel="alternate" href="/atom.xml" title="薛定谔的腿毛" type="application/atom+xml"></head><body><header class="navbar-fixed"><nav id="headNav" class="bg-color nav-transparent"><div id="navContainer" class="nav-wrapper container"><div class="brand-logo"><a href="/" class="waves-effect waves-light"><img src="/medias/logo.png" class="logo-img" alt="LOGO"> <span class="logo-span">薛定谔的腿毛</span></a></div><a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a><ul class="right nav-menu"><li class="hide-on-med-and-down nav-item"><a href="/" class="waves-effect waves-light"><i class="fas fa-home" style="zoom:.6"></i> <span>首页</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/tags" class="waves-effect waves-light"><i class="fas fa-tags" style="zoom:.6"></i> <span>标签</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/categories" class="waves-effect waves-light"><i class="fas fa-bookmark" style="zoom:.6"></i> <span>分类</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/archives" class="waves-effect waves-light"><i class="fas fa-archive" style="zoom:.6"></i> <span>归档</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/about" class="waves-effect waves-light"><i class="fas fa-user-circle" style="zoom:.6"></i> <span>关于</span></a></li><li><a href="#searchModal" class="modal-trigger waves-effect waves-light"><i id="searchIcon" class="fas fa-search" title="搜索" style="zoom:.85"></i></a></li></ul><div id="mobile-nav" class="side-nav sidenav"><div class="mobile-head bg-color"><img src="/medias/logo.png" class="logo-img circle responsive-img"><div class="logo-name">薛定谔的腿毛</div><div class="logo-desc">Never really desperate, only the lost of the soul.</div></div><ul class="menu-list mobile-menu-list"><li class="m-nav-item"><a href="/" class="waves-effect waves-light"><i class="fa-fw fas fa-home"></i> 首页</a></li><li class="m-nav-item"><a href="/tags" class="waves-effect waves-light"><i class="fa-fw fas fa-tags"></i> 标签</a></li><li class="m-nav-item"><a href="/categories" class="waves-effect waves-light"><i class="fa-fw fas fa-bookmark"></i> 分类</a></li><li class="m-nav-item"><a href="/archives" class="waves-effect waves-light"><i class="fa-fw fas fa-archive"></i> 归档</a></li><li class="m-nav-item"><a href="/about" class="waves-effect waves-light"><i class="fa-fw fas fa-user-circle"></i> 关于</a></li></ul></div></div></nav></header><script src="/libs/cryptojs/crypto-js.min.js"></script><script>(function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();</script><div class="bg-cover pd-header post-cover" style="background-image:url(/medias/featureimages/39.jpg)"><div class="container" style="right:0;left:0"><div class="row"><div class="col s12 m12 l12"><div class="brand"><h1 class="description center-align post-title">乐优电商(05)-商品管理</h1></div></div></div></div></div><main class="post-container content"><link rel="stylesheet" href="/libs/tocbot/tocbot.css"><style>#articleContent h1::before,#articleContent h2::before,#articleContent h3::before,#articleContent h4::before,#articleContent h5::before,#articleContent h6::before{display:block;content:" ";height:100px;margin-top:-100px;visibility:hidden}#articleContent :focus{outline:0}.toc-fixed{position:fixed;top:64px}.toc-widget{width:345px;padding-left:20px}.toc-widget .toc-title{padding:35px 0 15px 17px;font-size:1.5rem;font-weight:700;line-height:1.5rem}.toc-widget ol{padding:0;list-style:none}#toc-content{padding-bottom:30px;overflow:auto}#toc-content ol{padding-left:10px}#toc-content ol li{padding-left:10px}#toc-content .toc-link:hover{color:#42b983;font-weight:700;text-decoration:underline}#toc-content .toc-link::before{background-color:transparent;max-height:25px;position:absolute;right:23.5vw;display:block}#toc-content .is-active-link{color:#42b983}#floating-toc-btn{position:fixed;right:15px;bottom:76px;padding-top:15px;margin-bottom:0;z-index:998}#floating-toc-btn .btn-floating{width:48px;height:48px}#floating-toc-btn .btn-floating i{line-height:48px;font-size:1.4rem}</style><div class="row"><div id="main-content" class="col s12 m12 l9"><div id="artDetail"><div class="card"><div class="card-content article-info"><div class="row tag-cate"><div class="col s7"><div class="article-tag"><a href="/tags/%E7%AC%94%E8%AE%B0/"><span class="chip bg-color">笔记</span></a> <a href="/tags/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%E4%BA%8C/"><span class="chip bg-color">项目实战二</span></a> <a href="/tags/springcloud/"><span class="chip bg-color">springcloud</span></a> <a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"><span class="chip bg-color">微服务</span></a> <a href="/tags/SPU/"><span class="chip bg-color">SPU</span></a> <a href="/tags/SKU/"><span class="chip bg-color">SKU</span></a></div></div><div class="col s5 right-align"><div class="post-cate"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%E4%BA%8C/" class="post-category">项目实战二</a></div></div></div><div class="post-info"><div class="post-date info-break-policy"><i class="far fa-calendar-minus fa-fw"></i> 发布日期:&nbsp;&nbsp; 2020-12-30</div><div class="post-date info-break-policy"><i class="far fa-calendar-check fa-fw"></i> 更新日期:&nbsp;&nbsp; 2023-10-15</div><div class="info-break-policy"><i class="far fa-file-word fa-fw"></i> 文章字数:&nbsp;&nbsp; 8.2k</div><div class="info-break-policy"><i class="far fa-clock fa-fw"></i> 阅读时长:&nbsp;&nbsp; 34 分</div><div id="busuanzi_container_page_pv" class="info-break-policy"><i class="far fa-eye fa-fw"></i> 阅读次数:&nbsp;&nbsp;<span id="busuanzi_value_page_pv"></span></div></div></div><hr class="clearfix"><link rel="stylesheet" href="/libs/prism/prism.css"><style>code[class*=language-],pre[class*=language-]{white-space:pre-wrap!important}</style><div class="card-content article-card-content"><div id="articleContent"><h2 id="01、课程目标"><a href="#01、课程目标" class="headerlink" title="01、课程目标"></a>01、课程目标</h2><ul><li><p>了解SPU与SKU数据结构设计思路</p></li><li><p>独立实现商品查询</p></li><li><p>独立实现商品新增后台</p></li></ul><h2 id="02、SPU与SKU：概念说明与表结构"><a href="#02、SPU与SKU：概念说明与表结构" class="headerlink" title="02、SPU与SKU：概念说明与表结构"></a>02、SPU与SKU：概念说明与表结构</h2><h3 id="1）概念说明"><a href="#1）概念说明" class="headerlink" title="1）概念说明"></a>1）概念说明</h3><p>SPU：Standard Product Unit （标准产品单位） ，一组具有共同属性的商品集</p><p>SKU：Stock Keeping Unit（库存量单位），SPU商品集因具体特性不同而细分的每个商品</p><p>以图为例来看：</p><p><img src="day05-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86.assets/1575542656523.png" alt="1575542656523"></p><ul><li>本页的 华为Mate10 就是一个商品集（SPU）</li><li>因为颜色、内存等不同，而细分出不同的Mate10，如亮黑色128G版。（SKU）</li></ul><p>可以看出：</p><ul><li>SPU是一个抽象的商品集概念，为了方便后台的管理。</li><li>SKU才是具体要销售的商品，每一个SKU的价格、库存可能会不一样，用户购买的是SKU而不是SPU</li></ul><h3 id="2）SPU与SKU表结构分析"><a href="#2）SPU与SKU表结构分析" class="headerlink" title="2）SPU与SKU表结构分析"></a>2）SPU与SKU表结构分析</h3><h4 id="1）思考分析"><a href="#1）思考分析" class="headerlink" title="1）思考分析"></a>1）思考分析</h4><p>弄清楚了SPU和SKU的概念区分，接下来我们一起思考一下该如何设计数据库表。</p><p>首先来看SPU，大家一起思考下SPU应该有哪些字段来描述？</p><pre class="line-numbers language-none"><code class="language-none">id:主键
title：标题
description：描述
specification：规格
packaging_list：包装
after_service：售后服务
comment：评价
category_id：商品分类
brand_id：品牌<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>似乎并不复杂.</p><p>再看下SKU，大家觉得应该有什么字段？</p><pre class="line-numbers language-none"><code class="language-none">id：主键
spu_id：关联的spu
price：价格
images：图片
stock：库存
颜色？
内存？
硬盘？<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>sku的特有属性也是变化的，不同商品，特有属性不一定相同，那么我们的表字段岂不是不确定？</p><p>sku的这个特有属性该如何设计呢？</p><h4 id="2）SKU的特有属性"><a href="#2）SKU的特有属性" class="headerlink" title="2）SKU的特有属性"></a>2）SKU的特有属性</h4><p>SPU中会有一些特殊属性，用来区分不同的SKU，我们称为SKU特有属性。如华为META10的颜色、内存属性。</p><p>不同种类的商品，一个手机，一个衣服，其SKU属性不相同。</p><p>同一种类的商品，比如都是衣服，SKU属性基本是一样的，都是颜色、尺码等。</p><p>这样说起来，似乎SKU的特有属性也是与分类相关的？事实上，仔细观察你会发现，<strong>SKU的特有属性是商品规格参数的一部分</strong>：</p><p><img src="day05-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86.assets/1526088981953.png" alt="1526088981953"></p><p>也就是说，我们没必要单独对SKU的特有属性进行设计，它可以看做是规格参数中的一部分。这样规格参数中的属性可以标记成两部分：</p><ul><li>spu下所有sku共享的规格属性（称为<strong>通用属性</strong>）</li><li>spu下每个sku不同的规格属性（称为<strong>特有属性</strong>）</li></ul><p>回忆一下之前我们设计的tb_spec_param表，是不是有一个字段，名为generic，标记通用和特有属性。就是为了这里使用。</p><p>这样以来，商品SKU表就只需要设计规格属性以外的其它字段了，规格属性由之前的规格参数表<code>tb_spec_param</code>来保存。</p><p>但是，规格属性的值依然是需要与商品相关联的。</p><h2 id="03、SPU与SKU：spu与spu-detail表结构分析"><a href="#03、SPU与SKU：spu与spu-detail表结构分析" class="headerlink" title="03、SPU与SKU：spu与spu_detail表结构分析"></a>03、SPU与SKU：spu与spu_detail表结构分析</h2><h3 id="1）数据库表切分说明"><a href="#1）数据库表切分说明" class="headerlink" title="1）数据库表切分说明"></a>1）数据库表切分说明</h3><ul><li><p>横向切分【水平拆分】</p><blockquote><p>一种情况是 数据量太大了【2000万左右】</p><p>一种情况是 历史数据使用的几率很低</p><p>水平拆分表结构一样</p></blockquote></li><li><p>纵向切分【垂直拆分】</p><blockquote><p>一种情况是 表的字段太多了【50个左右】</p><p>一种情况是 表中有一些大字段，比如：blob，clob，增删改的效率低【long】，需要将这些大字段单独分离出去</p><p>一种情况是使用率低</p><p>垂直拆分共用主键 表关系一对一</p></blockquote></li></ul><h3 id="2）表结构"><a href="#2）表结构" class="headerlink" title="2）表结构"></a>2）表结构</h3><h4 id="spu表"><a href="#spu表" class="headerlink" title="spu表"></a>spu表</h4><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE `tb_spu` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'spu id',
  `name` varchar(256) NOT NULL DEFAULT '' COMMENT '商品名称',
  `sub_title` varchar(256) DEFAULT '' COMMENT '副标题，一般是促销信息',
  `cid1` bigint(20) NOT NULL COMMENT '1级类目id',
  `cid2` bigint(20) NOT NULL COMMENT '2级类目id',
  `cid3` bigint(20) NOT NULL COMMENT '3级类目id',
  `brand_id` bigint(20) NOT NULL COMMENT '商品所属品牌id',
  `saleable` tinyint(1) NOT NULL DEFAULT '1' COMMENT '是否上架，0下架，1上架',
  `create_time` timestamp NULL DEFAULT CURRENT_TIMESTAMP COMMENT '添加时间',
  `update_time` timestamp NULL DEFAULT CURRENT_TIMESTAMP COMMENT '最后修改时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=183 DEFAULT CHARSET=utf8 COMMENT='spu表，该表描述的是一个抽象性的商品，比如 iphone8';<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="spu-detail表"><a href="#spu-detail表" class="headerlink" title="spu_detail表"></a>spu_detail表</h4><p>与我们前面分析的基本类似，但是似乎少了一些字段，比如商品描述。</p><p>我们做了表的垂直拆分，将SPU的详情放到了另一张表：tb_spu_detail</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE `tb_spu_detail` (
  `spu_id` bigint(20) NOT NULL,
  `description` text COMMENT '商品描述信息',
  `generic_spec` varchar(2048) NOT NULL DEFAULT '' COMMENT '通用规格参数数据',
  `special_spec` varchar(1024) NOT NULL COMMENT '特有规格参数及可选值信息，json格式',
  `packing_list` varchar(1024) DEFAULT '' COMMENT '包装清单',
  `after_service` varchar(1024) DEFAULT '' COMMENT '售后服务',
  `create_time` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `update_time` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`spu_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这张表中的数据都比较大，为了不影响主表的查询效率我们拆分出这张表。</p><p>需要注意的是这两个字段：generic_spec和special_spec。</p><h3 id="3）spu中的规格参数：generic-spec字段"><a href="#3）spu中的规格参数：generic-spec字段" class="headerlink" title="3）spu中的规格参数：generic_spec字段"></a>3）spu中的规格参数：generic_spec字段</h3><p>前面讲过规格参数与商品分类绑定，同一分类的商品，会有一套相同的规格参数key（规格参数模板），但是这个分类下每个商品的规格参数值都不相同，因此要满足下面几点：</p><ul><li>我们有一个规格参数表，跟分类关联，保存的就是某分类下的规格参数模板。</li><li>我们还需要表，跟商品关联，保存某个商品，相关联的规格参数的值。</li><li>规格参数因为分成了通用规格参数和特有规格参数，因此规格参数值也需要分别于SPU和SKU关联：<ul><li>通用的规格参数值与SPU关联。</li><li>特有规格参数值与SKU关联。</li></ul></li></ul><p>但是我们并没有增加新的表，来看下我们的 表如何存储这些信息：</p><p><strong>generic_spec字段</strong></p><p>如果要设计一张表，来表示spu中的通用规格属性的值，至少需要下面的字段：</p><pre class="line-numbers language-none"><code class="language-none">spu_id：与哪个商品关联
param_id：是商品的哪个规格参数
value：具体的值<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>我们并没有这么设计。而是把与某个商品相关的规格属性值，直接保存到这个商品spu表中，因此这些规格属性关联的商品就一目了然，那么上述3个属性中的<code>spu_id</code>就无需保存了，而剩下的就是<code>param_id</code>和规格参数值了。两者刚好是一一对应关系，组成一个键值对。我们刚好可以用一个json结构来标示。</p><p>是也就是spuDetail表中的<code>generic_spec</code>，其中保存通用规格参数信息的值：</p><blockquote><p>整体来看：</p></blockquote><p><img src="day05-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86.assets/1529554390912.png" alt="1529554390912"></p><p>json结构，其中都是键值对：</p><ul><li>key：对应的规格参数的<code>spec_param</code>的id</li><li>value：对应规格参数的值</li></ul><h3 id="4）spu中的规格参数：special-spec字段"><a href="#4）spu中的规格参数：special-spec字段" class="headerlink" title="4）spu中的规格参数：special_spec字段"></a>4）spu中的规格参数：special_spec字段</h3><p>我们说spu中只保存通用规格参数，那么为什么有多出了一个<code>special_spec</code>字段呢？</p><p>以手机为例，品牌、操作系统等肯定是通用规格属性，内存、颜色等肯定是特有属性。</p><p>当你确定了一个SPU，比如小米的：红米4X，因为颜色内存等不同，会形成多个sku。如果把每个sku的颜色、内存等信息都整理一下，会形成下面的结果：</p><pre class="line-numbers language-none"><code class="language-none">颜色：[香槟金, 樱花粉, 磨砂黑]
内存：[2G, 3G]
机身存储：[16GB, 32GB]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>也就是说这里把一个spu下的每个sku的特有规格属性值聚合在了一起！这个就是special_spec字段了。</p><p>来看数据格式：</p><p><img src="day05-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86.assets/1529554916252.png" alt="1529554916252"></p><p>也是json结构：</p><ul><li>key：规格参数id</li><li>value：spu属性的数组</li></ul><p>那么问题来：为什么要在spu中把所有sku的规格属性聚合起来保存呢？</p><p>因为我们有时候需要把所有规格参数都查询出来，而不是只查询1个sku的属性。比如，商品详情页展示可选的规格参数时：</p><p><img src="day05-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86.assets/1526267828817.png" alt="1526267828817"></p><p>刚好符号我们的结构，这样页面渲染就非常方便了。</p><p>综上所述，spu与商品规格参数模板的关系如图所示：</p><p><img src="day05-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86.assets/1552792606155.png" alt="1552792606155"></p><h2 id="04、SPU与SKU：sku表结构分析"><a href="#04、SPU与SKU：sku表结构分析" class="headerlink" title="04、SPU与SKU：sku表结构分析"></a>04、SPU与SKU：sku表结构分析</h2><h3 id="1）表结构"><a href="#1）表结构" class="headerlink" title="1）表结构"></a>1）表结构</h3><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE `tb_sku` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'sku id',
  `spu_id` bigint(20) NOT NULL COMMENT 'spu id',
  `title` varchar(256) NOT NULL COMMENT '商品标题',
  `images` varchar(1024) DEFAULT '' COMMENT '商品的图片，多个图片以‘,’分割',
  `stock` int(8) DEFAULT '9999' COMMENT '库存',
  `price` bigint(16) NOT NULL DEFAULT '0' COMMENT '销售价格，单位为分',
  `indexes` varchar(32) DEFAULT '' COMMENT '特有规格属性在spu属性模板中的对应下标组合',
  `own_spec` varchar(1024) DEFAULT '' COMMENT 'sku的特有规格参数键值对，json格式，反序列化时请使用linkedHashMap，保证有序',
  `enable` tinyint(1) NOT NULL DEFAULT '1' COMMENT '是否有效，0无效，1有效',
  `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '添加时间',
  `update_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '最后修改时间',
  PRIMARY KEY (`id`),
  KEY `key_spu_id` (`spu_id`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=27359021554 DEFAULT CHARSET=utf8 COMMENT='sku表,该表表示具体的商品实体,如黑色的 64g的iphone 8';<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>特别需要注意的是sku表中的<code>indexes</code>字段和<code>own_spec</code>字段。sku中应该保存特有规格参数的值，就在这两个字段中。</p><h3 id="2）sku中的特有规格参数：indexes字段"><a href="#2）sku中的特有规格参数：indexes字段" class="headerlink" title="2）sku中的特有规格参数：indexes字段"></a>2）sku中的特有规格参数：indexes字段</h3><p>在SPU表中，已经对特有规格参数及可选项进行了保存，结构如下：</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>
    <span class="token property">"4"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">"香槟金"</span><span class="token punctuation">,</span>
        <span class="token string">"樱花粉"</span><span class="token punctuation">,</span>
        <span class="token string">"磨砂黑"</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"12"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">"2GB"</span><span class="token punctuation">,</span>
        <span class="token string">"3GB"</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"13"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">"16GB"</span><span class="token punctuation">,</span>
        <span class="token string">"32GB"</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这些特有属性如果排列组合，会产生12个不同的SKU，而不同的SKU，其属性就是上面备选项中的一个。</p><p>比如：</p><ul><li>红米4X，香槟金，2GB内存，16GB存储</li><li>红米4X，磨砂黑，2GB内存，32GB存储</li></ul><p>你会发现，每一个属性值，对应于SPUoptions数组的一个选项，如果我们记录下角标，就是这样：</p><ul><li>红米4X，0,0,0</li><li>红米4X，2,0,1</li></ul><p>既然如此，我们是不是可以将不同角标串联起来，作为SPU下不同SKU的标示。这就是我们的indexes字段。</p><p><img src="day05-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86.assets/1526266901335.png" alt="1526266901335"></p><p>这个设计在商品详情页会特别有用：</p><p><img src="day05-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86.assets/1526267180997.png" alt="1526267180997"></p><p>当用户点击选中一个特有属性，你就能根据 角标快速定位到sku。</p><h3 id="3）sku中的特有规格参数：own-spec字段"><a href="#3）sku中的特有规格参数：own-spec字段" class="headerlink" title="3）sku中的特有规格参数：own_spec字段"></a>3）sku中的特有规格参数：own_spec字段</h3><p>看结构：</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span><span class="token property">"4"</span><span class="token operator">:</span><span class="token string">"香槟金"</span><span class="token punctuation">,</span><span class="token property">"12"</span><span class="token operator">:</span><span class="token string">"2GB"</span><span class="token punctuation">,</span><span class="token property">"13"</span><span class="token operator">:</span><span class="token string">"16GB"</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>保存的是特有属性的键值对。</p><p>SPU中保存的是可选项，但不确定具体的值，而SKU中的保存的就是具体的值。</p><h2 id="05、商品查询：商品对象与表的关系"><a href="#05、商品查询：商品对象与表的关系" class="headerlink" title="05、商品查询：商品对象与表的关系"></a>05、商品查询：商品对象与表的关系</h2><p>商品对象所需表：商品对象对应数据库中多张表</p><p><img src="day05-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86.assets/1575601382376.png" alt="1575601382376"></p><p>商品对象比较复杂，需要多张表组合起来，开发中，复杂的业务是会这样的，大家一定要捋清晰这些表的关系。</p><p>商品对象的创建需要六张表的数据。</p><h2 id="06、商品查询：商品列表数据来源分析"><a href="#06、商品查询：商品列表数据来源分析" class="headerlink" title="06、商品查询：商品列表数据来源分析"></a>06、商品查询：商品列表数据来源分析</h2><p>接下来，我们实现商品管理的页面，先看下我们要实现的效果：</p><p><img src="day05-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86.assets/1575602076461.png" alt="1575602076461"></p><p>可以看出整体是一个table，然后有新增按钮。是不是跟之前写品牌管理很像？</p><p>点击页面菜单中的商品列表页面：</p><p><img src="day05-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86.assets/1575603090588.png" alt="1575603090588"></p><p>页面右侧是一个空白的数据表格：</p><p><img src="day05-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86.assets/1552814807340.png" alt="1552814807340"></p><p>看到浏览器发起已经发起了查询商品数据的请求：</p><p><img src="day05-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86.assets/1528082212618.png" alt="1528082212618"></p><p>因此接下来，我们编写接口即可。</p><p>那么这些列表的数据分别来自那些表？</p><p><img src="day05-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86.assets/1601085832266.png" alt="1601085832266"></p><p><img src="day05-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86.assets/1575602926575.png" alt="1575602926575"></p><p>列表中我们只能先展示这几个数据，商品表我们之前分析了来源于六张表，那在哪里展示呢？</p><p>我们可以在商品详情页去展示。</p><h2 id="07、商品查询：商品模块准备工作"><a href="#07、商品查询：商品模块准备工作" class="headerlink" title="07、商品查询：商品模块准备工作"></a>07、商品查询：商品模块准备工作</h2><h3 id="1）SPU的entity"><a href="#1）SPU的entity" class="headerlink" title="1）SPU的entity"></a>1）SPU的entity</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>leyou<span class="token punctuation">.</span>item<span class="token punctuation">.</span>entity</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">IdType</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">TableId</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">TableName</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@TableName</span><span class="token punctuation">(</span><span class="token string">"tb_spu"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Spu</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@TableId</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">IdType</span><span class="token punctuation">.</span>AUTO<span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> brandId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> cid1<span class="token punctuation">;</span><span class="token comment">// 1级类目</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> cid2<span class="token punctuation">;</span><span class="token comment">// 2级类目</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> cid3<span class="token punctuation">;</span><span class="token comment">// 3级类目</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span><span class="token comment">// 商品名称</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> subTitle<span class="token punctuation">;</span><span class="token comment">// 子标题</span>
    <span class="token keyword">private</span> <span class="token class-name">Boolean</span> saleable<span class="token punctuation">;</span><span class="token comment">// 是否上架</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> createTime<span class="token punctuation">;</span><span class="token comment">// 创建时间</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> updateTime<span class="token punctuation">;</span><span class="token comment">// 最后修改时间</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2）SpuDetail的entity"><a href="#2）SpuDetail的entity" class="headerlink" title="2）SpuDetail的entity"></a>2）SpuDetail的entity</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>leyou<span class="token punctuation">.</span>item<span class="token punctuation">.</span>entity</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">IdType</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">TableId</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">TableName</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@TableName</span><span class="token punctuation">(</span><span class="token string">"tb_spu_detail"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpuDetail</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@TableId</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">IdType</span><span class="token punctuation">.</span>INPUT<span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> spuId<span class="token punctuation">;</span><span class="token comment">// 对应的SPU的id</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> description<span class="token punctuation">;</span><span class="token comment">// 商品描述</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> specialSpec<span class="token punctuation">;</span><span class="token comment">// 商品特殊规格的名称及可选值模板</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> genericSpec<span class="token punctuation">;</span><span class="token comment">// 商品的全局规格属性</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> packingList<span class="token punctuation">;</span><span class="token comment">// 包装清单</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> afterService<span class="token punctuation">;</span><span class="token comment">// 售后服务</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> createTime<span class="token punctuation">;</span><span class="token comment">// 创建时间</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> updateTime<span class="token punctuation">;</span><span class="token comment">// 最后修改时间</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3）Sku的entity"><a href="#3）Sku的entity" class="headerlink" title="3）Sku的entity"></a>3）Sku的entity</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>leyou<span class="token punctuation">.</span>item<span class="token punctuation">.</span>entity</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">IdType</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">TableId</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">TableName</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@TableName</span><span class="token punctuation">(</span><span class="token string">"tb_sku"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Sku</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@TableId</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">IdType</span><span class="token punctuation">.</span>AUTO<span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> spuId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> images<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> price<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> stock<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> ownSpec<span class="token punctuation">;</span><span class="token comment">// 商品特殊规格的键值对</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> indexes<span class="token punctuation">;</span><span class="token comment">// 商品特殊规格的下标</span>
    <span class="token keyword">private</span> <span class="token class-name">Boolean</span> enable<span class="token punctuation">;</span><span class="token comment">// 是否有效，逻辑删除用</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> createTime<span class="token punctuation">;</span><span class="token comment">// 创建时间</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> updateTime<span class="token punctuation">;</span><span class="token comment">// 最后修改时间</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4）SPU的DTO"><a href="#4）SPU的DTO" class="headerlink" title="4）SPU的DTO(*)"></a>4）SPU的DTO(*)</h3><p>先分析：</p><ul><li><p>请求方式：GET</p></li><li><p>请求路径：/spu/page</p></li><li><p>请求参数：</p><ul><li>page：当前页</li><li>rows：每页大小</li><li>key：过滤条件</li><li>saleable：上架或下架</li></ul></li><li><p>返回结果：通过页面能看出来，查询要展示的数据都是SPU数据，而且因为是分页查询，我们可以返回与之前品牌查询一样的PageResult。</p><ul><li><p>要注意，页面展示的中需要是商品分类和品牌名称，而SPU表中中保存的是id，我们需要在DTO中处理这些字段。</p><p>我们可以对Spu拓展categoryName和brandName属性：</p></li></ul></li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>leyou<span class="token punctuation">.</span>item<span class="token punctuation">.</span>dto</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 封装Spu的相关数据
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpuDTO</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> brandId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> cid1<span class="token punctuation">;</span><span class="token comment">// 1级类目</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> cid2<span class="token punctuation">;</span><span class="token comment">// 2级类目</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> cid3<span class="token punctuation">;</span><span class="token comment">// 3级类目</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span><span class="token comment">// 商品名称</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> subTitle<span class="token punctuation">;</span><span class="token comment">// 子标题</span>
    <span class="token keyword">private</span> <span class="token class-name">Boolean</span> saleable<span class="token punctuation">;</span><span class="token comment">// 是否上架</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> createTime<span class="token punctuation">;</span><span class="token comment">// 创建时间</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> updateTime<span class="token punctuation">;</span><span class="token comment">// 最后修改时间</span>

    <span class="token comment">//分类名称 格式：手机通讯/手机/手机</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> categoryName<span class="token punctuation">;</span>
    <span class="token comment">//品牌名称</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> brandName<span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="5）SPU的Mapper"><a href="#5）SPU的Mapper" class="headerlink" title="5）SPU的Mapper"></a>5）SPU的Mapper</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>leyou<span class="token punctuation">.</span>item<span class="token punctuation">.</span>mapper</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>core<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">BaseMapper</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>leyou<span class="token punctuation">.</span>item<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">Spu</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SpuMapper</span> <span class="token keyword">extends</span> <span class="token class-name">BaseMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Spu</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="6）SpuDetail的Mapper"><a href="#6）SpuDetail的Mapper" class="headerlink" title="6）SpuDetail的Mapper"></a>6）SpuDetail的Mapper</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>leyou<span class="token punctuation">.</span>item<span class="token punctuation">.</span>mapper</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>core<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">BaseMapper</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>leyou<span class="token punctuation">.</span>item<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">SpuDetail</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SpuDetailMapper</span> <span class="token keyword">extends</span> <span class="token class-name">BaseMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SpuDetail</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="7）Sku的Mapper"><a href="#7）Sku的Mapper" class="headerlink" title="7）Sku的Mapper"></a>7）Sku的Mapper</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>leyou<span class="token punctuation">.</span>item<span class="token punctuation">.</span>mapper</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>core<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">BaseMapper</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>leyou<span class="token punctuation">.</span>item<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">Sku</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SkuMapper</span> <span class="token keyword">extends</span> <span class="token class-name">BaseMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Sku</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="8）Goods商品的Service"><a href="#8）Goods商品的Service" class="headerlink" title="8）Goods商品的Service"></a>8）Goods商品的Service</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>leyou<span class="token punctuation">.</span>item<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>extension<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl<span class="token punctuation">.</span></span><span class="token class-name">ServiceImpl</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>leyou<span class="token punctuation">.</span>item<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">SkuMapper</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>leyou<span class="token punctuation">.</span>item<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">SpuDetailMapper</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>leyou<span class="token punctuation">.</span>item<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">SpuMapper</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Transactional</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 商品业务Service
 */</span>
<span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@Transactional</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GoodsService</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">SpuMapper</span> spuMapper<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">SpuDetailMapper</span> spuDetailMapper<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">SkuMapper</span> skuMapper<span class="token punctuation">;</span>

<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="9）Goods商品的Controller"><a href="#9）Goods商品的Controller" class="headerlink" title="9）Goods商品的Controller"></a>9）Goods商品的Controller</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>leyou<span class="token punctuation">.</span>item<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>leyou<span class="token punctuation">.</span>item<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">GoodsService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 商品Controller
 */</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GoodsController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">GoodsService</span> goodsService<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="08、商品查询：品牌和分类名称显示的准备工作"><a href="#08、商品查询：品牌和分类名称显示的准备工作" class="headerlink" title="08、商品查询：品牌和分类名称显示的准备工作"></a>08、商品查询：品牌和分类名称显示的准备工作</h2><h3 id="1）根据品牌id查询品牌对象"><a href="#1）根据品牌id查询品牌对象" class="headerlink" title="1）根据品牌id查询品牌对象"></a>1）根据品牌id查询品牌对象</h3><p>提供处理器</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
  * 根据id查询品牌对象
  */</span>
 <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/brand/{id}"</span><span class="token punctuation">)</span>
 <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Brand</span><span class="token punctuation">&gt;</span></span> <span class="token function">findBrandById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span>
     <span class="token class-name">Brand</span> brand <span class="token operator">=</span> brandService<span class="token punctuation">.</span><span class="token function">findBrandById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>brand<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>提供service</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">Brand</span> <span class="token function">findBrandById</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Brand</span> brand <span class="token operator">=</span> brandMapper<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>brand<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">LyException</span><span class="token punctuation">(</span><span class="token class-name">ExceptionEnum</span><span class="token punctuation">.</span>BRAND_NOT_FOUND<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> brand<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2）根据分类id的集合查询分类对象的列表"><a href="#2）根据分类id的集合查询分类对象的列表" class="headerlink" title="2）根据分类id的集合查询分类对象的列表"></a>2）根据分类id的集合查询分类对象的列表</h3><p>提供处理器</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
   * 根据分类ID集合获取分类集合
   */</span>
  <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/category/list"</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Category</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">findCategoriesByIds</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"ids"</span><span class="token punctuation">)</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> ids<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Category</span><span class="token punctuation">&gt;</span></span> categories <span class="token operator">=</span> categoryService<span class="token punctuation">.</span><span class="token function">findCategoriesByIds</span><span class="token punctuation">(</span>ids<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>categories<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>提供service</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Category</span><span class="token punctuation">&gt;</span></span> <span class="token function">findCategoriesByIds</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> ids<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Category</span><span class="token punctuation">&gt;</span></span> categories <span class="token operator">=</span> categoryMapper<span class="token punctuation">.</span><span class="token function">selectBatchIds</span><span class="token punctuation">(</span>ids<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>categories<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
           <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">LyException</span><span class="token punctuation">(</span><span class="token class-name">ExceptionEnum</span><span class="token punctuation">.</span>CATEGORY_NOT_FOUND<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token keyword">return</span> categories<span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="09、商品查询：Spu分页查询"><a href="#09、商品查询：Spu分页查询" class="headerlink" title="09、商品查询：Spu分页查询(*)"></a>09、商品查询：Spu分页查询(*)</h2><h3 id="1）GoodsController添加方法"><a href="#1）GoodsController添加方法" class="headerlink" title="1）GoodsController添加方法"></a>1）GoodsController添加方法</h3><p>先分析：</p><ul><li>请求方式：GET</li><li>请求路径：/spu/page</li><li>请求参数：<ul><li>page：当前页</li><li>rows：每页大小</li><li>key：过滤条件</li><li>saleable：上架或下架</li></ul></li><li>返回结果：PageResult</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>leyou<span class="token punctuation">.</span>item<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>leyou<span class="token punctuation">.</span>common<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">PageResult</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>leyou<span class="token punctuation">.</span>item<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span><span class="token class-name">SpuDTO</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>leyou<span class="token punctuation">.</span>item<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">GoodsService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">ResponseEntity</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestParam</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 商品
 */</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GoodsController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">GoodsService</span> goodsService<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 商品分页查询
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/spu/page"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PageResult</span><span class="token punctuation">&lt;</span><span class="token class-name">SpuDTO</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">goodsPageQuery</span><span class="token punctuation">(</span>
            <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"page"</span><span class="token punctuation">,</span>defaultValue <span class="token operator">=</span> <span class="token string">"1"</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> page<span class="token punctuation">,</span>
            <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"rows"</span><span class="token punctuation">,</span>defaultValue <span class="token operator">=</span> <span class="token string">"5"</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> rows<span class="token punctuation">,</span>
            <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"key"</span><span class="token punctuation">,</span>required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> key<span class="token punctuation">,</span>
            <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"saleable"</span><span class="token punctuation">,</span>required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">Boolean</span> saleable
    <span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">PageResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SpuDTO</span><span class="token punctuation">&gt;</span></span> pageResult <span class="token operator">=</span> goodsService<span class="token punctuation">.</span><span class="token function">goodsPageQuery</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span>rows<span class="token punctuation">,</span>key<span class="token punctuation">,</span>saleable<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>pageResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2）GoodsService添加方法"><a href="#2）GoodsService添加方法" class="headerlink" title="2）GoodsService添加方法"></a>2）GoodsService添加方法</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>leyou<span class="token punctuation">.</span>item<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>core<span class="token punctuation">.</span>conditions<span class="token punctuation">.</span>query<span class="token punctuation">.</span></span><span class="token class-name">QueryWrapper</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>core<span class="token punctuation">.</span>metadata<span class="token punctuation">.</span></span><span class="token class-name">IPage</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>core<span class="token punctuation">.</span>toolkit<span class="token punctuation">.</span></span><span class="token class-name">StringUtils</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>core<span class="token punctuation">.</span>toolkit<span class="token punctuation">.</span></span><span class="token class-name">Wrappers</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>extension<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span>pagination<span class="token punctuation">.</span></span><span class="token class-name">Page</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>leyou<span class="token punctuation">.</span>common<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">PageResult</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>leyou<span class="token punctuation">.</span>common<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">BeanHelper</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>leyou<span class="token punctuation">.</span>item<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span><span class="token class-name">SpuDTO</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>leyou<span class="token punctuation">.</span>item<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">SkuMapper</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>leyou<span class="token punctuation">.</span>item<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">SpuDetailMapper</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>leyou<span class="token punctuation">.</span>item<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">SpuMapper</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>leyou<span class="token punctuation">.</span>item<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">Brand</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>leyou<span class="token punctuation">.</span>item<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">Category</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>leyou<span class="token punctuation">.</span>item<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">Spu</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Transactional</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token class-name">Collectors</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 商品业务
 */</span>
<span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@Transactional</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GoodsService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">SpuMapper</span> spuMapper<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">SpuDetailMapper</span> spuDetailMapper<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">SkuMapper</span> skuMapper<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">BrandService</span> brandService<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">CategoryService</span> categoryService<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">PageResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SpuDTO</span><span class="token punctuation">&gt;</span></span> <span class="token function">goodsPageQuery</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> page<span class="token punctuation">,</span> <span class="token class-name">Integer</span> rows<span class="token punctuation">,</span> <span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Boolean</span> saleable<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">//1.封装条件</span>
        <span class="token comment">//1.1 设置分页参数</span>
        <span class="token class-name">IPage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Spu</span><span class="token punctuation">&gt;</span></span> iPage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>page<span class="token punctuation">,</span>rows<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//1.2 设置查询条件</span>
        <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Spu</span><span class="token punctuation">&gt;</span></span> queryWrapper <span class="token operator">=</span> <span class="token class-name">Wrappers</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//关键词</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// ( name like 'XX' or sub_title like 'XX' )</span>
            <span class="token comment">/**
             * queryWrapper.and(): 把and里面所有条件作为一个整体查询（加括号）
             *    注意：and(): 使用lambda表达式编写
             */</span>
            queryWrapper<span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span>
                    q<span class="token operator">-&gt;</span>q<span class="token punctuation">.</span><span class="token function">like</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span>key<span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">or</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">like</span><span class="token punctuation">(</span><span class="token string">"sub_title"</span><span class="token punctuation">,</span>key<span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>

        <span class="token comment">//上下架</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>saleable<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            queryWrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">"saleable"</span><span class="token punctuation">,</span>saleable<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//2.执行查询，获取结果</span>
        iPage <span class="token operator">=</span> spuMapper<span class="token punctuation">.</span><span class="token function">selectPage</span><span class="token punctuation">(</span>iPage<span class="token punctuation">,</span>queryWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//3.处理结果，返回</span>
        <span class="token comment">//3.1 取出所有Spu对象</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Spu</span><span class="token punctuation">&gt;</span></span> spuList <span class="token operator">=</span> iPage<span class="token punctuation">.</span><span class="token function">getRecords</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//3.2 拷贝Spu的属性值到SpuDTO对象中（只能拷贝相同属性）</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SpuDTO</span><span class="token punctuation">&gt;</span></span> spuDTOList <span class="token operator">=</span> <span class="token class-name">BeanHelper</span><span class="token punctuation">.</span><span class="token function">copyWithCollection</span><span class="token punctuation">(</span>spuList<span class="token punctuation">,</span> <span class="token class-name">SpuDTO</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//3.3 封装分类名称和品牌名称</span>
        <span class="token function">getCategoryNameAndBrandName</span><span class="token punctuation">(</span>spuDTOList<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//3.4 封装PageResult对象</span>
        <span class="token class-name">PageResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SpuDTO</span><span class="token punctuation">&gt;</span></span> pageResult <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PageResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>iPage<span class="token punctuation">.</span><span class="token function">getTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>iPage<span class="token punctuation">.</span><span class="token function">getPages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>spuDTOList<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//返回结果</span>
        <span class="token keyword">return</span> pageResult<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 封装分类名称和品牌名称
     * @param spuDTOList
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getCategoryNameAndBrandName</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SpuDTO</span><span class="token punctuation">&gt;</span></span> spuDTOList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        spuDTOList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>spuDTO <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">//1.查询并封装品牌名称</span>
            <span class="token class-name">Brand</span> brand <span class="token operator">=</span> brandService<span class="token punctuation">.</span><span class="token function">findBrandById</span><span class="token punctuation">(</span>spuDTO<span class="token punctuation">.</span><span class="token function">getBrandId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            spuDTO<span class="token punctuation">.</span><span class="token function">setBrandName</span><span class="token punctuation">(</span>brand<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//2.查询并封装分类名称</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Category</span><span class="token punctuation">&gt;</span></span> categoryList <span class="token operator">=</span> categoryService<span class="token punctuation">.</span><span class="token function">findCategoriesByIds</span><span class="token punctuation">(</span>
                    <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>spuDTO<span class="token punctuation">.</span><span class="token function">getCid1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> spuDTO<span class="token punctuation">.</span><span class="token function">getCid2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> spuDTO<span class="token punctuation">.</span><span class="token function">getCid3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//格式： 手机通讯/手机/手机</span>
            <span class="token comment">/**
             * 使用stream流式编程
             *  1）应用场景：对集合操作进行简化
             *  2）stream流式编程的核心方法
             *     stream(): 将集合转换为流（第一个必要步骤）
             *     map(): 映射。 编写对集合元素的处理逻辑。例如： 取出List&lt;Category&gt;中的Category对象的name属性
             *         map()方法的语法就是lambda表达式（两种写法）
             *              map(category -&gt; category.getName())
             *              map(Category::getName)  推荐使用
             *
             *     collect(): 收集。指定对map方法处理结果如何归总(Collectors对象)。 例如：
             *           将Category对象的name值重新放入List  toList()
             *          将Category对象的name值重新放入Set    toSet()
             *          将Category对象的name值重新放入Map    toMap()
             *          将Category对象的name值使用/重新拼接一个新的字符串  joining()
             *          ......
             */</span>
             <span class="token class-name">String</span> categoryName <span class="token operator">=</span> categoryList
                                            <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Category</span><span class="token operator">::</span><span class="token function">getName</span><span class="token punctuation">)</span>
                                            <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">joining</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             spuDTO<span class="token punctuation">.</span><span class="token function">setCategoryName</span><span class="token punctuation">(</span>categoryName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>编写完成后，重启微服务，然后打开页面测试：</p><p><img src="day05-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86.assets/1575624468429.png" alt="1575624468429"></p><h2 id="10、商品保存：业务分析"><a href="#10、商品保存：业务分析" class="headerlink" title="10、商品保存：业务分析"></a>10、商品保存：业务分析</h2><h3 id="1）页面预览"><a href="#1）页面预览" class="headerlink" title="1）页面预览"></a>1）页面预览</h3><p>当我们点击新增商品按钮：</p><p><img src="day05-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86.assets/1528083727447.png" alt="1528083727447"></p><p>就会出现一个弹窗：</p><p><img src="day05-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86.assets/1528086595597.png" alt="1528086595597"></p><p>里面把商品的数据分为了4部分来填写：</p><ul><li>基本信息：主要是一些简单的文本数据，包含了SPU和SpuDetail的部分数据，如<ul><li>商品分类：是SPU中的<code>cid1</code>，<code>cid2</code>，<code>cid3</code>属性</li><li>品牌：是spu中的<code>brandId</code>属性</li><li>标题：是spu中的<code>title</code>属性</li><li>子标题：是spu中的<code>subTitle</code>属性</li><li>售后服务：是SpuDetail中的<code>afterService</code>属性</li><li>包装列表：是SpuDetail中的<code>packingList</code>属性</li></ul></li><li>商品描述：是SpuDetail中的<code>description</code>属性，数据较多，所以单独放一个页面</li><li>规格参数：商品规格信息，对应SpuDetail中的<code>genericSpec</code>属性</li><li>SKU属性：spu下的所有Sku信息</li></ul><p>也就是说这个页面包含了商品相关的三张表中的数据：</p><ul><li>tb_spu</li><li>tb_spu_detail</li><li>tb_sku</li></ul><h3 id="2）商品分类"><a href="#2）商品分类" class="headerlink" title="2）商品分类"></a>2）商品分类</h3><p>商品分类的级联选框我们之前在品牌查询已经做过，是要根据分类的pid查询分类，所以这里的级联选框已经实现完成：</p><p>刷新页面，可以看到请求已经发出：</p><p><img src="day05-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86.assets/1528101483023.png" alt="1528101483023"></p><p><img src="day05-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86.assets/1528101622952.png" alt="1528101622952"></p><p><img src="day05-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86.assets/1528101649596.png" alt="1528101649596"></p><p>需要注意的是，这里选中以后会显示3级分类，因为数据库中保存的就是商品的1~3级类目。</p><p>注意：当选定了一个分类后，那么其实就已经确定了品牌的范围和规格参数的范围。</p><p><img src="day05-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86.assets/image-20200316141742307.png" alt="image-20200316141742307"></p><h3 id="3）品牌选择"><a href="#3）品牌选择" class="headerlink" title="3）品牌选择"></a>3）品牌选择</h3><p>品牌也是一个下拉选框，不过其选项是不确定的，只有当用户选择了商品分类，才会把这个分类下的所有品牌展示出来。</p><p>所以页面编写了watch函数，监控商品分类的变化，每当商品分类值有变化，就会发起请求，查询品牌列表。刷新页面，当选中一个分类时，可以看到请求发起：</p><p><img src="day05-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86.assets/1552822964914.png" alt="1552822964914"></p><p>接下来，我们只要编写后台接口，根据商品分类id，查询对应品牌即可。</p><h2 id="11、商品保存：根据分类查询品牌"><a href="#11、商品保存：根据分类查询品牌" class="headerlink" title="11、商品保存：根据分类查询品牌"></a>11、商品保存：根据分类查询品牌</h2><p>页面需要去后台查询品牌信息，我们自然需要提供：</p><h3 id="1）controller"><a href="#1）controller" class="headerlink" title="1）controller"></a>1）controller</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
  * 根据分类id查询品牌
  */</span>
 <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/brand/of/category"</span><span class="token punctuation">)</span>
 <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Brand</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">findBrandsByCid</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span>
     <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Brand</span><span class="token punctuation">&gt;</span></span> brands <span class="token operator">=</span> brandService<span class="token punctuation">.</span><span class="token function">findBrandsByCid</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>brands<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2）service"><a href="#2）service" class="headerlink" title="2）service"></a>2）service</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Brand</span><span class="token punctuation">&gt;</span></span> <span class="token function">findBrandsByCid</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Brand</span><span class="token punctuation">&gt;</span></span> brands <span class="token operator">=</span> brandMapper<span class="token punctuation">.</span><span class="token function">findBrandsByCid</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>brands<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
           <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">LyException</span><span class="token punctuation">(</span><span class="token class-name">ExceptionEnum</span><span class="token punctuation">.</span>BRAND_NOT_FOUND<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token keyword">return</span> brands<span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3）mapper"><a href="#3）mapper" class="headerlink" title="3）mapper"></a>3）mapper</h3><p>根据分类查询品牌有中间表，需要自己编写Sql：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>leyou<span class="token punctuation">.</span>item<span class="token punctuation">.</span>mapper</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>core<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">BaseMapper</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>leyou<span class="token punctuation">.</span>item<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">Brand</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Param</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Select</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 品牌
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BrandMapper</span> <span class="token keyword">extends</span> <span class="token class-name">BaseMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Brand</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">saveBrandAndCategory</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"bid"</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">,</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"cids"</span><span class="token punctuation">)</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> cids<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"SELECT b.* FROM tb_brand b,tb_category_brand cb WHERE b.`id` = cb.brand_id and cb.category_id = #{cid}"</span><span class="token punctuation">)</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Brand</span><span class="token punctuation">&gt;</span></span> <span class="token function">findBrandsByCid</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>



<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>效果：</p><p><img src="day05-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86.assets/1528102194745.png" alt="1528102194745"></p><h2 id="12、商品保存：商品描述及富文本编辑器"><a href="#12、商品保存：商品描述及富文本编辑器" class="headerlink" title="12、商品保存：商品描述及富文本编辑器"></a>12、商品保存：商品描述及富文本编辑器</h2><h3 id="1）富文本编辑器介绍"><a href="#1）富文本编辑器介绍" class="headerlink" title="1）富文本编辑器介绍"></a>1）富文本编辑器介绍</h3><p>标题、子标题等都是普通文本框，我们直接填写即可，没有需要特别注意的，商品描述信息比较复杂，而且图文并茂，甚至包括视频。</p><p>这样的内容，一般都会使用富文本编辑器。</p><p><strong>==什么是富文本编辑器？==</strong></p><p>百度百科：</p><p><img src="day05-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86.assets/1526290914491.png" alt="1526290914491"></p><p>通俗来说：富文本，就是比较丰富的文本编辑器。普通的框只能输入文字，而富文本还能给文字加颜色样式等。</p><p>富文本编辑器有很多，例如：KindEditor、Ueditor。但并不原生支持vue</p><p>但是我们今天要说的，是一款支持Vue的富文本编辑器：<code>vue-quill-editor</code></p><h3 id="2）Vue-Quill-Editor介绍"><a href="#2）Vue-Quill-Editor介绍" class="headerlink" title="2）Vue-Quill-Editor介绍"></a>2）Vue-Quill-Editor介绍</h3><p>GitHub的主页：<a target="_blank" rel="noopener" href="https://github.com/surmon-china/vue-quill-editor">https://github.com/surmon-china/vue-quill-editor</a></p><p>Vue-Quill-Editor是一个基于Quill的富文本编辑器：<a target="_blank" rel="noopener" href="https://quilljs.com/">Quill的官网</a></p><p><img src="day05-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86.assets/1526291232678.png" alt="1526291232678"></p><h3 id="3）Vue-Quill-Editor使用指南"><a href="#3）Vue-Quill-Editor使用指南" class="headerlink" title="3）Vue-Quill-Editor使用指南"></a>3）Vue-Quill-Editor使用指南</h3><p>使用非常简单：</p><p>第一步：安装，使用npm命令：</p><pre class="line-numbers language-none"><code class="language-none">npm install vue-quill-editor --save<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>第二步：加载，在js中引入：</p><p>全局使用：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> VueQuillEditor <span class="token keyword">from</span> <span class="token string">'vue-quill-editor'</span>

<span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">/* { default global options } */</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>VueQuillEditor<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// options可选</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>局部使用：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> <span class="token string">'quill/dist/quill.core.css'</span>
<span class="token keyword">import</span> <span class="token string">'quill/dist/quill.snow.css'</span>
<span class="token keyword">import</span> <span class="token string">'quill/dist/quill.bubble.css'</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span>quillEditor<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue-quill-editor'</span>

<span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    components<span class="token operator">:</span><span class="token punctuation">{</span>
        quillEditor
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>第三步：页面引用：</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>quill-editor</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>goods.spuDetail.description<span class="token punctuation">"</span></span> <span class="token attr-name">:options</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>editorOption<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="4）自定义富文本编辑器"><a href="#4）自定义富文本编辑器" class="headerlink" title="4）自定义富文本编辑器"></a>4）自定义富文本编辑器</h3><p>不过这个组件有个小问题，就是图片上传的无法直接上传到后台，因此我们对其进行了封装，支持了图片的上传。</p><p><img src="day05-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86.assets/1526296083605.png" alt="1526296083605.png"></p><p>使用也非常简单：</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-stepper-content</span> <span class="token attr-name">step</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-editor</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>goods.spuDetail.description<span class="token punctuation">"</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/upload/signature<span class="token punctuation">"</span></span> <span class="token attr-name">needSignature</span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-stepper-content</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>url：是图片上传的路径或者上传阿里OSS时的签名路径，这里输入的是签名路径</li><li>v-model：双向绑定，将富文本编辑器的内容绑定到goods.spuDetail.description</li></ul><h3 id="5）效果"><a href="#5）效果" class="headerlink" title="5）效果"></a>5）效果</h3><p><img src="day05-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86.assets/1526297276667.png" alt="1526297276667"></p><h2 id="13、商品保存：规格参数与SKU属性"><a href="#13、商品保存：规格参数与SKU属性" class="headerlink" title="13、商品保存：规格参数与SKU属性"></a>13、商品保存：规格参数与SKU属性</h2><h3 id="1）规格参数"><a href="#1）规格参数" class="headerlink" title="1）规格参数"></a>1）规格参数</h3><p>规格参数的查询我们之前也已经编写过接口，因为商品规格参数也是与商品分类绑定，所以需要在商品分类变化后去查询，我们也是通过watch监控来实现：</p><p>页面如下：</p><p><img src="day05-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86.assets/1529631887407-1580713055669.png" alt="1529631887407"></p><h3 id="2）SKU属性"><a href="#2）SKU属性" class="headerlink" title="2）SKU属性"></a>2）SKU属性</h3><p>Sku属性是SPU下的每个商品的不同特征，如图：</p><p><img src="day05-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86.assets/1529656674978-1580713055669.png" alt="1529656674978"></p><p>当我们填写一些属性后，会在页面下方生成一个sku表格，大家可以计算下会生成多少个不同属性的Sku呢？</p><p>当你选择了上图中的这些选项时：</p><ul><li>颜色共2种：夜空黑，绚丽红</li><li>内存共2种：4GB，6GB</li><li>机身存储1种：64GB</li></ul><p>此时会产生多少种SKU呢？ 应该是 2 * 2 * 1 = 4种，这其实就是在求笛卡尔积。</p><p>我们会在页面下方生成一个sku的表格：</p><p><img src="day05-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86.assets/1528856353718-1580713055669.png" alt="1528856353718"></p><p>这个表格中就包含了以上颜色内存的所有可能组合，剩下的价格等信息就需要用户自己来完成了。</p><p>注意，页面中的sku的图片上传，默认是上传到阿里云，当然可以根据自己情况修改上传到本地nginx。</p><p>最后我们可以根据填写号的特有规格参数属性，来选定最终我们要保存几个sku：</p><p><img src="day05-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86.assets/image-20200316145040477.png" alt="image-20200316145040477"></p><h2 id="14、商品保存：修改SpuDTO对象"><a href="#14、商品保存：修改SpuDTO对象" class="headerlink" title="14、商品保存：修改SpuDTO对象"></a>14、商品保存：修改SpuDTO对象</h2><p>当我们发起保存提交的时候，页面向后台提交的数据如下：</p><p><img src="day05-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86.assets/image-20200316145200396.png" alt="image-20200316145200396"></p><p>我们可以修改SpuDTO，在里面添加两个属性，来接收当前所有提交的数据：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>leyou<span class="token punctuation">.</span>item<span class="token punctuation">.</span>dto</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">TableName</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>leyou<span class="token punctuation">.</span>item<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">Sku</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>leyou<span class="token punctuation">.</span>item<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">Spu</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>leyou<span class="token punctuation">.</span>item<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">SpuDetail</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 封装商品展示列表需要的数据
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpuDTO</span><span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> brandId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> cid1<span class="token punctuation">;</span><span class="token comment">// 1级类目</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> cid2<span class="token punctuation">;</span><span class="token comment">// 2级类目</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> cid3<span class="token punctuation">;</span><span class="token comment">// 3级类目</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span><span class="token comment">// 商品名称</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> subTitle<span class="token punctuation">;</span><span class="token comment">// 子标题</span>
    <span class="token keyword">private</span> <span class="token class-name">Boolean</span> saleable<span class="token punctuation">;</span><span class="token comment">// 是否上架</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> createTime<span class="token punctuation">;</span><span class="token comment">// 创建时间</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> updateTime<span class="token punctuation">;</span><span class="token comment">// 最后修改时间</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> brandName<span class="token punctuation">;</span><span class="token comment">//品牌名称</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> categoryName<span class="token punctuation">;</span><span class="token comment">//分类名称</span>

    <span class="token keyword">private</span> <span class="token class-name">SpuDetail</span> spuDetail<span class="token punctuation">;</span> <span class="token comment">//用于接收添加商品的SpuDetail数据</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Sku</span><span class="token punctuation">&gt;</span></span> skus<span class="token punctuation">;</span> <span class="token comment">// 用于接收添加商品的SpuDetail数据</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="15、商品保存：完成商品保存逻辑"><a href="#15、商品保存：完成商品保存逻辑" class="headerlink" title="15、商品保存：完成商品保存逻辑"></a>15、商品保存：完成商品保存逻辑</h2><h3 id="1）改造GoodsService"><a href="#1）改造GoodsService" class="headerlink" title="1）改造GoodsService"></a>1）改造GoodsService</h3><blockquote><p>为批量添加Sku做准备</p></blockquote><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@Transactional</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GoodsService</span> <span class="token keyword">extends</span> <span class="token class-name">ServiceImpl</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuMapper</span><span class="token punctuation">,</span> <span class="token class-name">Sku</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    ……
    
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2）提供处理器"><a href="#2）提供处理器" class="headerlink" title="2）提供处理器"></a>2）提供处理器</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
   * 添加商品
   */</span>
  <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/goods"</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">saveGoods</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">SpuDTO</span> spuDTO<span class="token punctuation">)</span><span class="token punctuation">{</span>
      goodsService<span class="token punctuation">.</span><span class="token function">saveGoods</span><span class="token punctuation">(</span>spuDTO<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span>CREATED<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3）提供service"><a href="#3）提供service" class="headerlink" title="3）提供service"></a>3）提供service</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">saveGoods</span><span class="token punctuation">(</span><span class="token class-name">SpuDTO</span> spuDTO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">try</span> <span class="token punctuation">{</span>
           <span class="token comment">//1.保存spu表</span>
           <span class="token class-name">Spu</span> spu <span class="token operator">=</span> <span class="token class-name">BeanHelper</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>spuDTO<span class="token punctuation">,</span><span class="token class-name">Spu</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">//默认下架</span>
           spu<span class="token punctuation">.</span><span class="token function">setSaleable</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           spuMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>spu<span class="token punctuation">)</span><span class="token punctuation">;</span>

           <span class="token comment">//2.保存spu_detail表</span>
           <span class="token class-name">SpuDetail</span> spuDetail <span class="token operator">=</span> spuDTO<span class="token punctuation">.</span><span class="token function">getSpuDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">//必须设置spuId</span>
           spuDetail<span class="token punctuation">.</span><span class="token function">setSpuId</span><span class="token punctuation">(</span>spu<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           spuDetailMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>spuDetail<span class="token punctuation">)</span><span class="token punctuation">;</span>

           <span class="token comment">//3.保存sku表</span>
           <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Sku</span><span class="token punctuation">&gt;</span></span> skus <span class="token operator">=</span> spuDTO<span class="token punctuation">.</span><span class="token function">getSkus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">//必须设置spuId</span>
           skus<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>sku <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
               sku<span class="token punctuation">.</span><span class="token function">setSpuId</span><span class="token punctuation">(</span>spu<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">//批量增加</span>
           <span class="token function">saveBatch</span><span class="token punctuation">(</span>skus<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">LyException</span><span class="token punctuation">(</span><span class="token class-name">ExceptionEnum</span><span class="token punctuation">.</span>INSERT_OPERATION_FAIL<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如果使用批量增加，需要继承ServiceImpl类</p><p><img src="day05-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86.assets/1605932444121.png" alt="1605932444121"></p><h3 id="4）重启服务器查看保存商品效果"><a href="#4）重启服务器查看保存商品效果" class="headerlink" title="4）重启服务器查看保存商品效果"></a>4）重启服务器查看保存商品效果</h3><p><img src="day05-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86.assets/image-20200316150902084.png" alt="image-20200316150902084"></p><h2 id="16、商品修改：商品上下架操作"><a href="#16、商品修改：商品上下架操作" class="headerlink" title="16、商品修改：商品上下架操作"></a>16、商品修改：商品上下架操作</h2><p>在商品详情页，每一个商品后面，都会有一个编辑按钮：</p><p><img src="day05-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86.assets/1528874711108-1609304554475.png" alt="1528874711108"></p><p>点击这个按钮，并没有打开商品编辑窗口，而是弹出了一个提示窗口：</p><p><img src="day05-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86.assets/1552901853155-1609304554475.png" alt="1552901853155"></p><p>已经上架的商品用户可能正在购买，所以不能修改。必须要先下架才可以。</p><h3 id="1）页面请求"><a href="#1）页面请求" class="headerlink" title="1）页面请求"></a>1）页面请求</h3><p>此时打开控制台，可以看到请求已经发出了：</p><p><img src="day05-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86.assets/1552902179096-1609304554475.png" alt="1552902179096"></p><p>请求方式：PUT</p><p>请求路径：/spu/saleable</p><p>参数有两个 ：</p><ul><li>id：应该是spu的id</li><li>saleable：布尔值，代表上架或下架</li></ul><p>返回结果：应该是无</p><h3 id="2）后台实现：Controller"><a href="#2）后台实现：Controller" class="headerlink" title="2）后台实现：Controller"></a>2）后台实现：Controller</h3><p>接下来我们在服务端接收请求，并且修改spu的saleable属性。</p><p>需要注意的是，我们在修改spu的上下架状态时，无需修改sku的enable属性，sku的enable属性只与当前sku的库存量有关，如果库存大于0，就是有效，否则是无效。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
    * 商品上下架
    */</span>
   <span class="token annotation punctuation">@PutMapping</span><span class="token punctuation">(</span><span class="token string">"/spu/saleable"</span><span class="token punctuation">)</span>
   <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">updateSaleable</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">,</span>
                                              <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"saleable"</span><span class="token punctuation">)</span> <span class="token class-name">Boolean</span> saleable<span class="token punctuation">)</span><span class="token punctuation">{</span>
       goodsService<span class="token punctuation">.</span><span class="token function">updateSaleable</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>saleable<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span>NO_CONTENT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3）后台实现：Service"><a href="#3）后台实现：Service" class="headerlink" title="3）后台实现：Service"></a>3）后台实现：Service</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateSaleable</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">,</span> <span class="token class-name">Boolean</span> saleable<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Spu</span> spu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Spu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            spu<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
            spu<span class="token punctuation">.</span><span class="token function">setSaleable</span><span class="token punctuation">(</span>saleable<span class="token punctuation">)</span><span class="token punctuation">;</span>

            spuMapper<span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>spu<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//注意：updateById该方法会自动判断NULL不更新的</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">LyException</span><span class="token punctuation">(</span><span class="token class-name">ExceptionEnum</span><span class="token punctuation">.</span>UPDATE_OPERATION_FAIL<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="17、门户网站：搭建门户网站"><a href="#17、门户网站：搭建门户网站" class="headerlink" title="17、门户网站：搭建门户网站"></a>17、门户网站：搭建门户网站</h2><p>后台系统的内容暂时告一段落，有了商品，接下来我们就要在页面展示商品，给用户提供浏览和购买的入口，那就是我们的门户系统。</p><p>门户系统面向的是用户，安全性很重要，而且搜索引擎对于单页应用并不友好。因此我们的门户系统不再采用与后台系统类似的SPA（单页应用）。</p><p>依然是前后端分离，不过前端的页面会使用独立的html，在每个页面中使用vue来做页面渲染。</p><h3 id="1）静态资源"><a href="#1）静态资源" class="headerlink" title="1）静态资源"></a>1）静态资源</h3><p>webpack打包多页应用配置比较繁琐，项目结构也相对复杂。这里为了简化开发（毕竟我们不是专业的前端人员），我们不在使用webpack，而是直接编写原生的静态HTML。</p><p>将课前资料中的leyou-portal解压，并把结果赋值到工作空间的目录</p><p><img src="day05-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86.assets/1575856639891.png" alt="1575856639891"></p><p>解压缩：</p><p><img src="day05-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86.assets/1575856696888.png" alt="1575856696888"></p><p>然后通过idea打开，可以看到项目结构：</p><p><img src="day05-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86.assets/1575856847088.png" alt="1575856847088"></p><h3 id="2）live-server"><a href="#2）live-server" class="headerlink" title="2）live-server"></a>2）live-server</h3><h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><p>没有webpack，我们就无法使用webpack-dev-server运行这个项目，实现热部署。</p><p>所以，这里我们使用另外一种热部署方式：live-server</p><p>地址；<a target="_blank" rel="noopener" href="https://www.npmjs.com/package/live-server">https://www.npmjs.com/package/live-server</a></p><p><img src="day05-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86.assets/1575857010863.png" alt="1575857010863"></p><p>这是一款带有热加载功能的小型开发服务器。用它来展示你的HTML / JavaScript / CSS，但不能用于部署最终的网站。</p><h4 id="安装和运行参数"><a href="#安装和运行参数" class="headerlink" title="安装和运行参数"></a>安装和运行参数</h4><p>安装，使用npm命令即可，这里建议全局安装，以后任意位置可用</p><pre class="line-numbers language-none"><code class="language-none">npm install -g live-server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>运行时，直接输入命令：</p><pre class="line-numbers language-none"><code class="language-none">live-server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>另外，你可以在运行命令后，跟上一些参数以配置：</p><ul><li><code>--port=NUMBER</code> - 选择要使用的端口，默认值：PORT env var或8080</li><li><code>--host=ADDRESS</code> - 选择要绑定的主机地址，默认值：IP env var或0.0.0.0（“任意地址”）</li><li><code>--no-browser</code> - 禁止自动Web浏览器启动</li><li><code>--browser=BROWSER</code> - 指定使用浏览器而不是系统默认值</li><li><code>--quiet | -q</code> - 禁止记录</li><li><code>--verbose | -V</code> - 更多日志记录（记录所有请求，显示所有侦听的IPv4接口等）</li><li><code>--open=PATH</code> - 启动浏览器到PATH而不是服务器root</li><li><code>--watch=PATH</code> - 用逗号分隔的路径来专门监视变化（默认值：观看所有内容）</li><li><code>--ignore=PATH</code>- 要忽略的逗号分隔的路径字符串（<a target="_blank" rel="noopener" href="https://github.com/es128/anymatch">anymatch</a> -compatible definition）</li><li><code>--ignorePattern=RGXP</code>-文件的正则表达式忽略（即<code>.*\.jade</code>）（<strong>不推荐使用</strong>赞成<code>--ignore</code>）</li><li><code>--middleware=PATH</code> - 导出要添加的中间件功能的.js文件的路径; 可以是没有路径的名称，也可以是引用<code>middleware</code>文件夹中捆绑的中间件的扩展名</li><li><code>--entry-file=PATH</code> - 提供此文件（服务器根目录）代替丢失的文件（对单页应用程序有用）</li><li><code>--mount=ROUTE:PATH</code> - 在定义的路线下提供路径内容（可能有多个定义）</li><li><code>--spa</code> - 将请求从/ abc转换为/＃/ abc（方便单页应用）</li><li><code>--wait=MILLISECONDS</code> - （默认100ms）等待所有更改，然后重新加载</li><li><code>--htpasswd=PATH</code> - 启用期待位于PATH的htpasswd文件的http-auth</li><li><code>--cors</code> - 为任何来源启用CORS（反映请求源，支持凭证的请求）</li><li><code>--https=PATH</code> - 到HTTPS配置模块的路径</li><li><code>--proxy=ROUTE:URL</code> - 代理ROUTE到URL的所有请求</li><li><code>--help | -h</code> - 显示简洁的使用提示并退出</li><li><code>--version | -v</code> - 显示版本并退出</li></ul><h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><p>我们进入leyou-portal目录，输入命令：</p><pre class="line-numbers language-none"><code class="language-none">live-server --port=9002<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="day05-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86.assets/1575857312796.png" alt="1575857312796"></p><h3 id="3）在package-json中配置启动命令"><a href="#3）在package-json中配置启动命令" class="headerlink" title="3）在package.json中配置启动命令"></a>3）在package.json中配置启动命令</h3><p>初始化npm，其中-y表示一路yes安装下去</p><pre class="line-numbers language-none"><code class="language-none">npm init -y<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>安装vue</p><pre class="line-numbers language-none"><code class="language-none">npm install vue --save<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>配置启动脚本：</p><p>进入package.json文件，在script中添加启动脚本：</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"leyou-portal"</span><span class="token punctuation">,</span>
  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>
  <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
  <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"index.js"</span><span class="token punctuation">,</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span><span class="token punctuation">,</span>
    <span class="token property">"serve"</span><span class="token operator">:</span> <span class="token string">"live-server --port=9002"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"keywords"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"author"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
  <span class="token property">"license"</span><span class="token operator">:</span> <span class="token string">"ISC"</span><span class="token punctuation">,</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"vue"</span><span class="token operator">:</span> <span class="token string">"^2.6.10"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>以后可以用 npm run serve启动</p><h3 id="4）域名访问"><a href="#4）域名访问" class="headerlink" title="4）域名访问"></a>4）域名访问</h3><p>现在我们访问的是：<a target="_blank" rel="noopener" href="http://127.0.0.1:9002/">http://127.0.0.1:9002</a></p><p>之前我们已经配置好了9002端口对应的域名：<a target="_blank" rel="noopener" href="http://www.leyou.com/">http://www.leyou.com</a></p><p>所以今后我们可以直接使用域名访问</p><p><img src="day05-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86.assets/1575857973549.png" alt="1575857973549"></p><h3 id="5）在网关中给门户网站跨域权限"><a href="#5）在网关中给门户网站跨域权限" class="headerlink" title="5）在网关中给门户网站跨域权限"></a>5）在网关中给门户网站跨域权限</h3><pre class="line-numbers language-yml" data-language="yml"><code class="language-yml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">globalcors</span><span class="token punctuation">:</span>
        <span class="token key atrule">cors-configurations</span><span class="token punctuation">:</span>
          <span class="token key atrule">'[/**]'</span><span class="token punctuation">:</span>
            <span class="token key atrule">allowedOrigins</span><span class="token punctuation">:</span>
              <span class="token punctuation">-</span> <span class="token string">"http://manage.leyou.com"</span>
              <span class="token punctuation">-</span> <span class="token string">"http://www.leyou.com"</span>
            <span class="token key atrule">allowedHeaders</span><span class="token punctuation">:</span>
              <span class="token punctuation">-</span> <span class="token string">"*"</span>
            <span class="token key atrule">allowCredentials</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
            <span class="token key atrule">maxAge</span><span class="token punctuation">:</span> <span class="token number">360000</span>
            <span class="token key atrule">allowedMethods</span><span class="token punctuation">:</span>
              <span class="token punctuation">-</span> GET
              <span class="token punctuation">-</span> POST
              <span class="token punctuation">-</span> DELETE
              <span class="token punctuation">-</span> PUT
              <span class="token punctuation">-</span> OPTIONS
              <span class="token punctuation">-</span> HEAD<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="18、课程总结"><a href="#18、课程总结" class="headerlink" title="18、课程总结"></a>18、课程总结</h2><p>1）商品查询</p><p>1.1 Spu和Sku概念的理解 （Spu是一个商品集（共性数据），Sku是一个具体商品（特有数据））</p><p>1.2 分析商品相关表的结构</p><p>​ 1.3 编写商品查询方法（注意JDK1.8新特性）</p><p>2）商品添加</p><p>​ 2.1 修改SpuDTO接收所有商品数据</p><p>​ 2.2 编写保存逻辑（保存三张表，字段不要漏）</p><p>3）商品上下架（状态修改）</p></div><hr><div class="reprint" id="reprint-statement"><div class="reprint__author"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-user">文章作者:</i></span> <span class="reprint-info"><a href="/about" rel="external nofollow noreferrer">durex</a></span></div><div class="reprint__type"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-link">文章链接:</i></span> <span class="reprint-info"><a href="https://chenliren9527.github.io/2020/12/30/le-you-dian-shang-05-shang-pin-guan-li/">https://chenliren9527.github.io/2020/12/30/le-you-dian-shang-05-shang-pin-guan-li/</a></span></div><div class="reprint__notice"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-copyright">版权声明:</i></span> <span class="reprint-info">本博客所有文章除特別声明外，均采用 <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a> 许可协议。转载请注明来源 <a href="/about" target="_blank">durex</a> !</span></div></div><script async defer>document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }</script><div class="tag_share" style="display:block"><div class="post-meta__tag-list" style="display:inline-block"><div class="article-tag"><a href="/tags/%E7%AC%94%E8%AE%B0/"><span class="chip bg-color">笔记</span></a> <a href="/tags/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%E4%BA%8C/"><span class="chip bg-color">项目实战二</span></a> <a href="/tags/springcloud/"><span class="chip bg-color">springcloud</span></a> <a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"><span class="chip bg-color">微服务</span></a> <a href="/tags/SPU/"><span class="chip bg-color">SPU</span></a> <a href="/tags/SKU/"><span class="chip bg-color">SKU</span></a></div></div><div class="post_share" style="zoom:80%;width:fit-content;display:inline-block;float:right;margin:-.15rem 0"><link rel="stylesheet" href="/libs/share/css/share.min.css"><div id="article-share"><div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div><script src="/libs/share/js/social-share.min.js"></script></div></div></div><style>#reward{margin:40px 0;text-align:center}#reward .reward-link{font-size:1.4rem;line-height:38px}#reward .btn-floating:hover{box-shadow:0 6px 12px rgba(0,0,0,.2),0 5px 15px rgba(0,0,0,.2)}#rewardModal{width:320px;height:350px}#rewardModal .reward-title{margin:15px auto;padding-bottom:5px}#rewardModal .modal-content{padding:10px}#rewardModal .close{position:absolute;right:15px;top:15px;color:rgba(0,0,0,.5);font-size:1.3rem;line-height:20px;cursor:pointer}#rewardModal .close:hover{color:#ef5350;transform:scale(1.3);-moz-transform:scale(1.3);-webkit-transform:scale(1.3);-o-transform:scale(1.3)}#rewardModal .reward-tabs{margin:0 auto;width:210px}.reward-tabs .tabs{height:38px;margin:10px auto;padding-left:0}.reward-content ul{padding-left:0!important}.reward-tabs .tabs .tab{height:38px;line-height:38px}.reward-tabs .tab a{color:#fff;background-color:#ccc}.reward-tabs .tab a:hover{background-color:#ccc;color:#fff}.reward-tabs .wechat-tab .active{color:#fff!important;background-color:#22ab38!important}.reward-tabs .alipay-tab .active{color:#fff!important;background-color:#019fe8!important}.reward-tabs .reward-img{width:210px;height:210px}</style><div id="reward"><a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a><div id="rewardModal" class="modal"><div class="modal-content"><a class="close modal-close"><i class="fas fa-times"></i></a><h4 class="reward-title">你的赏识是我前进的动力</h4><div class="reward-content"><div class="reward-tabs"><ul class="tabs row"><li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li><li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li></ul><div id="alipay"><img src="/medias/reward/alipay.png" class="reward-img" alt="支付宝打赏二维码"></div><div id="wechat"><img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码"></div></div></div></div></div></div><script>$(function(){$(".tabs").tabs()})</script></div></div><article id="prenext-posts" class="prev-next articles"><div class="row article-row"><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge left-badge text-color"><i class="fas fa-chevron-left"></i> &nbsp;上一篇</div><div class="card"><a href="/2020/12/31/le-you-dian-shang-06-shang-pin-sou-suo-fen-xi/"><div class="card-image"><img src="/medias/featureimages/211.jpg" class="responsive-img" alt="乐优电商(06)-商品搜索分析"> <span class="card-title">乐优电商(06)-商品搜索分析</span></div></a><div class="card-content article-content"><div class="summary block-with-text"></div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i> 2020-12-31</span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%E4%BA%8C/" class="post-category">项目实战二</a></span></div></div><div class="card-action article-tags"><a href="/tags/%E7%AC%94%E8%AE%B0/"><span class="chip bg-color">笔记</span></a> <a href="/tags/Elasticsearch/"><span class="chip bg-color">Elasticsearch</span></a> <a href="/tags/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%E4%BA%8C/"><span class="chip bg-color">项目实战二</span></a> <a href="/tags/springcloud/"><span class="chip bg-color">springcloud</span></a> <a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"><span class="chip bg-color">微服务</span></a> <a href="/tags/SpringDataElasticsearch/"><span class="chip bg-color">SpringDataElasticsearch</span></a> <a href="/tags/Kibana/"><span class="chip bg-color">Kibana</span></a></div></div></div><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge right-badge text-color">下一篇&nbsp;<i class="fas fa-chevron-right"></i></div><div class="card"><a href="/2020/12/28/le-you-dian-shang-04-pin-pai-tu-pian-shang-chuan-shang-pin-gui-ge-oss/"><div class="card-image"><img src="/medias/featureimages/157.jpg" class="responsive-img" alt="乐优电商(04)-品牌图片上传&amp;商品规格【OSS】"> <span class="card-title">乐优电商(04)-品牌图片上传&amp;商品规格【OSS】</span></div></a><div class="card-content article-content"><div class="summary block-with-text"></div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i> 2020-12-28</span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%E4%BA%8C/" class="post-category">项目实战二</a></span></div></div><div class="card-action article-tags"><a href="/tags/%E7%AC%94%E8%AE%B0/"><span class="chip bg-color">笔记</span></a> <a href="/tags/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%E4%BA%8C/"><span class="chip bg-color">项目实战二</span></a> <a href="/tags/springcloud/"><span class="chip bg-color">springcloud</span></a> <a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"><span class="chip bg-color">微服务</span></a> <a href="/tags/%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0/"><span class="chip bg-color">图片上传</span></a> <a href="/tags/OSS/"><span class="chip bg-color">OSS</span></a> <a href="/tags/%E9%98%BF%E9%87%8C%E4%BA%91/"><span class="chip bg-color">阿里云</span></a></div></div></div></div></article></div><script src="/libs/codeBlock/codeBlockFuction.js"></script><script src="/libs/codeBlock/codeLang.js"></script><script src="/libs/codeBlock/codeCopy.js"></script><script src="/libs/codeBlock/codeShrink.js"></script></div><div id="toc-aside" class="expanded col l3 hide-on-med-and-down"><div class="toc-widget card" style="background-color:#fff"><div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div><div id="toc-content"></div></div></div></div><div id="floating-toc-btn" class="hide-on-med-and-down"><a class="btn-floating btn-large bg-color"><i class="fas fa-list-ul"></i></a></div><script src="/libs/tocbot/tocbot.min.js"></script><script>$(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });</script></main><footer class="page-footer bg-color"><div class="container row center-align" style="margin-bottom:15px!important"><div class="col s12 m8 l8 copy-right">Copyright&nbsp;&copy; <span id="year">2021-2023</span> <a href="/about" target="_blank">durex</a> |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a> |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a><br>&nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span class="white-color">932k</span> <span id="busuanzi_container_site_pv">&nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv" class="white-color"></span></span> <span id="busuanzi_container_site_uv">&nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv" class="white-color"></span></span><br><span id="sitetime">Loading ...</span><script>var calcSiteTime=function(){var e=new Date,t="2021",n=e.getFullYear(),i=e.getMonth()+1,a=e.getDate(),r=e.getHours(),s=e.getMinutes(),o=e.getSeconds(),g=Date.UTC(t,"1","08","0","0","0"),d=Date.UTC(n,i,a,r,s,o)-g,m=Math.floor(d/31536e6),l=Math.floor(d/864e5-365*m);if(t===String(n)){document.getElementById("year").innerHTML=n;var c="This site has been running for "+l+" days";c="本站已运行 "+l+" 天",document.getElementById("sitetime").innerHTML=c}else{document.getElementById("year").innerHTML=t+" - "+n;var u="This site has been running for "+m+" years and "+l+" days";u="本站已运行 "+m+" 年 "+l+" 天",document.getElementById("sitetime").innerHTML=u}};calcSiteTime()</script><br></div><div class="col s12 m4 l4 social-link social-statis"><a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50"><i class="fas fa-rss"></i></a></div></div></footer><div class="progress-bar"></div><div id="searchModal" class="modal"><div class="modal-content"><div class="search-header"><span class="title"><i class="fas fa-search"></i> &nbsp;&nbsp;搜索</span> <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字" class="search-input"></div><div id="searchResult"></div></div></div><script>$(function(){!function(t,a,s){"use strict";$.ajax({url:t,dataType:"xml",success:function(t){var e=$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get(),r=document.getElementById(a),n=document.getElementById(s);r.addEventListener("input",function(){var f='<ul class="search-result-list">',m=this.value.trim().toLowerCase().split(/[\s\-]+/);n.innerHTML="",this.value.trim().length<=0||(e.forEach(function(t){var r=!0,n=t.title.trim().toLowerCase(),a=t.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),e=t.url;e=0===e.indexOf("/")?t.url:"/"+e;var s=-1,i=-1,l=-1;if(""!==n&&""!==a&&m.forEach(function(t,e){s=n.indexOf(t),i=a.indexOf(t),s<0&&i<0?r=!1:(i<0&&(i=0),0===e&&(l=i))}),r){f+="<li><a href='"+e+"' class='search-result-title'>"+n+"</a>";var c=t.content.trim().replace(/<[^>]+>/g,"");if(0<=l){var u=l-20,o=l+80;u<0&&(u=0),0===u&&(o=100),o>c.length&&(o=c.length);var h=c.substr(u,o);m.forEach(function(t){var e=new RegExp(t,"gi");h=h.replace(e,'<em class="search-keyword">'+t+"</em>")}),f+='<p class="search-result">'+h+"...</p>"}f+="</li>"}}),f+="</ul>",n.innerHTML=f)})}})}("/search.xml","searchInput","searchResult")})</script><div id="backTop" class="top-scroll"><a class="btn-floating btn-large waves-effect waves-light" href="#!"><i class="fas fa-arrow-up"></i></a></div><script src="/libs/materialize/materialize.min.js"></script><script src="/libs/masonry/masonry.pkgd.min.js"></script><script src="/libs/aos/aos.js"></script><script src="/libs/scrollprogress/scrollProgress.min.js"></script><script src="/libs/lightGallery/js/lightgallery-all.min.js"></script><script src="/js/matery.js"></script><script>var windowWidth=$(window).width();768<windowWidth&&document.write('<script type="text/javascript" src="/libs/others/sakura.js"><\/script>')</script><script>var windowWidth=$(window).width();768<windowWidth&&document.write('<script type="text/javascript" src="/libs/others/star.js"><\/script>')</script><script src="https://ssl.captcha.qq.com/TCaptcha.js"></script><script src="/libs/others/TencentCaptcha.js"></script><button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script src="/libs/others/clicklove.js" async></script><script async src="/libs/others/busuanzi.pure.mini.js"></script><script src="/libs/instantpage/instantpage.js" type="module"></script></body></html>