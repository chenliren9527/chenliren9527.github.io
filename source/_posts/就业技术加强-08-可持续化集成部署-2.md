---
title: 就业技术加强(08)-可持续化集成部署课堂笔记
tags:
  - 笔记
  - 就业技术加强
  - Jenkins
  - Docker
  - Docker部署微服务
  - GitLab
  - 持续集成Jenkins
  - 容器管理Rancher
categories:
  - 就业技术加强
date: 2021-02-01 17:43:47
---



### 01-制作JDK8 Docker镜像

**目标**：基于centOS 7的docker镜像利用Dockerfile制作jdk8镜像

**小结**：

- 上传jdk1.8的压缩包
- 创建Dockerfile文件，设置里面的内容
- 先删除原有的 `jdk1.8` ；命令为： `docker rmi jdk1.8`
- 执行 `docker build -t='jdk1.8' .`

### 02-构建服务Docker镜像

**目标**：在IDEA中能够通过配置Maven构建目标将微服务制作成Docker镜像

**分析**：

1、设置docker可以被远程操作；

2、编写maven的构建目标：将当前开发工具中的某些项目制作成远程docker的镜像

**小结**：

- 设置docker可以被远程操作

- 编写maven构建目标

  ```xml
      <build>
          <finalName>${project.artifactId}</finalName>
          <plugins>
              <!-- spring-boot-maven-plugin -->
              <plugin>
                  <groupId>org.springframework.boot</groupId>
                  <artifactId>spring-boot-maven-plugin</artifactId>
              </plugin>
              <!-- docker-maven-plugin -->
              <plugin>
                  <groupId>com.spotify</groupId>
                  <artifactId>docker-maven-plugin</artifactId>
                  <version>1.2.2</version>
                  <configuration>
                      <!-- 镜像的名称 -->
                      <imageName>${project.artifactId}:${project.version}</imageName>
                      <!-- 基础镜像 -->
                      <baseImage>jdk1.8</baseImage>
                      <entryPoint>["java","-jar","/${project.build.finalName}.jar"]</entryPoint>
                      <resources>
                          <resource>
                              <targetPath>/</targetPath>
                              <directory>${project.build.directory}</directory>
                              <include>${project.build.finalName}.jar</include>
                          </resource>
                      </resources>
                      <dockerHost>http://192.168.12.135:2375</dockerHost>
                  </configuration>
              </plugin>
          </plugins>
      </build>
  
  ```

  

- 基于镜像创建容器  `docker run -di --name=web1 -p 9090:9090 spring-boot-docker:1.0-SNAPSHOT`



### 03-IDEA中操作Docker镜像、容器

**目标**：通过配置IDEA的Docker，以图形界面方式操作远程Docker服务器的镜像、容器

**小结**：

- 配置IDEA中对于docker的连接信息

![image-20210201092428595](就业技术加强-08-可持续化集成部署-2.assets/image-20210201092428595.png)

- 打开 `services` 操作

![image-20210201092457786](就业技术加强-08-可持续化集成部署-2.assets/image-20210201092457786.png)

> 查看有哪些可以安装的docker版本号
>
> **yum list** docker-ce --showduplicates **|** **sort** -r
>
> sudo yum install -y docker-ce-版本号；如：
>
> sudo yum install -y docker-ce-17.12.0.ce-1.el7.centos

### 04-安装Gitlab

**目标**：Gitlab的应用场景及创建Gitlab容器

**小结**：

- 拉取镜像

- 创建容器 

  ```sh
  docker run -d --name=gitlab \
  -p 443:443 -p 80:80 -p 222:22 \
  -v /usr/local/gitlab/config:/etc/gitlab \
  -v /usr/local/gitlab/logs:/var/log/gitlab \
  -v /usr/local/gitlab/data:/var/opt/gitlab \
  gitlab/gitlab-ce
  ```

  

- 设置gitlab对外的路径；重启

- 修改root密码

### 05-Gitlab应用

**目标**：将IDEA中的项目可以上传到Gitlab

**小结**：

- 在gitlab上创建一个项目；
- 在IDEA中创建本地仓库，设置一些不必要提交到版本仓库的忽略文件；
- 提交IDEA中的工程到本地仓库；
- 将本地仓库的版本推送到远程仓库

### 06-持续性集成部署

**目标**：能够说出可持续集成主要阶段计划、开发、构建、测试、发布、部署、容器编排、系统监控

**小结**：

![image-20210201111509795](就业技术加强-08-可持续化集成部署-2.assets/image-20210201111509795.png)

### 07-安装Jenkins

**目标**：能够说出Jenkins作用

**小结**：

- 拉取镜像
- 创建容器
- 修改jenkins插件的下载地址

### 08-Jenkins基本配置

**目标**：将新创建的Jenkins容器进行解锁、修改密码、创建用户

**小结**：

- 解锁：找到容器的这个文件 `/var/jenkins_home/secrets/initialAdminPassword`  里面有密码进行解锁
- 因为密码过长，所以可以在jenkins中修改密码

![image-20210201113207042](就业技术加强-08-可持续化集成部署-2.assets/image-20210201113207042.png)

![image-20210201113229390](就业技术加强-08-可持续化集成部署-2.assets/image-20210201113229390.png)

- 创建用户

![image-20210201113258314](就业技术加强-08-可持续化集成部署-2.assets/image-20210201113258314.png)

### 09-Jenkins插件配置

**目标**：安装、配置maven、git插件

**小结**：

- 访问Jenkins安装插件maven、git

- 安装在jenkins容器中的jdk、maven

- 访问Jenkins配置jdk、maven

  

### 10-Jenkins任务

**目标**：将Gitlab中的项目中在发生变化之后可以及时构建最新的Docker镜像

**小结**：

- 创建任务

  - 指定版本管理仓库，项目pom.xml

  - 设置什么时候触发

    ![image-20210201153552983](就业技术加强-08-可持续化集成部署-2.assets/image-20210201153552983.png)

### 11-Rancher基本应用

**目标**：能够说出Rancher的作用

**小结**：

Rancher的作用：可以对容器进行管理：新增、删除、查看容器的运行状态、执行容器命令

使用Rancher：

- 根据需要创建不同的环境；
- 添加主机
- 在安装了docker的宿主机上执行对应的监听命令
- 操作容器

### 12-常见面试题

- 需要持续部署的原因？

      手动部署出错率高
      需要熬夜加班部署
      
      单体应用的部署相对简单，部署服务停服务都只需要控制一个jar包即可
      微服务模式下应用部署的复杂度高，部署服务可能需要部署微服务相关的很多支持服务

- 敏捷开发，持续集成，持续交付，持续部署，DevOps的区别？

      敏捷开发：关注任务的分配和实际开发和本地环境的构建
      持续集成：敏捷开发+自动化测试
      持续交付：持续集成+包发布到内部的库中
      持续部署：持续交付+部署环节
      DevOps：持续部署+运维（包含了软件生命周期的所有环节）

- 为什么要进行每日站立会议？

      每日站会最主要的目的是及时的消除项目的风险。每个人通过说明以下的事项，项目经理能够很有效的把控项目的进度。主要内容包括：
      1、昨日工作内容
      2、今日计划工作内容
      3、是否有阻塞项目进度的问题

